import{u as E,s as m,j as e,I as G}from"./index-Dh6AIfoG.js";import{d as U,r as d}from"./vendor-react-DEK6ZklB.js";import{T as q}from"./TabNavigation-C0oTiztg.js";import{U as z}from"./UserMenu-D6ezDJoX.js";import{C as F}from"./CreateDogModal-D9hebzU7.js";import"./vendor-ui-Bo32stKt.js";import"./vendor-supabase-DfwcnzK-.js";import"./PremiumBadge-Djjyy8Qd.js";import"./Button-5ltFJX9w.js";import"./Input-BknJyq3e.js";import"./Select-BfNcImMH.js";const Z=()=>{const{user:i}=E(),n=U(),[s,k]=d.useState([]),[S,u]=d.useState(!0),[c,T]=d.useState({}),[V,x]=d.useState(!1);d.useEffect(()=>{if(!i){n("/login");return}p()},[i]);const p=async()=>{try{u(!0);const{data:t,error:r}=await m.from("dogs").select(`
          *,
          vaccinations (count),
          treatments (count),
          weight_records (count),
          dog_photos (count)
        `).eq("user_id",i.id).order("created_at",{ascending:!1});if(r)throw r;const o=await Promise.all((t||[]).map(async a=>{var f,v,N,w,y,_,D,C;const{data:l}=await m.from("weight_records").select("weight, date").eq("dog_id",a.id).order("date",{ascending:!1}).limit(1).single(),{data:I}=await m.from("vaccinations").select("*").eq("dog_id",a.id).gte("next_due_date",new Date().toISOString().split("T")[0]).order("next_due_date",{ascending:!0}).limit(2),{data:$}=await m.from("treatments").select("*").eq("dog_id",a.id).gte("next_due_date",new Date().toISOString().split("T")[0]).order("next_due_date",{ascending:!0}).limit(2),h=new Date(a.birth_date),g=new Date;let b=g.getFullYear()-h.getFullYear();const j=g.getMonth()-h.getMonth();return(j<0||j===0&&g.getDate()<h.getDate())&&b--,{...a,age:b,lastWeight:(l==null?void 0:l.weight)||a.weight,upcomingVaccinations:I||[],upcomingTreatments:$||[],totalVaccinations:((v=(f=a.vaccinations)==null?void 0:f[0])==null?void 0:v.count)||0,totalTreatments:((w=(N=a.treatments)==null?void 0:N[0])==null?void 0:w.count)||0,totalWeights:((_=(y=a.weight_records)==null?void 0:y[0])==null?void 0:_.count)||0,totalPhotos:((C=(D=a.dog_photos)==null?void 0:D[0])==null?void 0:C.count)||0}}));k(o),T({totalDogs:o.length,totalPhotos:o.reduce((a,l)=>a+l.totalPhotos,0),totalVaccinations:o.reduce((a,l)=>a+l.totalVaccinations,0),totalTreatments:o.reduce((a,l)=>a+l.totalTreatments,0)})}catch(t){console.error("Erreur chargement dashboard:",t)}finally{u(!1)}},P=t=>t==="male"?"â™‚":"â™€",M=t=>t==="male"?"text-blue-600":"text-pink-600",A=t=>({small:"Petit",medium:"Moyen",large:"Grand"})[t]||t;return S?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 pb-20",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mon Tableau de Bord"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["GÃ©rez vos ",s.length," ",s.length>1?"compagnons":"compagnon"]})]}),e.jsx(z,{})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("button",{onClick:()=>s.length>0&&n(`/dog-profile/${s[0].id}`),disabled:s.length===0,className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md hover:border-indigo-200 transition-all text-left disabled:cursor-not-allowed disabled:hover:shadow-sm disabled:hover:border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Chiens"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.totalDogs})]}),e.jsx("div",{className:"text-3xl",children:"ðŸ•"})]})}),e.jsx("button",{onClick:()=>s.length>0&&n(`/dog-profile/${s[0].id}`),disabled:s.length===0,className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md hover:border-indigo-200 transition-all text-left disabled:cursor-not-allowed disabled:hover:shadow-sm disabled:hover:border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Photos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.totalPhotos})]}),e.jsx("div",{className:"text-3xl",children:"ðŸ“¸"})]})}),e.jsx("button",{onClick:()=>s.length>0&&n(`/dog-profile/${s[0].id}`),disabled:s.length===0,className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md hover:border-indigo-200 transition-all text-left disabled:cursor-not-allowed disabled:hover:shadow-sm disabled:hover:border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vaccins"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.totalVaccinations})]}),e.jsx("div",{className:"text-3xl",children:"ðŸ’‰"})]})}),e.jsx("button",{onClick:()=>s.length>0&&n(`/dog-profile/${s[0].id}`),disabled:s.length===0,className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md hover:border-indigo-200 transition-all text-left disabled:cursor-not-allowed disabled:hover:shadow-sm disabled:hover:border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Traitements"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.totalTreatments})]}),e.jsx("div",{className:"text-3xl",children:"ðŸ’Š"})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>{console.log("ðŸ• UserDashboard: Clic sur Ajouter un chien"),x(!0)},className:"w-full md:w-auto px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2",children:[e.jsx(G,{name:"add",className:"w-5 h-5"}),"Ajouter un chien"]})}),s.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-xl shadow-sm",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ•"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Aucun chien enregistrÃ©"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Commencez par ajouter votre premier compagnon"}),e.jsx("button",{onClick:()=>{console.log("ðŸ• UserDashboard: Clic sur Ajouter mon premier chien"),x(!0)},className:"inline-block px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Ajouter mon premier chien"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all border border-gray-100",children:[e.jsxs("div",{className:"relative h-32 bg-gradient-to-r from-indigo-400 to-purple-400",children:[t.cover_photo_url&&e.jsx("img",{src:t.cover_photo_url,alt:"Couverture",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("button",{onClick:()=>n(`/dog-profile/${t.id}`),className:"px-3 py-1.5 bg-white/90 backdrop-blur-sm text-sm font-medium text-gray-700 rounded-lg hover:bg-white transition-colors",children:"GÃ©rer"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden bg-gray-200 flex-shrink-0 border-4 border-white -mt-10 shadow-lg",children:t.photo_url?e.jsx("img",{src:t.photo_url,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-3xl",children:"ðŸ•"})}),e.jsxs("div",{className:"flex-1 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:t.name}),e.jsx("span",{className:`text-2xl ${M(t.gender)}`,children:P(t.gender)})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:t.breed}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{children:[t.age," an",t.age>1?"s":""]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:A(t.size)}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[t.lastWeight," kg"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Photos"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.totalPhotos})]}),e.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Vaccins"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.totalVaccinations})]}),e.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Soins"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.totalTreatments})]}),e.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"PesÃ©es"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.totalWeights})]})]}),(t.upcomingVaccinations.length>0||t.upcomingTreatments.length>0)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase",children:"Ã€ venir"}),t.upcomingVaccinations.slice(0,2).map(r=>e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-blue-50 text-blue-700 px-3 py-2 rounded-lg",children:[e.jsx("span",{children:"ðŸ’‰"}),e.jsx("span",{children:r.vaccine_name}),e.jsx("span",{className:"ml-auto text-xs",children:new Date(r.next_due_date).toLocaleDateString("fr-FR")})]},r.id)),t.upcomingTreatments.slice(0,2).map(r=>e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-green-50 text-green-700 px-3 py-2 rounded-lg",children:[e.jsx("span",{children:"ðŸ’Š"}),e.jsx("span",{children:r.treatment_type==="vermifuge"?"Vermifuge":"Anti-puces"}),e.jsx("span",{className:"ml-auto text-xs",children:new Date(r.next_due_date).toLocaleDateString("fr-FR")})]},r.id))]})]})]},t.id))})]}),e.jsx(q,{}),e.jsx(F,{isOpen:V,onClose:()=>x(!1),onSuccess:()=>{x(!1),p()},userId:i==null?void 0:i.id})]})};export{Z as default};
