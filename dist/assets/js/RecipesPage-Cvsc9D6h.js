import{j as e,s as C,u as J}from"./index-CXgzQAJL.js";import{r as x,d as Q}from"./vendor-react-DEK6ZklB.js";import{u as K}from"./useNotifications-D1RWLqzU.js";import{T as O}from"./TabNavigation-Ck2Ay89Y.js";import{U as I}from"./UserMenu-DZxZIXvb.js";import{F as X}from"./Footer-CUAdwqST.js";import{P as Y}from"./PremiumModal-mot6G4j5.js";import{d as Z,m as U,a8 as ee,_ as te,D as se,a9 as re,W as B,a as ae,i as ie,F as ne,s as W}from"./vendor-ui-Bo32stKt.js";import{E as oe}from"./jspdf.es.min-bUfXMAJQ.js";import"./vendor-supabase-DfwcnzK-.js";import"./PremiumBadge-CtVuIydc.js";const le=({selectedIngredients:s,onSelectionChange:h})=>{const v={proteins:[{id:"poulet",name:"Poulet",emoji:"üçó"},{id:"dinde",name:"Dinde",emoji:"ü¶É"},{id:"boeuf",name:"B≈ìuf maigre",emoji:"ü•©"},{id:"saumon",name:"Saumon",emoji:"üêü"},{id:"oeuf",name:"≈íuf",emoji:"ü•ö"}],carbs:[{id:"riz_blanc",name:"Riz blanc",emoji:"üçö"},{id:"riz_complet",name:"Riz complet",emoji:"üåæ"},{id:"pomme_terre",name:"Pomme de terre",emoji:"ü•î"},{id:"patate_douce",name:"Patate douce",emoji:"üç†"},{id:"avoine",name:"Flocons d'avoine",emoji:"üåæ"}],veggies:[{id:"carotte",name:"Carotte",emoji:"ü•ï"},{id:"courgette",name:"Courgette",emoji:"ü•í"},{id:"haricots_verts",name:"Haricots verts",emoji:"ü´ò"},{id:"potiron",name:"Potiron",emoji:"üéÉ"},{id:"epinards",name:"√âpinards",emoji:"ü•¨"}],fats:[{id:"huile_colza",name:"Huile de colza",emoji:"ü´í"},{id:"huile_saumon",name:"Huile de saumon",emoji:"üêü"},{id:"huile_olive",name:"Huile d'olive",emoji:"ü´í"}]},w=r=>{h({...s,protein:r})},d=r=>{h({...s,carb:s.carb===r?null:r})},z=r=>{const l=s.veggies||[],j=l.includes(r);let p;if(j)p=l.filter(F=>F!==r);else{if(l.length>=2){alert("Maximum 2 l√©gumes autoris√©s");return}p=[...l,r]}h({...s,veggies:p})},f=r=>{h({...s,fat:r})},o=({ingredient:r,isSelected:l,onClick:j,disabled:p})=>e.jsxs("button",{onClick:j,disabled:p,className:`
        relative p-4 rounded-2xl border-2 transition-all
        ${l?"border-primary bg-primary/5":"border-gray-200 bg-white hover:border-gray-300"}
        ${p?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl mb-2",children:r.emoji}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})]}),l&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center",children:e.jsx(Z,{size:14,className:"text-white"})})]});return e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:["ü•© Prot√©ine ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"S√©lectionnez une prot√©ine (obligatoire)"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-3",children:v.proteins.map(r=>e.jsx(o,{ingredient:r,isSelected:s.protein===r.id,onClick:()=>w(r.id)},r.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:"üåæ Glucides"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Optionnel (0 ou 1)"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-3",children:v.carbs.map(r=>e.jsx(o,{ingredient:r,isSelected:s.carb===r.id,onClick:()=>d(r.id)},r.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:["ü•ï L√©gumes ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"S√©lectionnez 1 ou 2 l√©gumes (obligatoire)"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-3",children:v.veggies.map(r=>{var l;return e.jsx(o,{ingredient:r,isSelected:(l=s.veggies)==null?void 0:l.includes(r.id),onClick:()=>z(r.id)},r.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:"ü´í Graisse"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Automatique (recommand√© : huile de colza)"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:v.fats.map(r=>e.jsx(o,{ingredient:r,isSelected:s.fat===r.id,onClick:()=>f(r.id)},r.id))})]})]})},ce=({recipe:s,dogId:h,onSaved:v})=>{const[w,d]=x.useState(!1),[z,f]=x.useState(!1),[o,r]=x.useState(!1),l={proteins:{poulet:"Poulet",dinde:"Dinde",boeuf:"B≈ìuf maigre",saumon:"Saumon (sans ar√™tes)",oeuf:"≈íuf"},carbs:{riz_blanc:"Riz blanc",riz_complet:"Riz complet",pomme_terre:"Pomme de terre",patate_douce:"Patate douce",avoine:"Flocons d'avoine"},veggies:{carotte:"Carotte",courgette:"Courgette",haricots_verts:"Haricots verts",potiron:"Potiron",epinards:"√âpinards"},fats:{huile_colza:"Huile de colza",huile_saumon:"Huile de saumon",huile_olive:"Huile d'olive"}},j=async()=>{if(!h){alert("Aucun chien s√©lectionn√©");return}d(!0);try{const{data:{user:t}}=await C.auth.getUser(),{data:g,error:m}=await C.from("dog_recipes").insert([{user_id:t.id,dog_id:h,title:s.title,objective:s.objective,dog_weight:s.weight,protein_type:s.ingredients.protein,carb_type:s.ingredients.carb,veggies_type:s.ingredients.veggies,fat_type:s.ingredients.fat,quantities:s.quantities,nutrition_info:s.nutrition,instructions:s.instructions,frequency:s.frequency}]);if(m)throw m;f(!0),v&&v(),setTimeout(()=>f(!1),3e3)}catch(t){console.error("Erreur sauvegarde:",t),alert("Erreur lors de la sauvegarde")}finally{d(!1)}},p=()=>{window.print()},F=async()=>{r(!0);try{const t=new oe("p","mm","a4"),g=t.internal.pageSize.getWidth(),m=t.internal.pageSize.getHeight(),i=20;let a=i;t.setFillColor(59,130,246),t.rect(0,0,g,40,"F"),t.setTextColor(255,255,255),t.setFontSize(24),t.setFont("helvetica","bold"),t.text("üêï Woofly",i,20),t.setFontSize(12),t.setFont("helvetica","normal"),t.text("Recette personnalis√©e pour votre chien",i,30),a=50,t.setTextColor(0,0,0),t.setFontSize(18),t.setFont("helvetica","bold"),t.text(s.title,i,a),a+=10,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(`Pour ${s.dogName} | ${s.weight} kg | ${s.objective}`,i,a),a+=15,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Ingr√©dients",i,a),a+=8,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`${l.proteins[s.ingredients.protein]}`,i+5,a),t.setFont("helvetica","bold"),t.text(`${s.quantities.protein}g`,g-i-20,a),t.setFont("helvetica","normal"),a+=6,s.ingredients.carb&&(t.text(`${l.carbs[s.ingredients.carb]}`,i+5,a),t.setFont("helvetica","bold"),t.text(`${s.quantities.carb}g`,g-i-20,a),t.setFont("helvetica","normal"),a+=6),s.ingredients.veggies.forEach(c=>{const u=Math.round(s.quantities.veggies/s.ingredients.veggies.length);t.text(`${l.veggies[c]}`,i+5,a),t.setFont("helvetica","bold"),t.text(`${u}g`,g-i-20,a),t.setFont("helvetica","normal"),a+=6}),t.text(`${l.fats[s.ingredients.fat]}`,i+5,a),t.setFont("helvetica","bold"),t.text(`${s.quantities.fat}g`,g-i-20,a),t.setFont("helvetica","normal"),a+=6,t.text("Eau",i+5,a),t.setTextColor(100,100,100),t.text("Pour la cuisson",g-i-40,a),t.setTextColor(0,0,0),a+=12,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Valeurs nutritionnelles",i,a),a+=8,t.setFontSize(10),t.setFont("helvetica","normal"),[`Calories: ${s.nutrition.calories} kcal`,`Prot√©ines: ${s.nutrition.protein}g`,`Glucides: ${s.nutrition.carbs}g`,`Lipides: ${s.nutrition.fat}g`,`Fibres: ${s.nutrition.fiber}g`].forEach(c=>{t.text(c,i+5,a),a+=6}),a+=8,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Pr√©paration",i,a),a+=8,t.setFontSize(10),t.setFont("helvetica","normal"),s.instructions.forEach((c,u)=>{a>m-40&&(t.addPage(),a=i),t.setFont("helvetica","bold"),t.text(`${u+1}.`,i,a),t.setFont("helvetica","normal");const b=t.splitTextToSize(c,g-i*2-10);t.text(b,i+8,a),a+=b.length*5+3}),a+=8,a>m-60&&(t.addPage(),a=i),t.setFillColor(219,234,254),t.rect(i-5,a-5,g-i*2+10,35,"F"),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,64,175),t.text("Conseils & astuces",i,a+3),a+=8,t.setFontSize(9),t.setFont("helvetica","normal"),[`Cette recette correspond √† 2 repas pour un chien de ${s.weight}kg`,"Conservez la moiti√© au r√©frig√©rateur jusqu'√† 48h maximum","Congelez en portions individuelles pour une utilisation ult√©rieure",`Fr√©quence recommand√©e : ${s.frequency}`].forEach(c=>{t.text(`‚Ä¢ ${c}`,i+3,a),a+=5}),a+=10,a>m-50&&(t.addPage(),a=i),t.setFillColor(254,226,226),t.rect(i-5,a-5,g-i*2+10,30,"F"),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(153,27,27),t.text("Important",i,a+3),a+=8,t.setFontSize(9),t.setFont("helvetica","normal"),["Recette compl√©mentaire - ne remplace pas une alimentation compl√®te","Introduisez progressivement (25% nouveau, 75% ancien pendant 5-7 jours)","Surveillez les selles et le comportement de votre chien","En cas de doute, consultez votre v√©t√©rinaire"].forEach(c=>{t.text(`‚Ä¢ ${c}`,i+3,a),a+=5}),t.setTextColor(150,150,150),t.setFontSize(8),t.text("G√©n√©r√© avec Woofly - www.doogybook.com",g/2,m-10,{align:"center"}),t.text(`Date: ${new Date().toLocaleDateString("fr-FR")}`,g-i,m-10,{align:"right"});const R=new Date().toISOString().split("T")[0],T=s.ingredients.protein,M=s.dogName.toLowerCase().replace(/\s+/g,"-"),n=`recette-${T}-${M}-${R}.pdf`;t.save(n)}catch(t){console.error("Erreur g√©n√©ration PDF:",t),alert("Erreur lors de la g√©n√©ration du PDF")}finally{r(!1)}};return e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"flex items-start justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full font-medium",children:s.objective}),e.jsxs("span",{children:["‚Ä¢ Pour ",s.dogName]}),e.jsxs("span",{children:["‚Ä¢ ",s.weight," kg"]})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"üçó Ingr√©dients"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"font-medium",children:l.proteins[s.ingredients.protein]}),e.jsxs("span",{className:"text-primary font-bold",children:[s.quantities.protein,"g"]})]}),s.ingredients.carb&&e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"font-medium",children:l.carbs[s.ingredients.carb]}),e.jsxs("span",{className:"text-primary font-bold",children:[s.quantities.carb,"g"]})]}),s.ingredients.veggies.map((t,g)=>e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"font-medium",children:l.veggies[t]}),e.jsxs("span",{className:"text-primary font-bold",children:[Math.round(s.quantities.veggies/s.ingredients.veggies.length),"g"]})]},g)),e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"font-medium",children:l.fats[s.ingredients.fat]}),e.jsxs("span",{className:"text-primary font-bold",children:[s.quantities.fat,"g"]})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"font-medium",children:"Eau"}),e.jsx("span",{className:"text-gray-600",children:"Pour la cuisson"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"üìä Valeurs nutritionnelles"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-primary/5 to-purple-50 rounded-2xl",children:[e.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:s.nutrition.calories}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calories"})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-primary/5 to-purple-50 rounded-2xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:[s.nutrition.protein,"g"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Prot√©ines"})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-primary/5 to-purple-50 rounded-2xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:[s.nutrition.carbs,"g"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Glucides"})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-primary/5 to-purple-50 rounded-2xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:[s.nutrition.fat,"g"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Lipides"})]}),e.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-primary/5 to-purple-50 rounded-2xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:[s.nutrition.fiber,"g"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Fibres"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"üë®‚Äçüç≥ Pr√©paration"}),e.jsx("div",{className:"space-y-4",children:s.instructions.map((t,g)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center font-bold",children:g+1}),e.jsx("p",{className:"flex-1 text-gray-700 pt-1",children:t})]},g))})]}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-2xl border border-blue-200",children:[e.jsxs("h4",{className:"font-bold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(U,{size:20}),"üí° Conseils & astuces"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-900",children:[e.jsxs("li",{children:["‚Ä¢ Cette recette correspond √† ",e.jsx("strong",{children:"2 repas"})," pour un chien de ",s.weight,"kg"]}),e.jsx("li",{children:"‚Ä¢ Conservez la moiti√© au r√©frig√©rateur jusqu'√† 48h maximum"}),e.jsx("li",{children:"‚Ä¢ Congelez en portions individuelles pour une utilisation ult√©rieure"}),e.jsxs("li",{children:["‚Ä¢ Fr√©quence recommand√©e : ",e.jsx("strong",{children:s.frequency})]})]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-2xl border border-red-200",children:[e.jsxs("h4",{className:"font-bold text-red-900 mb-2 flex items-center gap-2",children:[e.jsx(ee,{size:20}),"‚ö†Ô∏è Important"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-red-900",children:[e.jsxs("li",{children:["‚Ä¢ ",e.jsx("strong",{children:"Recette compl√©mentaire"})," ‚Äì ne remplace pas une alimentation compl√®te et √©quilibr√©e"]}),e.jsx("li",{children:"‚Ä¢ Introduisez progressivement (25% nouveau, 75% ancien pendant 5-7 jours)"}),e.jsx("li",{children:"‚Ä¢ Surveillez les selles et le comportement de votre chien"}),e.jsx("li",{children:"‚Ä¢ En cas de doute, consultez votre v√©t√©rinaire"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:j,disabled:w||z,className:"flex-1 px-6 py-3 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:z?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:20}),e.jsx("span",{children:"Sauvegard√©e !"})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{size:20}),e.jsx("span",{children:w?"Sauvegarde...":"Sauvegarder"})]})}),e.jsx("button",{onClick:F,disabled:o,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-bold hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"G√©n√©ration..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:20}),e.jsx("span",{children:"T√©l√©charger PDF"})]})}),e.jsxs("button",{onClick:p,className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-all flex items-center justify-center gap-2",children:[e.jsx(re,{size:20}),e.jsx("span",{className:"hidden sm:inline",children:"Imprimer"})]})]})]})},de=()=>{const[s,h]=x.useState([]),[v,w]=x.useState(""),[d,z]=x.useState(null),[f,o]=x.useState(""),[r,l]=x.useState({protein:null,carb:null,veggies:[],fat:"huile_colza"}),[j,p]=x.useState(null),[F,t]=x.useState(!1),[g,m]=x.useState(!0);x.useEffect(()=>{i()},[]);const i=async()=>{var n;try{const{data:{user:c}}=await C.auth.getUser();if(!c){m(!1);return}const{data:u,error:b}=await C.from("dogs").select("*").eq("user_id",c.id).order("created_at",{ascending:!1});if(b){console.error("Erreur chargement chiens:",b),m(!1);return}if(u&&u.length>0){h(u);const S=u.find(y=>y.is_active)||u[0];w(S.id),z(S),o(((n=S.weight)==null?void 0:n.toString())||"")}}catch(c){console.error("Erreur chargement chiens:",c)}finally{m(!1)}},a=n=>{var u;w(n);const c=s.find(b=>b.id===n);c&&(z(c),o(((u=c.weight)==null?void 0:u.toString())||""))},$=async()=>{if(!d){alert("Veuillez s√©lectionner un chien");return}if(!f||f<=0){alert("Veuillez entrer un poids valide");return}if(!r.protein){alert("Veuillez s√©lectionner au moins une prot√©ine");return}if(r.veggies.length===0){alert("Veuillez s√©lectionner au moins un l√©gume");return}if(r.veggies.length>2){alert("Maximum 2 l√©gumes autoris√©s");return}t(!0);try{const n=Math.round(f*25),c=Math.round(n*.55),u=r.carb?Math.round(n*.25):0,b=Math.round(n*.15),S=Math.round(n*.02),y=r.protein==="saumon"?Math.round(S*.5):S,D=G({protein:r.protein,proteinGrams:c,carb:r.carb,carbGrams:u,veggies:r.veggies,veggiesGrams:b,fatGrams:y}),N=L(r.protein,d==null?void 0:d.name),P=R(r),k=T(r,{protein:c,carb:u,veggies:b,fat:y}),q=M(r),E={title:N,objective:P,dogName:(d==null?void 0:d.name)||"votre chien",weight:parseFloat(f),ingredients:r,quantities:{protein:c,carb:u,veggies:b,fat:y,total:n},nutrition:D,instructions:k,frequency:q};p(E)}catch(n){console.error("Erreur g√©n√©ration recette:",n),alert("Erreur lors de la g√©n√©ration de la recette")}finally{t(!1)}},G=({protein:n,proteinGrams:c,carb:u,carbGrams:b,veggies:S,veggiesGrams:y,fatGrams:D})=>{const N={proteins:{poulet:{calories:165,protein:31,fat:3.6},dinde:{calories:135,protein:29,fat:1},boeuf:{calories:250,protein:26,fat:17},saumon:{calories:208,protein:20,fat:13},oeuf:{calories:155,protein:13,fat:11}},carbs:{riz_blanc:{calories:130,carbs:28},riz_complet:{calories:111,carbs:23},pomme_terre:{calories:77,carbs:17},patate_douce:{calories:86,carbs:20},avoine:{calories:389,carbs:66}},veggies:{carotte:{calories:41,fiber:2.8},courgette:{calories:17,fiber:1},haricots_verts:{calories:31,fiber:3.4},potiron:{calories:26,fiber:.5},epinards:{calories:23,fiber:2.2}},fats:{huile_colza:{calories:884,omega3:9.1},huile_saumon:{calories:884,omega3:15},huile_olive:{calories:884,omega3:.76}}};let P=0,k=0,q=0,E=0,H=0;if(N.proteins[n]){const _=N.proteins[n];P+=c*_.calories/100,k+=c*_.protein/100,E+=c*_.fat/100}if(u&&N.carbs[u]){const _=N.carbs[u];P+=b*_.calories/100,q+=b*_.carbs/100}if(S.forEach(_=>{if(N.veggies[_]){const V=N.veggies[_],A=y/S.length;P+=A*V.calories/100,H+=A*V.fiber/100}}),r.fat&&N.fats[r.fat]){const _=N.fats[r.fat];P+=D*_.calories/100,E+=D}return{calories:Math.round(P),protein:Math.round(k),carbs:Math.round(q),fat:Math.round(E),fiber:Math.round(H*10)/10}},L=(n,c)=>`Recette ${{poulet:"Poulet",dinde:"Dinde",boeuf:"B≈ìuf",saumon:"Saumon",oeuf:"≈íuf"}[n]} pour ${c||"votre chien"}`,R=n=>n.protein==="saumon"?"Pelage brillant & om√©ga-3":n.veggies.includes("potiron")?"Digestion facile":n.carb==="patate_douce"?"√ânergie douce & stable":n.veggies.includes("carotte")?"Vision & vitalit√©":"Repas √©quilibr√© & plaisir",T=(n,c)=>{const u={poulet:"poulet",dinde:"dinde",boeuf:"b≈ìuf maigre",saumon:"saumon (sans ar√™tes)",oeuf:"≈ìuf"},b={riz_blanc:"riz blanc",riz_complet:"riz complet",pomme_terre:"pomme de terre",patate_douce:"patate douce",avoine:"flocons d'avoine"},S={carotte:"carotte",courgette:"courgette",haricots_verts:"haricots verts",potiron:"potiron",epinards:"√©pinards"},y=[`Pesez ${c.protein}g de ${u[n.protein]}. Faites cuire √† la vapeur ou √† la po√™le sans mati√®re grasse jusqu'√† cuisson compl√®te.`];n.carb&&y.push(`Faites cuire ${c.carb}g de ${b[n.carb]} selon les instructions, sans sel ni assaisonnement.`);const D=n.veggies.map(N=>S[N]).join(" et ");return y.push(`Faites cuire ${c.veggies}g de ${D} √† la vapeur jusqu'√† ce qu'ils soient tendres (10-15 min).`),y.push("Coupez la prot√©ine en petits morceaux. M√©langez tous les ingr√©dients dans un grand bol."),y.push(`Ajoutez ${c.fat}g de ${n.fat.replace("_"," d'")}. M√©langez bien.`),y.push("Laissez refroidir √† temp√©rature ambiante avant de servir. V√©rifiez la temp√©rature."),y},M=n=>n.protein==="oeuf"||n.protein==="boeuf"?"2-3 fois par semaine maximum":n.carb==="riz_complet"?"2-3 fois par semaine (alternez avec riz blanc)":"3-4 fois par semaine";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"text-primary",size:24}),"Cr√©er une recette"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pour quel chien ? *"}),g?e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"text-gray-600",children:"Chargement..."})]}):s.length===0?e.jsx("div",{className:"p-3 bg-gray-50 rounded-xl",children:e.jsx("p",{className:"text-gray-600",children:"Aucun chien trouv√©. Cr√©ez d'abord un profil de chien."})}):e.jsxs("select",{value:v,onChange:n=>a(n.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-white",children:[e.jsx("option",{value:"",children:"S√©lectionnez un chien"}),s.map(n=>e.jsxs("option",{value:n.id,children:[n.name," - ",n.breed]},n.id))]})]}),d&&e.jsxs("div",{className:"mb-4 flex items-center gap-3 p-3 bg-blue-50 rounded-xl border border-blue-200",children:[d.profile_image_url&&e.jsx("img",{src:d.profile_image_url,alt:d.name,className:"w-12 h-12 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900",children:d.name}),e.jsx("p",{className:"text-sm text-gray-600",children:d.breed})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Poids du chien (kg) *"}),e.jsx("input",{type:"number",value:f,onChange:n=>o(n.target.value),placeholder:"Ex : 15",min:"1",max:"100",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üí° Le poids sera utilis√© pour calculer les quantit√©s (25g/kg)"})]})]}),e.jsx(le,{selectedIngredients:r,onSelectionChange:l}),e.jsx("button",{onClick:$,disabled:F||!f||!r.protein||!d,className:"w-full px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-bold text-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"G√©n√©ration en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:20}),e.jsx("span",{children:"G√©n√©rer la recette"})]})}),j&&e.jsx(ce,{recipe:j,dogId:d==null?void 0:d.id,onSaved:()=>{window.dispatchEvent(new Event("recipeCreated"))}})]})},me=()=>{const[s,h]=x.useState([]),[v,w]=x.useState(!0);x.useEffect(()=>{d();const o=()=>{d()};return window.addEventListener("recipeCreated",o),()=>window.removeEventListener("recipeCreated",o)},[]);const d=async()=>{try{const{data:{user:o}}=await C.auth.getUser();if(!o)return;const{data:r,error:l}=await C.from("dog_recipes").select(`
          *,
          dogs:dog_id (
            name,
            profile_image_url
          )
        `).eq("user_id",o.id).order("created_at",{ascending:!1}).limit(10);if(l)throw l;h(r||[])}catch(o){console.error("Erreur chargement historique:",o)}finally{w(!1)}},z=async o=>{if(confirm("Supprimer cette recette ?"))try{const{error:r}=await C.from("dog_recipes").delete().eq("id",o);if(r)throw r;h(s.filter(l=>l.id!==o))}catch(r){console.error("Erreur suppression:",r),alert("Erreur lors de la suppression")}},f=o=>new Date(o).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"});return v?e.jsx("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"})})}):s.length===0?e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"üìö Historique"}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{size:48,className:"text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Aucune recette sauvegard√©e"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Vos recettes appara√Ætront ici"})]})]}):e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"üìö Historique des recettes"}),e.jsx("div",{className:"space-y-3",children:s.map(o=>{var r,l,j,p,F;return e.jsxs("div",{className:"p-4 border border-gray-200 rounded-2xl hover:border-primary/50 transition-all group",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[((r=o.dogs)==null?void 0:r.profile_image_url)&&e.jsx("img",{src:o.dogs.profile_image_url,alt:o.dogs.name,className:"w-12 h-12 rounded-full object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-gray-900 truncate",children:o.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary rounded-full text-xs font-medium",children:o.objective}),e.jsxs("span",{children:["‚Ä¢ ",o.dog_weight," kg"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 mt-2",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:f(o.created_at)})]})]})]}),e.jsx("button",{onClick:()=>z(o.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100",children:e.jsx(ne,{size:18})})]}),e.jsxs("div",{className:"flex gap-3 mt-3 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("div",{className:"text-sm font-bold text-primary",children:((l=o.nutrition_info)==null?void 0:l.calories)||0}),e.jsx("div",{className:"text-xs text-gray-500",children:"kcal"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsxs("div",{className:"text-sm font-bold text-primary",children:[((j=o.nutrition_info)==null?void 0:j.protein)||0,"g"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"prot√©ines"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsxs("div",{className:"text-sm font-bold text-primary",children:[((p=o.nutrition_info)==null?void 0:p.carbs)||0,"g"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"glucides"})]}),e.jsxs("div",{className:"text-center flex-1",children:[e.jsxs("div",{className:"text-sm font-bold text-primary",children:[((F=o.nutrition_info)==null?void 0:F.fiber)||0,"g"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"fibres"})]})]})]},o.id)})})]})},we=()=>{const{user:s}=J(),{unreadCount:h}=K(),v=Q(),[w,d]=x.useState(!1),[z,f]=x.useState(!1),[o,r]=x.useState(!0),[l,j]=x.useState(null),[p,F]=x.useState([]);x.useEffect(()=>{const m=localStorage.getItem("currentDogProfile");m&&j(JSON.parse(m))},[]),x.useEffect(()=>{(async()=>{if(s!=null&&s.id)try{const{data:i,error:a}=await C.from("dogs").select("*").eq("user_id",s.id).order("created_at",{ascending:!0});if(a)throw a;i&&i.length>0&&(F(i),l||(j(i[0]),localStorage.setItem("currentDogProfile",JSON.stringify(i[0]))))}catch(i){console.error("Erreur chargement chiens:",i)}})()},[s==null?void 0:s.id]),x.useEffect(()=>{t()},[s==null?void 0:s.id]);const t=async()=>{try{const{data:{user:m}}=await C.auth.getUser();if(!m){r(!1);return}const{data:i}=await C.from("user_profiles").select("subscription_tier").eq("id",m.id).single(),$=["premium","professional"].includes(i==null?void 0:i.subscription_tier);d($),$||f(!0)}catch(m){console.error("Erreur v√©rification premium:",m)}finally{r(!1)}},g=m=>{j(m),localStorage.setItem("currentDogProfile",JSON.stringify(m))};return o?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground",children:"Recettes Personnalis√©es"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>v("/notifications"),className:"relative p-1.5 sm:p-2 hover:bg-muted rounded-full transition-smooth",children:[e.jsx(W,{size:20,className:"sm:w-6 sm:h-6 text-foreground"}),h>0&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center px-0.5 sm:px-1 text-[10px] sm:text-xs",children:h>9?"9+":h})]}),e.jsx(I,{dogProfiles:p,currentDog:l,onDogChange:g})]})]})})}),e.jsx(O,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground",children:"Recettes Personnalis√©es"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>v("/notifications"),className:"relative p-1.5 sm:p-2 hover:bg-muted rounded-full transition-smooth",children:[e.jsx(W,{size:20,className:"sm:w-6 sm:h-6 text-foreground"}),h>0&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center px-0.5 sm:px-1 text-[10px] sm:text-xs",children:h>9?"9+":h})]}),e.jsx(I,{dogProfiles:p,currentDog:l,onDogChange:g})]})]})})}),e.jsx(O,{}),e.jsx("main",{className:"main-content flex-1",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-heading font-bold text-foreground mb-1 sm:mb-2",children:"üçΩÔ∏è Recettes Personnalis√©es"}),e.jsx("p",{className:"text-muted-foreground font-caption text-sm sm:text-base",children:"Cr√©ez des recettes √©quilibr√©es et s√©curis√©es pour votre chien"})]}),w?e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsx("div",{className:"mt-8",children:e.jsx(me,{})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Cette fonctionnalit√© est r√©serv√©e aux membres Premium"}),e.jsx("button",{onClick:()=>f(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition-all",children:"D√©couvrir Premium"})]})]})}),e.jsx(X,{}),e.jsx(Y,{isOpen:z,onClose:()=>f(!1),reason:"recipes"})]})};export{we as default};
