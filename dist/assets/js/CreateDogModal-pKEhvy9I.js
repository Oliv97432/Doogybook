import{j as t,I as g,s as f}from"./index-B7Jx57M6.js";import{r as b}from"./vendor-react-DEK6ZklB.js";import{B as w}from"./Button-DRPe_8g_.js";import{I as v}from"./Input-B_atqvlr.js";import{S as j}from"./Select-6JUoKzy5.js";const I=({isOpen:C,onClose:z,onSuccess:S,userId:N})=>{const[e,c]=b.useState({name:"",breed:"",birthDate:"",weight:"",gender:"",isSterilized:"no",microchipNumber:"",notes:"",image:""}),[s,u]=b.useState({}),[h,x]=b.useState(!1),[d,m]=b.useState(null),k=[{value:"malinois",label:"Malinois"},{value:"shih-tzu",label:"Shih-Tzu"},{value:"american-bully",label:"American Bully"},{value:"labrador",label:"Labrador"},{value:"golden-retriever",label:"Golden Retriever"},{value:"berger-allemand",label:"Berger Allemand"},{value:"bouledogue-francais",label:"Bouledogue Fran√ßais"},{value:"chihuahua",label:"Chihuahua"},{value:"husky",label:"Husky Sib√©rien"},{value:"beagle",label:"Beagle"},{value:"mixed",label:"Race mixte"},{value:"other",label:"Autre"}],E=[{value:"male",label:"M√¢le"},{value:"female",label:"Femelle"}],F=[{value:"yes",label:"Oui"},{value:"no",label:"Non"}],n=(r,l)=>{c(i=>({...i,[r]:l})),s!=null&&s[r]&&u(i=>({...i,[r]:""}))},P=r=>{var i;const l=(i=r.target.files)==null?void 0:i[0];if(l){if(!l.type.startsWith("image/")){u(a=>({...a,photo:"Veuillez s√©lectionner une image"}));return}if(l.size>5*1024*1024){u(a=>({...a,photo:"L'image ne doit pas d√©passer 5 MB"}));return}m(l),u(a=>({...a,photo:""}));const o=new FileReader;o.onloadend=()=>{c(a=>({...a,image:o.result}))},o.readAsDataURL(l)}},B=async r=>{if(!d)return{success:!0,url:null};try{const l=d.name.split(".").pop(),i=`${r}/${Date.now()}.${l}`;console.log("üì∏ Upload photo vers:",i);const{data:o,error:a}=await f.storage.from("dog-photos").upload(i,d,{cacheControl:"3600",upsert:!1});if(a)return console.error("‚ùå Erreur upload photo:",a),{success:!1,error:a.message||"Erreur lors de l'upload de la photo"};console.log("‚úÖ Photo upload√©e:",o);const{data:p}=f.storage.from("dog-photos").getPublicUrl(i);return console.log("üîó URL publique:",p.publicUrl),{success:!0,url:p.publicUrl}}catch(l){return console.error("‚ùå Erreur upload:",l),{success:!1,error:"Une erreur inattendue est survenue lors de l'upload"}}},L=()=>{var l,i,o;const r={};if((l=e==null?void 0:e.name)!=null&&l.trim()||(r.name="Le nom est requis"),e!=null&&e.breed||(r.breed="La race est requise"),e!=null&&e.gender||(r.gender="Le sexe est requis"),e!=null&&e.birthDate||(r.birthDate="La date de naissance est requise"),e!=null&&e.weight&&(isNaN(parseFloat(e.weight))||parseFloat(e.weight)<=0)&&(r.weight="Le poids doit √™tre un nombre positif"),(i=e==null?void 0:e.microchipNumber)!=null&&i.trim()){const a=e.microchipNumber.trim(),p=/^\d{15}$/.test(a),U=/^[A-Z]{3}\d{3,4}$/i.test(a);!p&&!U&&(r.microchipNumber="Format invalide. Puce: 15 chiffres. Tatouage: 3 lettres + 3-4 chiffres (ex: ABC123)")}return u(r),((o=Object.keys(r))==null?void 0:o.length)===0},q=async r=>{if(r==null||r.preventDefault(),!!L()){x(!0);try{let l=null;if(d){const a=await B(N);if(!a.success){alert(`‚ùå Erreur d'upload de la photo: ${a.error}`),x(!1);return}l=a.url}const{data:i,error:o}=await f.from("dogs").insert([{user_id:N,name:e.name.trim(),breed:e.breed,birth_date:e.birthDate,weight:e.weight?parseFloat(e.weight):null,gender:e.gender,is_sterilized:e.isSterilized==="yes",microchip_number:e.microchipNumber.trim()||null,notes:e.notes.trim()||null,photo_url:l||null,is_active:!0}]).select().single();if(o){console.error("Erreur ajout chien:",o),alert("‚ùå Erreur lors de l'ajout du chien. Veuillez r√©essayer.");return}console.log("‚úÖ Chien cr√©√©:",i),alert(`‚úÖ ${i.name} a √©t√© ajout√© avec succ√®s !`),c({name:"",breed:"",birthDate:"",weight:"",gender:"",isSterilized:"no",microchipNumber:"",notes:"",image:""}),m(null),u({}),S(i)}catch(l){console.error("Erreur soumission:",l),alert("‚ùå Une erreur est survenue lors de l'ajout du chien")}finally{x(!1)}}},y=()=>{c({name:"",breed:"",birthDate:"",weight:"",gender:"",isSterilized:"no",microchipNumber:"",notes:"",image:""}),m(null),u({}),z()};return C?t.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-card rounded-lg shadow-elevated max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"sticky top-0 bg-card border-b border-border p-4 flex items-center justify-between z-10",children:[t.jsx("h2",{className:"text-xl font-heading font-semibold text-foreground",children:"Cr√©er le profil de mon chien"}),t.jsx("button",{onClick:y,className:"text-muted-foreground hover:text-foreground transition-smooth","aria-label":"Fermer",children:t.jsx(g,{name:"X",size:24})})]}),t.jsxs("form",{onSubmit:q,className:"p-6 space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-foreground",children:"Photo du chien"}),e.image&&t.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-3",children:[t.jsx("img",{src:e.image,alt:"Aper√ßu",className:"w-full h-full object-cover rounded-full border-2 border-border"}),t.jsx("button",{type:"button",onClick:()=>{c(r=>({...r,image:""})),m(null)},className:"absolute -top-2 -right-2 bg-destructive text-white rounded-full p-1 hover:bg-destructive/90",children:t.jsx(g,{name:"X",size:16})})]}),t.jsx("div",{className:"flex gap-3",children:t.jsxs("label",{className:"flex-1",children:[t.jsx("input",{type:"file",accept:"image/*",onChange:P,className:"hidden"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 border border-border rounded-lg hover:bg-muted cursor-pointer transition-smooth",children:[t.jsx(g,{name:"Upload",size:20}),t.jsx("span",{className:"text-sm",children:d?"Changer la photo":"Choisir une photo"})]})]})}),(s==null?void 0:s.photo)&&t.jsx("p",{className:"text-xs text-destructive mt-1",children:s.photo}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: JPG, PNG, WEBP ‚Ä¢ Max: 5 MB"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(v,{label:"Nom du chien",type:"text",placeholder:"Ex: Max, Luna, Rocky...",value:e==null?void 0:e.name,onChange:r=>{var l;return n("name",(l=r==null?void 0:r.target)==null?void 0:l.value)},error:s==null?void 0:s.name,required:!0}),t.jsx(j,{label:"Race",placeholder:"S√©lectionnez une race",options:k,value:e==null?void 0:e.breed,onChange:r=>n("breed",r),error:s==null?void 0:s.breed,required:!0,searchable:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(j,{label:"Sexe",placeholder:"S√©lectionnez le sexe",options:E,value:e==null?void 0:e.gender,onChange:r=>n("gender",r),error:s==null?void 0:s.gender,required:!0}),t.jsx(j,{label:"St√©rilis√©(e)",options:F,value:e==null?void 0:e.isSterilized,onChange:r=>n("isSterilized",r),required:!0})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(v,{label:"Date de naissance",type:"date",value:e==null?void 0:e.birthDate,onChange:r=>{var l;return n("birthDate",(l=r==null?void 0:r.target)==null?void 0:l.value)},error:s==null?void 0:s.birthDate,required:!0}),t.jsx(v,{label:"Poids (kg)",type:"number",placeholder:"Ex: 25 ou 8.5",value:e==null?void 0:e.weight,onChange:r=>{var l;return n("weight",(l=r==null?void 0:r.target)==null?void 0:l.value)},error:s==null?void 0:s.weight,min:"0",max:"100",step:"0.1"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Num√©ro de puce √©lectronique ou tatouage"}),t.jsx("input",{type:"text",value:e.microchipNumber,onChange:r=>n("microchipNumber",r.target.value),className:"w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent font-mono",placeholder:"250268500123456 ou ABC1234",maxLength:"15"}),s.microchipNumber&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.microchipNumber}),t.jsxs("p",{className:"text-muted-foreground text-xs mt-1 flex items-center gap-1",children:[t.jsx(g,{name:"Info",size:12}),"Puce: 15 chiffres ‚Ä¢ Tatouage: 3 lettres + 3-4 chiffres (ex: ABC123)"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Notes"}),t.jsx("textarea",{value:e.notes,onChange:r=>n("notes",r.target.value),rows:4,className:"w-full px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Informations suppl√©mentaires, particularit√©s..."})]}),t.jsxs("div",{className:"flex gap-3 pt-4",children:[t.jsx(w,{type:"button",variant:"outline",fullWidth:!0,onClick:y,disabled:h,children:"Annuler"}),t.jsx(w,{type:"submit",variant:"default",fullWidth:!0,iconName:h?"Loader":"Check",iconPosition:"left",disabled:h,children:h?"Cr√©ation en cours...":"Cr√©er le profil"})]})]})]})}):null};export{I as C};
