import{j as e,s as I,u as q}from"./index-Dh6AIfoG.js";import{r as u,d as V}from"./vendor-react-DEK6ZklB.js";import{u as J}from"./useNotifications-DwZ9LaYw.js";import{T as _}from"./TabNavigation-C0oTiztg.js";import{U}from"./UserMenu-D6ezDJoX.js";import{F as B}from"./Footer-D3Rbh1Fu.js";import{P as W}from"./PremiumModal-CTgGYOlZ.js";import{E as X}from"./jspdf.es.min-BIAsmWau.js";import{s as M}from"./vendor-ui-Bo32stKt.js";import"./vendor-supabase-DfwcnzK-.js";import"./PremiumBadge-Djjyy8Qd.js";const Y=({pages:s,currentPageIndex:n,onPageChange:a,onPhotoDrop:l,onRemovePhoto:r})=>{const[h,t]=u.useState(!1),[d,x]=u.useState(""),[i,p]=u.useState(null),N=s[n],D=n+1,F=D<s.length,k=()=>{n>0&&!h&&(x("backward"),t(!0),setTimeout(()=>{a(n-1),t(!1),x("")},600))},P=()=>{F&&!h&&(x("forward"),t(!0),setTimeout(()=>{a(n+1),t(!1),x("")},600))},m=(j,C)=>{p(C),j.dataTransfer.effectAllowed="move",j.dataTransfer.setData("text/html",j.target)},b=j=>{j.preventDefault(),j.dataTransfer.dropEffect="move"},v=(j,C,z)=>{j.preventDefault();const E=j.dataTransfer.getData("photoId")||i;E&&l(E,C,z),p(null)},$=(j,C)=>{const z=j.photos.find(w=>w.slotIndex===C),E=`photo-slot layout-${j.layout}`;return e.jsx("div",{className:E,onDragOver:b,onDrop:w=>v(w,j.id,C),children:z?e.jsxs("div",{className:"photo-container",children:[e.jsx("img",{src:z.url,alt:`Photo ${C+1}`,className:"album-photo",draggable:!0,onDragStart:w=>m(w,z.id)}),e.jsx("button",{className:"remove-photo-btn",onClick:()=>r(j.id,C),title:"Supprimer cette photo",children:"Ã—"})]}):e.jsx("div",{className:"empty-slot",children:e.jsx("span",{className:"text-gray-400",children:"Glissez une photo ici"})})},C)},T=(j,C=!1)=>{if(!j)return e.jsx("div",{className:"album-page empty"});const z=R(j.layout),E=Array.from({length:z},(w,o)=>o);return e.jsxs("div",{className:`album-page ${C?"right":"left"}`,children:[e.jsx("div",{className:`page-content layout-${j.layout}`,children:E.map(w=>$(j,w))}),e.jsx("div",{className:"page-number",children:s.indexOf(j)+1})]})},R=j=>{switch(j){case"fullPage":return 1;case"twoPerPage":return 2;case"threePerPage":return 3;default:return 1}};return e.jsxs("div",{className:"album-viewer",children:[e.jsxs("div",{className:"album-controls",children:[e.jsx("button",{onClick:k,disabled:n===0||h,className:"nav-btn prev-btn",title:"Page prÃ©cÃ©dente",children:"â† PrÃ©cÃ©dent"}),e.jsxs("span",{className:"page-indicator",children:["Page ",n+1," sur ",s.length]}),e.jsx("button",{onClick:P,disabled:!F||h,className:"nav-btn next-btn",title:"Page suivante",children:"Suivant â†’"})]}),e.jsxs("div",{className:`album-book ${h?"flipping":""} ${d}`,children:[e.jsx("div",{className:"book-spine"}),e.jsx("div",{className:"book-left",children:T(N,!1)}),e.jsx("div",{className:"book-right",children:F?T(s[D],!0):e.jsx("div",{className:"album-page right empty",children:e.jsx("div",{className:"end-message",children:"Fin de l'album"})})}),h&&e.jsx("div",{className:`turning-page ${d}`,children:T(d==="forward"?N:s[D])})]}),e.jsx("div",{className:"album-instructions",children:e.jsx("p",{children:'ðŸ’¡ Glissez-dÃ©posez des photos depuis le panneau latÃ©ral ou utilisez le bouton "Remplissage AlÃ©atoire"'})})]})},K=({photos:s,onRandomFill:n,dogName:a})=>{const l=(r,h)=>{r.dataTransfer.effectAllowed="copy",r.dataTransfer.setData("photoId",h.id)};return e.jsxs("div",{className:"photo-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Photos de ",a]}),e.jsxs("span",{className:"photo-count",children:[s.length," photo",s.length!==1?"s":""]})]}),e.jsx("div",{className:"sidebar-actions",children:e.jsx("button",{onClick:n,disabled:s.length===0,className:"btn-random",title:"RÃ©partir toutes les photos de faÃ§on alÃ©atoire dans l'album",children:"ðŸŽ² Remplissage AlÃ©atoire"})}),e.jsx("div",{className:"photo-grid",children:s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“·"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucune photo disponible"}),e.jsxs("p",{className:"text-gray-400 text-xs mt-2",children:["Ajoutez des photos depuis le profil de ",a]}),e.jsx("a",{href:"/dog-profile",className:"inline-block mt-4 px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors",children:"Aller au profil"})]}):s.map(r=>e.jsxs("div",{className:"photo-thumbnail",draggable:!0,onDragStart:h=>l(h,r),children:[e.jsx("img",{src:r.url,alt:r.name,className:"thumbnail-image"}),e.jsx("div",{className:"thumbnail-overlay",children:e.jsx("span",{className:"drag-hint",children:"Glisser"})})]},r.id))}),s.length>0&&e.jsx("div",{className:"sidebar-footer",children:e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ Glissez une photo vers l'album ou utilisez le remplissage alÃ©atoire"})})]})},Q=({currentPage:s,selectedLayout:n,onLayoutChange:a,onAddPage:l})=>{var h;const r=[{id:"fullPage",name:"Pleine Page",icon:"ðŸ–¼ï¸",description:"Une grande photo par page",preview:e.jsx("div",{className:"layout-preview",children:e.jsx("div",{className:"preview-box full"})})},{id:"twoPerPage",name:"2 par Page",icon:"ðŸ“",description:"Deux photos cÃ´te Ã  cÃ´te",preview:e.jsxs("div",{className:"layout-preview",children:[e.jsx("div",{className:"preview-box half"}),e.jsx("div",{className:"preview-box half"})]})},{id:"threePerPage",name:"3 par Page",icon:"ðŸŽ¨",description:"Trois photos (1 grande + 2 petites)",preview:e.jsxs("div",{className:"layout-preview three",children:[e.jsx("div",{className:"preview-box large"}),e.jsxs("div",{className:"preview-box-group",children:[e.jsx("div",{className:"preview-box small"}),e.jsx("div",{className:"preview-box small"})]})]})}];return e.jsxs("div",{className:"config-panel",children:[e.jsx("div",{className:"panel-header",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Configuration"})}),e.jsxs("div",{className:"config-section",children:[e.jsx("h3",{className:"section-title",children:"Page Actuelle"}),e.jsxs("div",{className:"current-page-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Mise en page:"}),e.jsx("span",{className:"info-value",children:((h=r.find(t=>t.id===(s==null?void 0:s.layout)))==null?void 0:h.name)||"Pleine Page"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Photos:"}),e.jsxs("span",{className:"info-value",children:[(s==null?void 0:s.photos.length)||0," / ",Z(s==null?void 0:s.layout)]})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h3",{className:"section-title",children:"Changer la Mise en Page"}),e.jsx("p",{className:"section-description",children:"Modifie la disposition de la page actuelle"}),e.jsx("div",{className:"layout-options",children:r.map(t=>e.jsxs("button",{onClick:()=>a(t.id),className:`layout-option ${n===t.id?"active":""}`,title:t.description,children:[e.jsxs("div",{className:"option-header",children:[e.jsx("span",{className:"option-icon",children:t.icon}),e.jsx("span",{className:"option-name",children:t.name})]}),t.preview,e.jsx("p",{className:"option-description",children:t.description})]},t.id))})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h3",{className:"section-title",children:"Actions"}),e.jsx("button",{onClick:l,className:"action-btn add-page",children:"âž• Ajouter une Nouvelle Page"})]}),e.jsxs("div",{className:"config-section help-section",children:[e.jsx("h3",{className:"section-title",children:"Aide"}),e.jsxs("div",{className:"help-content",children:[e.jsxs("div",{className:"help-item",children:[e.jsx("span",{className:"help-icon",children:"ðŸ–±ï¸"}),e.jsx("span",{className:"help-text",children:"Glissez-dÃ©posez pour ajouter des photos"})]}),e.jsxs("div",{className:"help-item",children:[e.jsx("span",{className:"help-icon",children:"ðŸ”„"}),e.jsx("span",{className:"help-text",children:"Changez la mise en page Ã  tout moment"})]}),e.jsxs("div",{className:"help-item",children:[e.jsx("span",{className:"help-icon",children:"ðŸ“„"}),e.jsx("span",{className:"help-text",children:"Utilisez les miniatures pour rÃ©organiser"})]})]})]})]})},Z=s=>{switch(s){case"fullPage":return 1;case"twoPerPage":return 2;case"threePerPage":return 3;default:return 1}},H=({pages:s,currentPageIndex:n,onPageSelect:a,onReorder:l,onDuplicate:r,onDelete:h})=>{const[t,d]=u.useState(null),[x,i]=u.useState(null),p=(m,b)=>{d(b),m.dataTransfer.effectAllowed="move"},N=(m,b)=>{m.preventDefault(),m.dataTransfer.dropEffect="move",i(b)},D=()=>{i(null)},F=(m,b)=>{m.preventDefault(),t!==null&&t!==b&&l(t,b),d(null),i(null)},k=()=>{d(null),i(null)},P=m=>{switch(m){case"fullPage":return"Pleine Page";case"twoPerPage":return"2 par Page";case"threePerPage":return"3 par Page";default:return"Pleine Page"}};return e.jsxs("div",{className:"page-thumbnails",children:[e.jsxs("div",{className:"thumbnails-header",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Pages de l'Album"}),e.jsxs("span",{className:"page-count-badge",children:[s.length," page",s.length!==1?"s":""]})]}),e.jsx("div",{className:"thumbnails-grid",children:s.map((m,b)=>e.jsxs("div",{className:`page-thumbnail-card ${n===b?"active":""} ${x===b?"drag-over":""}`,draggable:!0,onDragStart:v=>p(v,b),onDragOver:v=>N(v,b),onDragLeave:D,onDrop:v=>F(v,b),onDragEnd:k,onClick:()=>a(b),children:[e.jsx("div",{className:"thumbnail-preview",children:e.jsx("div",{className:`preview-layout layout-${m.layout}`,children:m.photos.length>0?m.photos.map((v,$)=>e.jsx("div",{className:"preview-photo",children:e.jsx("img",{src:v.url,alt:""})},$)):e.jsx("div",{className:"preview-empty",children:e.jsx("span",{className:"text-gray-400 text-xs",children:"Vide"})})})}),e.jsxs("div",{className:"thumbnail-info",children:[e.jsxs("div",{className:"info-header",children:[e.jsxs("span",{className:"page-number",children:["Page ",b+1]}),e.jsx("span",{className:"layout-badge",children:P(m.layout)})]}),e.jsx("div",{className:"photo-info",children:e.jsxs("span",{className:"text-xs text-gray-600",children:[m.photos.length," photo",m.photos.length!==1?"s":""]})})]}),e.jsxs("div",{className:"thumbnail-actions",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),r(m.id)},className:"action-icon duplicate",title:"Dupliquer cette page",children:"ðŸ“‹"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),window.confirm("Voulez-vous vraiment supprimer cette page ?")&&h(m.id)},className:"action-icon delete",title:"Supprimer cette page",disabled:s.length<=1,children:"ðŸ—‘ï¸"})]}),t===b&&e.jsx("div",{className:"dragging-indicator",children:e.jsx("span",{children:"DÃ©placement..."})})]},m.id))}),e.jsx("div",{className:"thumbnails-footer",children:e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ Glissez-dÃ©posez pour rÃ©organiser les pages"})})]})},ee=async(s,n="mon-album-photo.pdf")=>{try{const a=new X({orientation:"landscape",unit:"mm",format:"a4"}),l=297,r=210,h=15,t=l-2*h,d=r-2*h;let x=!0;for(let i=0;i<s.pages.length;i++){const p=s.pages[i];if(x||a.addPage(),x=!1,a.setFontSize(10),a.setTextColor(150,150,150),a.text(`Page ${i+1}`,l/2,r-5,{align:"center"}),p.photos.length===0){a.setFontSize(16),a.setTextColor(200,200,200),a.text("Page vide",l/2,r/2,{align:"center"});continue}await se(a,p,h,t,d)}return await oe(a,s),a.save(n),{success:!0,message:"PDF gÃ©nÃ©rÃ© avec succÃ¨s!"}}catch(a){return console.error("Erreur lors de la gÃ©nÃ©ration du PDF:",a),{success:!1,message:"Erreur lors de la gÃ©nÃ©ration du PDF: "+a.message}}},se=async(s,n,a,l,r)=>{const{layout:h,photos:t}=n;let d=[];switch(h){case"fullPage":d=[{x:a,y:a,width:l,height:r}];break;case"twoPerPage":const x=(l-10)/2;d=[{x:a,y:a,width:x,height:r},{x:a+x+10,y:a,width:x,height:r}];break;case"threePerPage":const i=l*.6-5,p=l*.4-5,N=(r-10)/2;d=[{x:a,y:a,width:i,height:r},{x:a+i+10,y:a,width:p,height:N},{x:a+i+10,y:a+N+10,width:p,height:N}];break;default:d=[{x:a,y:a,width:l,height:r}]}for(const x of t){const i=d[x.slotIndex];if(i)try{const p=await te(x.url),{finalWidth:N,finalHeight:D,offsetX:F,offsetY:k}=ae(p,i.width,i.height);s.addImage(p.data,p.format,i.x+F,i.y+k,N,D),s.setDrawColor(200,200,200),s.setLineWidth(.5),s.rect(i.x,i.y,i.width,i.height)}catch(p){console.error("Erreur lors du chargement de l'image:",p),s.setFillColor(240,240,240),s.rect(i.x,i.y,i.width,i.height,"F"),s.setTextColor(150,150,150),s.setFontSize(12),s.text("Image non disponible",i.x+i.width/2,i.y+i.height/2,{align:"center"})}}},te=s=>new Promise((n,a)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>{const r=document.createElement("canvas");r.width=l.width,r.height=l.height,r.getContext("2d").drawImage(l,0,0);const t=s.toLowerCase().includes(".png")?"PNG":"JPEG";try{const d=r.toDataURL(`image/${t.toLowerCase()}`);n({data:d,format:t,width:l.width,height:l.height})}catch(d){a(d)}},l.onerror=()=>{a(new Error("Impossible de charger l'image"))},l.src=s}),ae=(s,n,a)=>{const l=s.width/s.height,r=n/a;let h,t,d=0,x=0;return l>r?(h=n,t=n/l,x=(a-t)/2):(t=a,h=a*l,d=(n-h)/2),{finalWidth:h,finalHeight:t,offsetX:d,offsetY:x}},oe=async(s,n)=>{s.insertPage(1),s.setPage(1);const a=297,l=210;s.setFillColor(102,126,234),s.rect(0,0,a,l,"F"),s.setTextColor(255,255,255),s.setFontSize(40),s.text("Mon Album Photo",a/2,80,{align:"center"}),s.setFontSize(16),s.text("CrÃ©Ã© avec DoogyBook Premium",a/2,100,{align:"center"}),s.setFontSize(12);const r=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"});s.text(`${n.pages.length} pages â€¢ ${r}`,a/2,130,{align:"center"});const h=n.pages.reduce((t,d)=>t+d.photos.length,0);s.text(`${h} photo${h>1?"s":""}`,a/2,145,{align:"center"})},le=s=>{console.log("=== APERÃ‡U DES DONNÃ‰ES DE L'ALBUM ==="),console.log("Nombre de pages:",s.pages.length),s.pages.forEach((n,a)=>{console.log(`
Page ${a+1}:`),console.log("  Layout:",n.layout),console.log("  Photos:",n.photos.length),n.photos.forEach((l,r)=>{console.log(`    Photo ${r+1}: Slot ${l.slotIndex}`)})}),console.log(`
=== STRUCTURE COMPLÃˆTE ===`),console.log(JSON.stringify(s,null,2)),console.log("=====================================")},ne=()=>{const[s,n]=u.useState([]),[a,l]=u.useState(null),[r,h]=u.useState(!0),[t,d]=u.useState({pages:[{id:"page-1",layout:"fullPage",photos:[]},{id:"page-2",layout:"fullPage",photos:[]},{id:"page-3",layout:"fullPage",photos:[]},{id:"page-4",layout:"fullPage",photos:[]}]}),[x,i]=u.useState([]),[p,N]=u.useState(0),[D,F]=u.useState("fullPage"),[k,P]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const{data:{user:c}}=await I.auth.getUser();if(!c)return;const{data:g,error:f}=await I.from("dogs").select("id, name, breed, photo_url").eq("user_id",c.id).order("name");if(f)throw f;n(g||[]),g&&g.length===1&&l(g[0].id)}catch(c){console.error("Erreur chargement chiens:",c)}finally{h(!1)}})()},[]),u.useEffect(()=>{(async()=>{if(!a){i([]);return}try{const{data:c,error:g}=await I.from("dog_photos").select("id, photo_url, created_at").eq("dog_id",a).order("created_at",{ascending:!1});if(g)throw g;const f=(c||[]).map((S,y)=>({id:S.id,url:S.photo_url,name:`Photo ${y+1}`}));i(f)}catch(c){console.error("Erreur chargement photos:",c)}})()},[a]);const m=u.useCallback(()=>{if(x.length===0){alert("Veuillez d'abord importer des photos");return}const o=[...x].sort(()=>Math.random()-.5),c=[...t.pages];let g=0;c.forEach(f=>{const S=b(f.layout),y=[];for(let A=0;A<S&&g<o.length;A++)y.push({id:o[g].id,url:o[g].url,slotIndex:A}),g++;f.photos=y}),d({pages:c})},[x,t.pages]),b=o=>{switch(o){case"fullPage":return 1;case"twoPerPage":return 2;case"threePerPage":return 3;default:return 1}},v=u.useCallback((o,c,g)=>{const f=x.find(y=>y.id===o);if(!f)return;const S=t.pages.map(y=>{if(y.id===c){const A=b(y.layout);if(g<A){const L=y.photos.findIndex(G=>G.slotIndex===g),O=[...y.photos];return L>=0?O[L]={id:f.id,url:f.url,slotIndex:g}:O.push({id:f.id,url:f.url,slotIndex:g}),{...y,photos:O}}}return y});d({pages:S})},[x,t.pages]),$=u.useCallback((o,c)=>{const g=t.pages.map(f=>{if(f.id===o){const S=b(c),y=f.photos.slice(0,S).map((A,L)=>({...A,slotIndex:L}));return{...f,layout:c,photos:y}}return f});d({pages:g})},[t.pages]),T=u.useCallback(()=>{const o={id:`page-${Date.now()}`,layout:D,photos:[]};d(c=>({pages:[...c.pages,o]}))},[D]),R=u.useCallback(o=>{const c=t.pages.findIndex(y=>y.id===o);if(c===-1)return;const g=t.pages[c],f={...g,id:`page-${Date.now()}`,photos:[...g.photos]},S=[...t.pages];S.splice(c+1,0,f),d({pages:S})},[t.pages]),j=u.useCallback(o=>{if(t.pages.length<=1){alert("L'album doit contenir au moins une page");return}const c=t.pages.filter(g=>g.id!==o);d({pages:c}),p>=c.length&&N(c.length-1)},[t.pages,p]),C=u.useCallback((o,c)=>{const g=[...t.pages],[f]=g.splice(o,1);g.splice(c,0,f),d({pages:g})},[t.pages]),z=u.useCallback(async()=>{if(t.pages.every(c=>c.photos.length===0)){alert("Veuillez ajouter au moins une photo Ã  votre album avant de gÃ©nÃ©rer le PDF.");return}const o=document.createElement("div");o.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(102, 126, 234, 0.95);
      color: white;
      padding: 2rem 3rem;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    `,o.textContent="ðŸ“„ GÃ©nÃ©ration du PDF en cours...",document.body.appendChild(o);try{const c=await ee(t,"mon-album-photo.pdf");document.body.removeChild(o),c.success?(alert("âœ… PDF tÃ©lÃ©chargÃ© avec succÃ¨s!"),le(t)):alert("âŒ "+c.message)}catch(c){document.body.removeChild(o),alert("âŒ Erreur lors de la gÃ©nÃ©ration du PDF: "+c.message),console.error("Erreur PDF:",c)}},[t]),E=u.useCallback((o,c)=>{const g=t.pages.map(f=>f.id===o?{...f,photos:f.photos.filter(S=>S.slotIndex!==c)}:f);d({pages:g})},[t.pages]);if(r)return e.jsx("div",{className:"photo-album-creator",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})});if(!a)return e.jsxs("div",{className:"photo-album-creator",children:[e.jsx("div",{className:"album-header",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"CrÃ©ateur d'Album Photo Premium"})}),e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"max-w-2xl w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"SÃ©lectionnez un chien pour crÃ©er son album"}),e.jsx("p",{className:"text-gray-600",children:"Choisissez le chien dont vous souhaitez utiliser les photos pour crÃ©er un album PDF"})]}),s.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Vous n'avez pas encore de chien enregistrÃ©."}),e.jsx("a",{href:"/dog-profile",className:"inline-block px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Ajouter un chien"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(o=>e.jsxs("button",{onClick:()=>l(o.id),className:"flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:o.photo_url?e.jsx("img",{src:o.photo_url,alt:o.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:"ðŸ•"})}),e.jsxs("div",{className:"ml-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:o.name}),e.jsx("p",{className:"text-sm text-gray-600",children:o.breed})]})]},o.id))})]})})]});const w=s.find(o=>o.id===a);return e.jsxs("div",{className:"photo-album-creator",children:[e.jsxs("div",{className:"album-header",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800",children:["Album de ",w==null?void 0:w.name]}),e.jsx("button",{onClick:()=>l(null),className:"text-sm text-indigo-600 hover:text-indigo-700 mt-1",children:"â† Changer de chien"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{onClick:()=>P(!k),className:"btn-secondary",children:[k?"Masquer":"Afficher"," les miniatures"]}),e.jsx("button",{onClick:z,className:"btn-primary",children:"ðŸ“„ TÃ©lÃ©charger en PDF"})]})]}),e.jsxs("div",{className:"album-main-content",children:[e.jsx(K,{photos:x,onRandomFill:m,dogName:w==null?void 0:w.name}),e.jsxs("div",{className:"album-center",children:[e.jsx(Y,{pages:t.pages,currentPageIndex:p,onPageChange:N,onPhotoDrop:v,onRemovePhoto:E}),k&&e.jsx(H,{pages:t.pages,currentPageIndex:p,onPageSelect:N,onReorder:C,onDuplicate:R,onDelete:j})]}),e.jsx(Q,{currentPage:t.pages[p],selectedLayout:D,onLayoutChange:o=>{F(o),$(t.pages[p].id,o)},onAddPage:T})]})]})},be=()=>{const{user:s}=q(),{unreadCount:n}=J(),a=V(),[l,r]=u.useState(!1),[h,t]=u.useState(!1),[d,x]=u.useState(!0),[i,p]=u.useState(null),[N,D]=u.useState([]);u.useEffect(()=>{const P=localStorage.getItem("currentDogProfile");P&&p(JSON.parse(P))},[]),u.useEffect(()=>{(async()=>{if(s!=null&&s.id)try{const{data:m,error:b}=await I.from("dogs").select("*").eq("user_id",s.id).order("created_at",{ascending:!0});if(b)throw b;m&&m.length>0&&(D(m),i||(p(m[0]),localStorage.setItem("currentDogProfile",JSON.stringify(m[0]))))}catch(m){console.error("Erreur chargement chiens:",m)}})()},[s==null?void 0:s.id]),u.useEffect(()=>{F()},[s==null?void 0:s.id]);const F=async()=>{try{const{data:{user:P}}=await I.auth.getUser();if(!P){x(!1);return}const{data:m}=await I.from("user_profiles").select("subscription_tier").eq("id",P.id).single(),v=["premium","professional"].includes(m==null?void 0:m.subscription_tier);r(v),v||t(!0)}catch(P){console.error("Erreur vÃ©rification premium:",P)}finally{x(!1)}},k=P=>{p(P),localStorage.setItem("currentDogProfile",JSON.stringify(P))};return d?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground",children:"Album Photo Premium"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>a("/notifications"),className:"relative p-1.5 sm:p-2 hover:bg-muted rounded-full transition-smooth",children:[e.jsx(M,{size:20,className:"sm:w-6 sm:h-6 text-foreground"}),n>0&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center px-0.5 sm:px-1 text-[10px] sm:text-xs",children:n>9?"9+":n})]}),e.jsx(U,{dogProfiles:N,currentDog:i,onDogChange:k})]})]})})}),e.jsx(_,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground",children:"Album Photo Premium"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>a("/notifications"),className:"relative p-1.5 sm:p-2 hover:bg-muted rounded-full transition-smooth",children:[e.jsx(M,{size:20,className:"sm:w-6 sm:h-6 text-foreground"}),n>0&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center px-0.5 sm:px-1 text-[10px] sm:text-xs",children:n>9?"9+":n})]}),e.jsx(U,{dogProfiles:N,currentDog:i,onDogChange:k})]})]})})}),e.jsx(_,{}),e.jsx("main",{className:"main-content flex-1",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-heading font-bold text-foreground mb-1 sm:mb-2",children:"ðŸ“¸ Album Photo Premium"}),e.jsx("p",{className:"text-muted-foreground font-caption text-sm sm:text-base",children:"CrÃ©ez des albums photo personnalisÃ©s et tÃ©lÃ©chargez-les en PDF"})]}),l?e.jsx(ne,{}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Cette fonctionnalitÃ© est rÃ©servÃ©e aux membres Premium"}),e.jsx("button",{onClick:()=>t(!0),className:"px-6 py-3 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition-all",children:"DÃ©couvrir Premium"})]})]})}),e.jsx(B,{}),e.jsx(W,{isOpen:h,onClose:()=>t(!1),reason:"photo-album"})]})};export{be as default};
