import{j as t,I as h,u as pe,s as d}from"./index-Dh6AIfoG.js";import{d as oe,r as l}from"./vendor-react-DEK6ZklB.js";import{T as re}from"./TabNavigation-C0oTiztg.js";import{U as fe}from"./UserMenu-D6ezDJoX.js";import{B as N}from"./Button-5ltFJX9w.js";import{V as ve,T as ie,W as be,H as je,A as we,a as ne,b as Ne,E as ye,P as De}from"./PhotoGalleryModal-BRzg8nL4.js";import{C as Se}from"./CreateDogModal-D9hebzU7.js";import{F as _e}from"./Footer-D3Rbh1Fu.js";import{P as Ce}from"./PremiumModal-CTgGYOlZ.js";import{E as Fe}from"./jspdf.es.min-BIAsmWau.js";import"./vendor-ui-Bo32stKt.js";import"./vendor-supabase-DfwcnzK-.js";import"./PremiumBadge-Djjyy8Qd.js";import"./index-1Ar5VAb3.js";import"./Input-BknJyq3e.js";import"./Select-BfNcImMH.js";const Ee=({onCreateDog:c})=>{const x=oe(),C=[{icon:"Syringe",title:"Carnet de santÃ© complet",description:"Suivez vaccins, vermifuges et traitements anti-puces en un clin d'oeil",gradient:"from-blue-500 to-cyan-500"},{icon:"TrendingUp",title:"Suivi du poids",description:"Graphiques d'Ã©volution pour surveiller la santÃ© de votre compagnon",gradient:"from-purple-500 to-pink-500"},{icon:"Bell",title:"Rappels automatiques",description:"Ne manquez jamais un rendez-vous vÃ©tÃ©rinaire ou un traitement",gradient:"from-orange-500 to-red-500"},{icon:"Camera",title:"Album photos",description:"CrÃ©ez des souvenirs inoubliables avec votre chien",gradient:"from-green-500 to-emerald-500"},{icon:"Users",title:"CommunautÃ© active",description:"Partagez et Ã©changez avec d'autres propriÃ©taires de chiens",gradient:"from-indigo-500 to-purple-500"},{icon:"FileText",title:"Export PDF",description:"Exportez le carnet de santÃ© complet pour vos visites vÃ©tÃ©rinaires",gradient:"from-teal-500 to-cyan-500"}],F=[{value:"10,000+",label:"Chiens enregistrÃ©s"},{value:"50,000+",label:"Vaccins suivis"},{value:"98%",label:"Satisfaction"}];return t.jsxs("div",{className:"min-h-[calc(100vh-73px)] bg-gradient-to-b from-blue-50 via-purple-50/30 to-white",children:[t.jsxs("section",{className:"container mx-auto px-4 pt-8 sm:pt-12 pb-8 text-center",children:[t.jsx("div",{className:"mb-6 flex justify-center",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full blur-2xl opacity-20 animate-pulse"}),t.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-purple-600 rounded-full p-8 shadow-2xl",children:t.jsx(h,{name:"Dog",size:64,color:"white",strokeWidth:2})}),t.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"Gratuit"}),t.jsx("div",{className:"absolute -bottom-2 -left-2 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"100% SÃ©curisÃ©"})]})}),t.jsxs("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-heading font-bold text-gray-900 mb-4 leading-tight",children:["Bienvenue sur ",t.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"DoogyBook"})," !"]}),t.jsx("p",{className:"text-base sm:text-lg lg:text-xl text-gray-600 max-w-2xl mx-auto mb-8 leading-relaxed",children:"Le carnet de santÃ© digital qui simplifie le suivi mÃ©dical de votre compagnon Ã  quatre pattes"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center mb-6",children:[t.jsx(N,{size:"lg",className:"px-8 shadow-lg hover:shadow-xl transition-all bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 min-h-[48px] text-base font-semibold",onClick:c,iconName:"Plus",children:"CrÃ©er le profil de mon chien"}),t.jsx(N,{size:"lg",variant:"outline",className:"px-8 min-h-[48px] text-base border-2",onClick:()=>x("/social-feed"),iconName:"Users",children:"DÃ©couvrir la communautÃ©"})]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Sans engagement â€¢ Sans carte bancaire â€¢ Sans publicitÃ©"})]}),t.jsx("section",{className:"container mx-auto px-4 py-6",children:t.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 max-w-3xl mx-auto",children:t.jsx("div",{className:"grid grid-cols-3 gap-4 divide-x divide-gray-200",children:F.map((f,g)=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:f.value}),t.jsx("div",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:f.label})]},g))})})}),t.jsxs("section",{className:"container mx-auto px-4 py-8 sm:py-12",children:[t.jsx("h2",{className:"text-2xl sm:text-3xl font-heading font-bold text-center text-gray-900 mb-3",children:"Tout ce dont vous avez besoin"}),t.jsx("p",{className:"text-center text-gray-600 mb-8 max-w-2xl mx-auto",children:"Une suite complÃ¨te d'outils pour prendre soin de la santÃ© de votre chien"}),t.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 max-w-6xl mx-auto",children:C.map((f,g)=>t.jsxs("div",{className:"group bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-gray-100 hover:border-transparent hover:-translate-y-1",children:[t.jsx("div",{className:`w-14 h-14 bg-gradient-to-br ${f.gradient} rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300`,children:t.jsx(h,{name:f.icon,size:28,color:"white",strokeWidth:2})}),t.jsx("h3",{className:"font-heading font-semibold text-gray-900 mb-2 text-lg",children:f.title}),t.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:f.description})]},g))})]}),t.jsx("section",{className:"container mx-auto px-4 py-12 pb-16",children:t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl shadow-2xl p-8 sm:p-12 text-center text-white max-w-4xl mx-auto",children:[t.jsx("h2",{className:"text-2xl sm:text-3xl font-heading font-bold mb-4",children:"PrÃªt Ã  commencer ?"}),t.jsx("p",{className:"text-blue-100 text-lg mb-6 max-w-2xl mx-auto",children:"Rejoignez des milliers de propriÃ©taires qui font dÃ©jÃ  confiance Ã  DoogyBook"}),t.jsx(N,{size:"xl",className:"bg-white text-blue-600 hover:bg-gray-100 shadow-xl hover:shadow-2xl transition-all font-semibold px-10",onClick:c,iconName:"Sparkles",children:"Commencer gratuitement"}),t.jsxs("div",{className:"flex items-center justify-center gap-3 mt-8",children:[t.jsx("div",{className:"flex -space-x-3",children:[1,2,3,4].map(f=>t.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-400 border-2 border-white flex items-center justify-center",children:t.jsx(h,{name:"Dog",size:20,color:"white"})},f))}),t.jsxs("p",{className:"text-sm text-blue-100",children:[t.jsx("strong",{className:"text-white",children:"10 000+"})," propriÃ©taires nous font confiance"]})]})]})})]})},ze=(c,x=800,C=75)=>{if(!c)return null;if(c.includes("supabase.co")&&c.includes("storage/v1/object/public")){const F=c.includes("?")?"&":"?";return`${c}${F}width=${x}&quality=${C}&format=webp`}return c},q=l.memo(({src:c,alt:x,width:C=800,quality:F=75,className:f="",eager:g=!1})=>{const[L,U]=l.useState(!1),[_,z]=l.useState(!1);return t.jsxs("div",{className:"relative w-full h-full",children:[!L&&!_&&t.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),_?t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-100 to-purple-100",children:t.jsx("span",{className:"text-4xl font-bold text-primary/30",children:x==null?void 0:x.charAt(0).toUpperCase()})}):t.jsx("img",{src:ze(c,C,F),alt:x,loading:g?"eager":"lazy",decoding:"async",onLoad:()=>U(!0),onError:()=>z(!0),className:`${f} ${L?"opacity-100":"opacity-0"} transition-opacity duration-300`})]})});q.displayName="OptimizedImage";const Ye=()=>{oe();const{user:c}=pe(),[x,C]=l.useState("vaccinations"),[F,f]=l.useState(!0),[g,L]=l.useState(!1),[U,_]=l.useState(!1),[z,V]=l.useState(!1),[Te,I]=l.useState([]),[r,P]=l.useState(null),[k,O]=l.useState([]),[A,M]=l.useState([]),[T,W]=l.useState([]),[j,B]=l.useState({allergies:"",medications:"",veterinaryNotes:"",veterinarian:"",veterinarianPhone:""}),[D,G]=l.useState([]),[H,Y]=l.useState(!1),[E,$]=l.useState({vaccination:!1,vermifuge:!1,flea:!1,weight:!1,editProfile:!1,gallery:!1,createDog:!1}),[y,J]=l.useState(null);l.useEffect(()=>{(async()=>{if(c!=null&&c.id)try{const{data:a}=await d.from("user_profiles").select("subscription_tier").eq("id",c.id).single();L(["premium","professional"].includes(a==null?void 0:a.subscription_tier))}catch(a){console.error("Erreur vÃ©rification premium:",a)}})()},[c==null?void 0:c.id]),l.useEffect(()=>{if(!(c!=null&&c.id))return;(async()=>{f(!0);try{const{data:a,error:n}=await d.from("dogs").select("id, name, breed, birth_date, weight, gender, is_sterilized, photo_url, microchip_number, notes, cover_photo_url").eq("user_id",c.id).eq("is_active",!0).order("created_at",{ascending:!1}).limit(10);if(n)throw n;const i=a.map(s=>{const o=new Date(s.birth_date),m=new Date;let w=m.getFullYear()-o.getFullYear();const S=m.getMonth()-o.getMonth();return(S<0||S===0&&m.getDate()<o.getDate())&&w--,{id:s.id,name:s.name,breed:s.breed||"Race inconnue",age:w>0?`${w} an${w>1?"s":""}`:"Moins d'un an",weight:s.weight?`${s.weight} kg`:"Non renseignÃ©",gender:s.gender||"Non renseignÃ©",sterilized:s.is_sterilized?"StÃ©rilisÃ©":"Non stÃ©rilisÃ©",image:s.photo_url||"https://images.pexels.com/photos/1490908/pexels-photo-1490908.jpeg",imageAlt:`${s.name} - ${s.breed}`,microchip_number:s.microchip_number,notes:s.notes,cover_photo_url:s.cover_photo_url||null,birth_date:s.birth_date}});I(i),i.length>0&&P(i[0])}catch(a){console.error("Erreur chargement chiens:",a)}finally{f(!1)}})()},[c==null?void 0:c.id]),l.useEffect(()=>{if(!(r!=null&&r.id))return;(async()=>{try{const{data:a,error:n}=await d.from("vaccinations").select("id, vaccine_name, vaccination_date, next_due_date, veterinarian, notes").eq("dog_id",r.id).order("next_due_date",{ascending:!0}).limit(50);if(n)throw n;const i=a.map(s=>({id:s.id,name:s.vaccine_name,lastDate:new Date(s.vaccination_date).toLocaleDateString("fr-FR"),nextDate:s.next_due_date?new Date(s.next_due_date).toLocaleDateString("fr-FR"):"Non dÃ©fini",veterinarian:s.veterinarian,notes:s.notes}));O(i)}catch(a){console.error("Erreur chargement vaccinations:",a)}})()},[r==null?void 0:r.id]),l.useEffect(()=>{if(!(r!=null&&r.id))return;(async()=>{try{const{data:a,error:n}=await d.from("treatments").select("id, product_name, treatment_date, next_due_date, notes, treatment_type").eq("dog_id",r.id).order("next_due_date",{ascending:!0}).limit(50);if(n)throw n;const i=a.map(s=>({id:s.id,product:s.product_name,lastDate:new Date(s.treatment_date).toLocaleDateString("fr-FR"),nextDate:s.next_due_date?new Date(s.next_due_date).toLocaleDateString("fr-FR"):"Non dÃ©fini",notes:s.notes,type:s.treatment_type}));M(i)}catch(a){console.error("Erreur chargement traitements:",a)}})()},[r==null?void 0:r.id]),l.useEffect(()=>{if(!(r!=null&&r.id))return;(async()=>{try{const{data:a,error:n}=await d.from("weight_records").select("measurement_date, weight").eq("dog_id",r.id).order("measurement_date",{ascending:!0}).limit(100);if(n)throw n;const i=a.map(s=>({date:new Date(s.measurement_date).toLocaleDateString("fr-FR"),weight:parseFloat(s.weight)}));W(i)}catch(a){console.error("Erreur chargement poids:",a)}})()},[r==null?void 0:r.id]),l.useEffect(()=>{if(!(r!=null&&r.id))return;(async()=>{var a,n,i;try{const{data:s,error:o}=await d.from("health_notes").select("description, tags, title").eq("dog_id",r.id).order("note_date",{ascending:!1}).limit(1);if(o)throw o;if(s&&s.length>0){const m=s[0];B({allergies:(a=m.tags)!=null&&a.includes("allergies")?m.description:"",medications:(n=m.tags)!=null&&n.includes("medications")?m.description:"",veterinaryNotes:m.description||"",veterinarian:(i=m.tags)!=null&&i.includes("vet")?m.title:"",veterinarianPhone:""})}}catch(s){console.error("Erreur chargement notes santÃ©:",s)}})()},[r==null?void 0:r.id]),l.useEffect(()=>{if(!(r!=null&&r.id))return;(async()=>{try{const{data:a,error:n}=await d.from("dog_photos").select("id, photo_url, created_at").eq("dog_id",r.id).order("created_at",{ascending:!1}).limit(50);if(n)throw n;G(a||[])}catch(a){console.error("Erreur chargement photos:",a)}})()},[r==null?void 0:r.id]);const v=l.useCallback((e,a=null)=>{J(a),$(n=>({...n,[e]:!0}))},[]),b=l.useCallback(e=>{$(a=>({...a,[e]:!1})),J(null)},[]),le=l.useCallback(async e=>{try{if(y){const{error:a}=await d.from("vaccinations").update({vaccine_name:e.name,vaccination_date:new Date(e.lastDate).toISOString().split("T")[0],next_due_date:e.nextDate?new Date(e.nextDate).toISOString().split("T")[0]:null,veterinarian:e.veterinarian,notes:e.notes}).eq("id",y.id);if(a)throw a;O(n=>n.map(i=>i.id===y.id?{...e,id:i.id}:i))}else{const{data:a,error:n}=await d.from("vaccinations").insert([{dog_id:r.id,vaccine_name:e.name,vaccination_date:new Date(e.lastDate).toISOString().split("T")[0],next_due_date:e.nextDate?new Date(e.nextDate).toISOString().split("T")[0]:null,veterinarian:e.veterinarian,notes:e.notes}]).select().single();if(n)throw n;O(i=>[...i,{id:a.id,name:e.name,lastDate:new Date(e.lastDate).toLocaleDateString("fr-FR"),nextDate:e.nextDate?new Date(e.nextDate).toLocaleDateString("fr-FR"):"Non dÃ©fini",veterinarian:e.veterinarian,notes:e.notes}])}b("vaccination")}catch(a){console.error("Erreur sauvegarde vaccination:",a),alert("Erreur lors de la sauvegarde de la vaccination")}},[y,r,b]),ce=l.useCallback(async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette vaccination ?"))try{const{error:a}=await d.from("vaccinations").delete().eq("id",e);if(a)throw a;O(n=>n.filter(i=>i.id!==e))}catch(a){console.error("Erreur suppression vaccination:",a),alert("Erreur lors de la suppression")}},[]),K=l.useCallback(async(e,a)=>{try{const n=a==="vermifuge"?"worm":"flea";if(y){const{error:i}=await d.from("treatments").update({product_name:e.product,treatment_date:new Date(e.lastDate).toISOString().split("T")[0],next_due_date:e.nextDate?new Date(e.nextDate).toISOString().split("T")[0]:null,notes:e.notes,treatment_type:n}).eq("id",y.id);if(i)throw i;M(s=>s.map(o=>o.id===y.id?{...e,id:o.id,type:n}:o))}else{const{data:i,error:s}=await d.from("treatments").insert([{dog_id:r.id,product_name:e.product,treatment_date:new Date(e.lastDate).toISOString().split("T")[0],next_due_date:e.nextDate?new Date(e.nextDate).toISOString().split("T")[0]:null,notes:e.notes,treatment_type:n}]).select().single();if(s)throw s;M(o=>[...o,{id:i.id,product:e.product,lastDate:new Date(e.lastDate).toLocaleDateString("fr-FR"),nextDate:e.nextDate?new Date(e.nextDate).toLocaleDateString("fr-FR"):"Non dÃ©fini",notes:e.notes,type:n}])}b(a)}catch(n){console.error("Erreur sauvegarde traitement:",n),alert("Erreur lors de la sauvegarde du traitement")}},[y,r,b]),Q=l.useCallback(async e=>{if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce traitement ?"))try{const{error:a}=await d.from("treatments").delete().eq("id",e);if(a)throw a;M(n=>n.filter(i=>i.id!==e))}catch(a){console.error("Erreur suppression traitement:",a),alert("Erreur lors de la suppression")}},[]),de=l.useCallback(async e=>{try{const{data:a,error:n}=await d.from("weight_records").insert([{dog_id:r.id,weight:parseFloat(e.weight),measurement_date:new Date(e.date).toISOString().split("T")[0]}]).select().single();if(n)throw n;W(i=>[...i,{date:new Date(e.date).toLocaleDateString("fr-FR"),weight:parseFloat(e.weight)}]),b("weight")}catch(a){console.error("Erreur sauvegarde poids:",a),alert("Erreur lors de la sauvegarde du poids")}},[r,b]),me=l.useCallback(async e=>{try{const{error:a}=await d.from("dogs").update({name:e.name,breed:e.breed,gender:e.gender,weight:parseFloat(e.weight.replace(" kg","")),is_sterilized:e.sterilized==="StÃ©rilisÃ©",notes:e.notes,microchip_number:e.microchip_number}).eq("id",r.id);if(a)throw a;P(e),I(n=>n.map(i=>i.id===r.id?e:i)),b("editProfile")}catch(a){console.error("Erreur sauvegarde profil:",a),alert("Erreur lors de la sauvegarde du profil")}},[r,b]),ue=l.useCallback(async e=>{try{const{error:a}=await d.from("dogs").update({photo_url:e}).eq("id",r.id);if(a)throw a;P(n=>({...n,image:e})),I(n=>n.map(i=>i.id===r.id?{...i,image:e}:i))}catch(a){console.error("Erreur mise Ã  jour photo de profil:",a),alert("âŒ Erreur lors de la mise Ã  jour de la photo de profil")}},[r]),he=l.useCallback(async e=>{var i;const a=(i=e.target.files)==null?void 0:i[0];if(!a)return;if(!a.name||typeof a.name!="string"){alert("âš ï¸ Fichier invalide");return}if(a.size>5*1024*1024){alert("âš ï¸ L'image est trop volumineuse (max 5MB)");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(a.type)){alert("âš ï¸ Format non supportÃ©. Utilisez JPG, PNG ou WEBP");return}Y(!0);try{const s=a.name.split(".").pop().toLowerCase(),o=`${c.id}/${r.id}/cover_${Date.now()}.${s}`,{error:m}=await d.storage.from("dog-photos").upload(o,a,{contentType:a.type,cacheControl:"3600",upsert:!1});if(m){if(m.message.includes("Bucket not found")){alert(`âš ï¸ Le bucket de stockage n'existe pas.

ðŸ“‹ Instructions:
1. Va dans Supabase > Storage
2. CrÃ©e un bucket "dog-photos"
3. Coche "Public bucket"
4. RÃ©essaye`);return}throw m}const{data:{publicUrl:w}}=d.storage.from("dog-photos").getPublicUrl(o),{error:S}=await d.from("dogs").update({cover_photo_url:w}).eq("id",r.id);if(S)throw S;P(u=>({...u,cover_photo_url:w})),I(u=>u.map(p=>p.id===r.id?{...p,cover_photo_url:w}:p)),alert("âœ… Photo de couverture mise Ã  jour !"),e.target.value=""}catch(s){console.error("Erreur upload cover:",s),alert("âŒ Erreur lors de l'upload: "+s.message)}finally{Y(!1)}},[c,r]),xe=l.useCallback(async e=>{if(!e){alert("âš ï¸ Aucun fichier sÃ©lectionnÃ©");return}if(!g&&D.length>=5){_(!0);return}if(!e.name||typeof e.name!="string"){alert("âš ï¸ Fichier invalide");return}if(e.size>5*1024*1024){alert("âš ï¸ L'image est trop volumineuse (max 5MB)");return}if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)){alert("âš ï¸ Format non supportÃ©. Utilisez JPG, PNG ou WEBP");return}try{const n=e.name.split(".").pop().toLowerCase(),i=`${c.id}/${r.id}/${Date.now()}.${n}`,{error:s}=await d.storage.from("dog-photos").upload(i,e,{contentType:e.type,cacheControl:"3600",upsert:!1});if(s){if(s.message.includes("Bucket not found")){alert(`âš ï¸ Le bucket de stockage n'existe pas.

ðŸ“‹ Instructions:
1. Va dans Supabase > Storage
2. CrÃ©e un bucket "dog-photos"
3. Coche "Public bucket"
4. RÃ©essaye`);return}throw s}const{data:{publicUrl:o}}=d.storage.from("dog-photos").getPublicUrl(i),{data:m,error:w}=await d.from("dog_photos").insert([{dog_id:r.id,photo_url:o,created_at:new Date().toISOString()}]).select().single();if(w){if(w.message.includes('relation "dog_photos" does not exist')){alert(`âš ï¸ La table dog_photos n'existe pas.

ðŸ“‹ ExÃ©cute le SQL:
CREATE TABLE dog_photos (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  dog_id UUID REFERENCES dogs(id) ON DELETE CASCADE,
  photo_url TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);`);return}throw w}G(S=>[m,...S]),alert("âœ… Photo ajoutÃ©e avec succÃ¨s !")}catch(n){console.error("Erreur upload photo:",n),alert("âŒ Erreur lors de l'upload: "+n.message)}},[c,r,g,D.length]),X=e=>{if(!e)return"";let a=e.normalize("NFD");return a=a.replace(/[\u0300-\u036f]/g,""),a=a.replace(/Å“/g,"oe").replace(/Ã¦/g,"ae").replace(/Å’/g,"OE").replace(/Ã†/g,"AE").replace(/[â‚¬Â£$Â¥]/g,"").replace(/[Â«Â»]/g,"").replace(/[^a-zA-Z0-9\s.,;:!?()\-'"\/&@#%+=_]/g," "),a=a.replace(/\s+/g," "),a=a.trim(),a},Z=l.useCallback(async()=>{if(!g){_(!0);return}V(!0);try{const e=new Fe({orientation:"p",unit:"mm",format:"a4",compress:!0}),a=e.internal.pageSize.getWidth(),n=e.internal.pageSize.getHeight(),i=20;let s=i;const o=(u,p,se,ae={})=>{try{const R=String(u||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x00-\x7F]/g,"");e.text(R,p,se,ae)}catch(R){console.error("Erreur ajout texte:",R),e.text("Error",p,se,ae)}};e.setFillColor(59,130,246),e.rect(0,0,a,50,"F"),e.setTextColor(255,255,255),e.setFontSize(28),e.setFont("helvetica","bold"),o("WOOFLY",i,25),e.setFontSize(14),e.setFont("helvetica","normal"),o("Carnet de Sante",i,38),s=60,e.setTextColor(0,0,0),e.setFontSize(22),e.setFont("helvetica","bold"),o(r.name,i,s),s+=10,e.setFontSize(11),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const m=r.gender==="male"?"Male":"Femelle";o(`${r.breed} - ${r.age} - ${m}`,i,s),s+=6,r.weight!=="Non renseigne"&&(o(`Poids: ${r.weight}`,i,s),s+=6),r.microchip_number&&(o(`Puce: ${r.microchip_number}`,i,s),s+=6),o(`Sterilisation: ${r.sterilized}`,i,s),s+=15,e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),o("VACCINATIONS",i,s),s+=8,k.length===0?(e.setFontSize(10),e.setFont("helvetica","italic"),e.setTextColor(150,150,150),o("Aucune vaccination enregistree",i+5,s),s+=10):(e.setFontSize(10),e.setFont("helvetica","normal"),k.forEach(u=>{s>n-40&&(e.addPage(),s=i),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),o(`- ${u.name}`,i+5,s),s+=5,e.setFont("helvetica","normal"),e.setTextColor(80,80,80),o(`  Derniere date: ${u.lastDate}`,i+5,s),s+=5,o(`  Prochaine date: ${u.nextDate}`,i+5,s),s+=5,u.veterinarian&&(o(`  Veterinaire: ${u.veterinarian}`,i+5,s),s+=5),s+=3})),s+=8,s>n-60&&(e.addPage(),s=i),e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),o("TRAITEMENTS",i,s),s+=8,A.length===0?(e.setFontSize(10),e.setFont("helvetica","italic"),e.setTextColor(150,150,150),o("Aucun traitement enregistre",i+5,s),s+=10):(e.setFontSize(10),e.setFont("helvetica","normal"),A.forEach(u=>{s>n-40&&(e.addPage(),s=i);const p=u.type==="worm"?"Vermifuge":"Anti-puces/tiques";e.setFont("helvetica","bold"),e.setTextColor(0,0,0),o(`- ${u.product} (${p})`,i+5,s),s+=5,e.setFont("helvetica","normal"),e.setTextColor(80,80,80),o(`  Derniere date: ${u.lastDate}`,i+5,s),s+=5,o(`  Prochaine date: ${u.nextDate}`,i+5,s),s+=8})),s+=8,s>n-60&&(e.addPage(),s=i),e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),o("EVOLUTION DU POIDS",i,s),s+=8,T.length===0?(e.setFontSize(10),e.setFont("helvetica","italic"),e.setTextColor(150,150,150),o("Aucune pesee enregistree",i+5,s),s+=10):(e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(80,80,80),T.slice(-5).forEach(p=>{o(`- ${p.date}: ${p.weight} kg`,i+5,s),s+=5}),T.length>5&&(s+=3,e.setFont("helvetica","italic"),o(`(${T.length-5} autres pesees non affichees)`,i+5,s))),s+=12,s>n-80&&(e.addPage(),s=i),e.setFontSize(16),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),o("NOTES MEDICALES",i,s),s+=8,e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(80,80,80),j.allergies&&(e.setFont("helvetica","bold"),o("Allergies:",i+5,s),s+=5,e.setFont("helvetica","normal"),e.splitTextToSize(X(j.allergies),a-i*2-10).forEach(p=>{o(p,i+5,s),s+=5}),s+=5),j.medications&&(e.setFont("helvetica","bold"),o("Medicaments:",i+5,s),s+=5,e.setFont("helvetica","normal"),e.splitTextToSize(X(j.medications),a-i*2-10).forEach(p=>{o(p,i+5,s),s+=5}),s+=5),j.veterinarian&&(e.setFont("helvetica","bold"),o("Veterinaire:",i+5,s),s+=5,e.setFont("helvetica","normal"),o(j.veterinarian,i+5,s),s+=5),j.veterinarianPhone&&(o(`Telephone: ${j.veterinarianPhone}`,i+5,s),s+=5),!j.allergies&&!j.medications&&!j.veterinarian&&(e.setFont("helvetica","italic"),e.setTextColor(150,150,150),o("Aucune note medicale enregistree",i+5,s)),e.setTextColor(150,150,150),e.setFontSize(8),o("Genere avec Woofly - www.doogybook.com",a/2,n-10,{align:"center"}),o(`Date: ${new Date().toLocaleDateString("fr-FR")}`,a-i,n-10,{align:"right"});const S=`carnet-sante-${r.name.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,"-")}-${new Date().toISOString().split("T")[0]}.pdf`;e.save(S),alert("Carnet de sante telecharge avec succes !")}catch(e){console.error("Erreur generation PDF:",e),alert("Erreur lors de la generation du PDF: "+e.message)}finally{V(!1)}},[g,r,k,A,T,j]);l.useCallback(e=>{P(e)},[]);const ge=[{id:"vaccinations",label:"Vaccinations",icon:"Syringe"},{id:"vermifuge",label:"Vermifuge",icon:"Pill"},{id:"flea",label:"Anti-puces",icon:"Bug"},{id:"weight",label:"Poids",icon:"TrendingUp"},{id:"photos",label:"Photos",icon:"Camera"},{id:"notes",label:"Notes mÃ©dicales",icon:"FileText"}],ee=A.filter(e=>e.type==="worm"),te=A.filter(e=>e.type==="flea"||e.type==="tick");return F?t.jsx("div",{className:"min-h-[100dvh] sm:min-h-screen bg-background flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:"Chargement du profil..."})]})}):r?t.jsxs("div",{className:"min-h-[100dvh] sm:min-h-screen bg-background flex flex-col",children:[t.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft px-3 sm:px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("h1",{className:"text-lg sm:text-xl font-heading font-semibold text-foreground truncate flex-1",children:r.name}),t.jsx("button",{onClick:Z,disabled:z,className:"hidden sm:flex items-center gap-2 px-3 sm:px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-medium hover:shadow-lg transition-all disabled:opacity-50 min-h-[44px] text-sm",children:z?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),t.jsx("span",{children:"Export..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(h,{name:"Download",size:16}),t.jsx("span",{children:"Carnet PDF"})]})}),t.jsx(fe,{})]})}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"relative h-32 sm:h-40 bg-gradient-to-br from-blue-500 to-purple-600 overflow-hidden",children:[r.cover_photo_url?t.jsx(q,{src:r.cover_photo_url,alt:`Couverture de ${r.name}`,width:1200,quality:85,eager:!0,className:"w-full h-full object-cover"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30",children:t.jsx(h,{name:"Image",size:24})}),t.jsxs("label",{htmlFor:"cover-photo-upload-input",className:"absolute bottom-2 sm:bottom-3 right-2 sm:right-3 z-10 bg-white/90 hover:bg-white px-2.5 sm:px-3 py-2 rounded-lg cursor-pointer shadow-lg transition-smooth flex items-center gap-1.5 sm:gap-2 min-h-[44px]",children:[t.jsx(h,{name:"Camera",size:16}),t.jsx("span",{className:"font-medium text-xs sm:text-sm",children:H?"Upload...":"Modifier"}),t.jsx("input",{id:"cover-photo-upload-input",type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:he,className:"hidden",disabled:H})]})]}),t.jsx("div",{className:"relative max-w-7xl mx-auto px-3 sm:px-4",children:t.jsxs("div",{className:"flex items-end gap-3 sm:gap-4 -mt-10 sm:-mt-12 pb-3 sm:pb-4",children:[t.jsxs("div",{className:"relative flex-shrink-0",children:[t.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 rounded-full border-4 border-card bg-gradient-to-br from-blue-500 to-purple-600 overflow-hidden shadow-xl",children:t.jsx(q,{src:r.image,alt:r.name,width:200,quality:80,eager:!0,className:"w-full h-full object-cover"})}),t.jsx("button",{onClick:()=>v("gallery"),className:"absolute bottom-0 right-0 bg-primary hover:bg-primary/90 text-white p-1.5 sm:p-2 rounded-full cursor-pointer shadow-lg transition-smooth min-w-[36px] min-h-[36px] flex items-center justify-center",children:t.jsx(h,{name:"Camera",size:14,className:"sm:w-4 sm:h-4"})})]}),t.jsxs("div",{className:"flex-1 pb-1 min-w-0",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-heading font-bold text-foreground truncate",children:r.name}),t.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-1.5 text-muted-foreground text-xs mt-1",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(h,{name:"Dog",size:12}),t.jsx("span",{className:"truncate max-w-[100px] sm:max-w-none",children:r.breed})]}),t.jsx("span",{className:"text-gray-300",children:"â€¢"}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(h,{name:"Calendar",size:12}),t.jsx("span",{className:"whitespace-nowrap",children:r.age})]}),t.jsx("span",{className:"text-gray-300",children:"â€¢"}),t.jsx("span",{className:"flex items-center gap-1",children:r.gender==="male"?t.jsxs(t.Fragment,{children:[t.jsx(h,{name:"Mars",size:12}),t.jsx("span",{children:"MÃ¢le"})]}):t.jsxs(t.Fragment,{children:[t.jsx(h,{name:"Venus",size:12}),t.jsx("span",{children:"Femelle"})]})})]})]})]})})]}),t.jsx(re,{}),t.jsx("main",{className:"main-content flex-1 pb-20",children:t.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:t.jsx("div",{className:"mt-3 sm:mt-4",children:t.jsxs("div",{className:"bg-card rounded-lg shadow-soft overflow-hidden",children:[t.jsx("div",{className:"border-b border-border overflow-x-auto",children:t.jsx("div",{className:"flex min-w-max px-2",children:ge.map(e=>t.jsxs("button",{onClick:()=>C(e.id),className:`flex items-center gap-2 px-3 sm:px-4 py-3 font-medium transition-smooth border-b-2 text-xs sm:text-sm min-h-[44px] ${x===e.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[t.jsx(h,{name:e.icon,size:16,className:"sm:w-[18px] sm:h-[18px]"}),t.jsx("span",{className:"whitespace-nowrap",children:e.label})]},e.id))})}),t.jsxs("div",{className:"p-3 sm:p-4",children:[x==="vaccinations"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col items-start justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base sm:text-lg font-heading font-semibold text-foreground mb-1",children:"Vaccinations"}),t.jsxs("p",{className:"text-xs text-muted-foreground font-caption",children:["GÃ©rez le calendrier vaccinal de ",r.name]})]}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("vaccination"),size:"sm",className:"w-full min-h-[44px]",children:"Ajouter une vaccination"})]}),k.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(h,{name:"Syringe",size:24,color:"var(--color-muted-foreground)"})}),t.jsx("p",{className:"text-sm text-muted-foreground font-caption mb-4",children:"Aucune vaccination enregistrÃ©e"}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("vaccination"),size:"sm",className:"w-full min-h-[44px]",children:"Ajouter une vaccination"})]}):t.jsx("div",{className:"grid grid-cols-1 gap-3",children:k.map(e=>t.jsx(ve,{vaccination:e,onEdit:a=>v("vaccination",a),onDelete:ce},e.id))})]}),x==="vermifuge"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col items-start justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base sm:text-lg font-heading font-semibold text-foreground mb-1",children:"Vermifuge"}),t.jsx("p",{className:"text-xs text-muted-foreground font-caption",children:"Suivez les traitements antiparasitaires internes"})]}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("vermifuge"),size:"sm",className:"w-full min-h-[44px]",children:"Ajouter un traitement"})]}),ee.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(h,{name:"Pill",size:24,color:"var(--color-muted-foreground)"})}),t.jsx("p",{className:"text-sm text-muted-foreground font-caption mb-4",children:"Aucun traitement vermifuge enregistrÃ©"}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("vermifuge"),size:"sm",className:"w-full min-h-[44px]",children:"Ajouter un traitement"})]}):t.jsx("div",{className:"grid grid-cols-1 gap-3",children:ee.map(e=>t.jsx(ie,{treatment:e,type:"vermifuge",onEdit:a=>v("vermifuge",a),onDelete:a=>Q(a)},e.id))})]}),x==="flea"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col items-start justify-between gap-3 mb-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-base sm:text-lg font-heading font-semibold text-foreground mb-1",children:"Anti-puces et tiques"}),t.jsx("p",{className:"text-xs text-muted-foreground font-caption",children:"GÃ©rez les traitements antiparasitaires externes"})]}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("flea"),size:"sm",className:"w-full min-h-[44px]",children:"Ajouter un traitement"})]}),te.length===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(h,{name:"Bug",size:24,color:"var(--color-muted-foreground)"})}),t.jsx("p",{className:"text-sm text-muted-foreground font-caption mb-4",children:"Aucun traitement anti-puces enregistrÃ©"}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("flea"),size:"sm",className:"w-full min-h-[44px]",children:"Ajouter un traitement"})]}):t.jsx("div",{className:"grid grid-cols-1 gap-3",children:te.map(e=>t.jsx(ie,{treatment:e,type:"flea",onEdit:a=>v("flea",a),onDelete:a=>Q(a)},e.id))})]}),x==="weight"&&t.jsx(be,{data:T,onAddWeight:()=>v("weight")}),x==="photos"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col items-start justify-between gap-3 mb-4",children:[t.jsxs("div",{className:"flex-1 w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h3",{className:"text-base sm:text-lg font-heading font-semibold text-foreground",children:"Album Photos"}),!g&&t.jsxs("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:[D.length,"/5 photos"]})]}),t.jsx("p",{className:"text-xs text-muted-foreground font-caption",children:g?`GÃ©rez les photos de ${r.name} (illimitÃ©)`:`GÃ©rez les photos de ${r.name} (5 max en version gratuite)`})]}),t.jsx(N,{variant:"default",iconName:"Plus",iconPosition:"left",onClick:()=>v("gallery"),className:"w-full sm:w-auto",disabled:!g&&D.length>=5,children:!g&&D.length>=5?"Limite atteinte":"Ajouter une photo"})]}),D.length===0?t.jsxs("div",{className:"text-center py-12 bg-muted/30 rounded-lg border-2 border-dashed border-border",children:[t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center",children:t.jsx(h,{name:"Camera",size:32,className:"text-muted-foreground"})})}),t.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Aucune photo pour le moment"}),t.jsx(N,{variant:"outline",iconName:"Plus",onClick:()=>v("gallery"),children:"Ajouter votre premiÃ¨re photo"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:D.map(e=>t.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-muted cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>v("gallery"),children:t.jsx(q,{src:e.photo_url,alt:`Photo de ${r.name}`,width:400,quality:80,className:"w-full h-full object-cover"})},e.id))}),!g&&D.length>=5&&t.jsx("div",{className:"mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(h,{name:"Lock",size:20,className:"text-orange-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-semibold text-orange-900 mb-1",children:"Limite de photos atteinte"}),t.jsx("p",{className:"text-xs text-orange-700 mb-3",children:"Vous avez atteint la limite de 5 photos en version gratuite. Passez Ã  Premium pour ajouter des photos illimitÃ©es !"}),t.jsx(N,{variant:"default",size:"sm",iconName:"Sparkles",onClick:()=>_(!0),className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:"Passer Ã  Premium"})]})]})})]})]}),x==="notes"&&t.jsx(je,{notes:j,onSave:B})]})]})})})}),t.jsx("button",{onClick:Z,disabled:z,className:"sm:hidden fixed bottom-20 right-3 sm:right-4 z-40 w-14 h-14 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-full shadow-lg flex items-center justify-center disabled:opacity-50",children:z?t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}):t.jsx(h,{name:"Download",size:22})}),t.jsx(we,{isOpen:E.vaccination,onClose:()=>b("vaccination"),onSave:le,editData:y}),t.jsx(ne,{isOpen:E.vermifuge,onClose:()=>b("vermifuge"),onSave:e=>K(e,"vermifuge"),editData:y,type:"vermifuge"}),t.jsx(ne,{isOpen:E.flea,onClose:()=>b("flea"),onSave:e=>K(e,"flea"),editData:y,type:"flea"}),t.jsx(Ne,{isOpen:E.weight,onClose:()=>b("weight"),onSave:de}),t.jsx(ye,{isOpen:E.editProfile,onClose:()=>b("editProfile"),onSave:me,profile:r}),t.jsx(De,{isOpen:E.gallery,onClose:()=>b("gallery"),photos:D,onAddPhoto:xe,currentProfilePhotoUrl:r==null?void 0:r.image,onSetProfilePhoto:ue,isPremium:g,onShowPremiumModal:()=>_(!0)}),t.jsx(Ce,{isOpen:U,onClose:()=>_(!1),reason:"health-pdf"}),t.jsx(_e,{})]}):t.jsxs("div",{className:"min-h-[100dvh] sm:min-h-screen bg-background",children:[t.jsx(re,{}),t.jsx(Ee,{onCreateDog:()=>{console.log("ðŸ• Ouverture modal CreateDog"),$(e=>{console.log("ðŸ“‹ Modals avant:",e);const a={...e,createDog:!0};return console.log("ðŸ“‹ Modals aprÃ¨s:",a),a})}}),t.jsx(Se,{isOpen:E.createDog,onClose:()=>$(e=>({...e,createDog:!1})),onSuccess:()=>{$(e=>({...e,createDog:!1})),window.location.reload()},userId:c==null?void 0:c.id})]})};export{Ye as default};
