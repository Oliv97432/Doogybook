import{u as k,s as u,j as e}from"./index-B7Jx57M6.js";import{e as w,d as C,r as d}from"./vendor-react-DEK6ZklB.js";import{X as E,a1 as A}from"./vendor-ui-BmzNxrw7.js";import"./vendor-supabase-DfwcnzK-.js";const T=()=>{const{contactId:n}=w(),t=C(),{user:m}=k(),[x,b]=d.useState(!1),[p,h]=d.useState(null),[i,g]=d.useState(!1),[r,f]=d.useState({type:"foster_family",full_name:"",email:"",phone:"",address:"",city:"",postal_code:"",housing_type:"house",has_garden:!1,has_other_pets:!1,other_pets_details:"",max_dogs:1,preferred_size:"all",preferred_age:"all",preferences_notes:"",availability:"available",availability_notes:"",rating:null,status:"active"});d.useEffect(()=>{m&&j()},[m]),d.useEffect(()=>{n&&p&&(g(!0),v())},[n,p]);const j=async()=>{try{const{data:o,error:a}=await u.from("professional_accounts").select("*").eq("user_id",m.id).single();if(a)throw a;h(o)}catch(o){console.error("Erreur:",o),t("/pro/register")}},v=async()=>{try{const{data:o,error:a}=await u.from("contacts").select("*").eq("id",n).single();if(a)throw a;f(o)}catch(o){console.error("Erreur chargement contact:",o),t("/pro/crm/contacts")}},s=o=>{const{name:a,value:l,type:c,checked:N}=o.target;f(_=>({..._,[a]:c==="checkbox"?N:l}))},y=async o=>{o.preventDefault(),b(!0);try{const a={...r,professional_account_id:p.id,max_dogs:parseInt(r.max_dogs),rating:r.rating?parseInt(r.rating):null};if(i){const{error:l}=await u.from("contacts").update(a).eq("id",n);if(l)throw l;alert("✅ Contact mis à jour !"),t(`/pro/crm/contacts/${n}`)}else{const{data:l,error:c}=await u.from("contacts").insert([a]).select().single();if(c)throw c;alert("✅ Contact créé !"),t(`/pro/crm/contacts/${l.id}`)}}catch(a){console.error("Erreur sauvegarde:",a),alert("❌ Erreur lors de la sauvegarde: "+a.message)}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-card border-b border-border",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-3 sm:py-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>t(i?`/pro/crm/contacts/${n}`:"/pro/crm/contacts"),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground min-h-[44px]",children:[e.jsx(E,{size:20}),e.jsx("span",{className:"font-medium hidden sm:inline",children:"Annuler"})]}),e.jsx("h1",{className:"text-lg sm:text-xl font-heading font-bold text-foreground truncate px-2",children:i?"Modifier le contact":"Nouveau contact"}),e.jsx("div",{className:"w-20"})]})}),e.jsx("main",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-6 sm:py-8",children:e.jsxs("form",{onSubmit:y,className:"bg-card rounded-2xl sm:rounded-3xl p-4 sm:p-6 md:p-8 shadow-soft space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Type de contact *"}),e.jsxs("select",{name:"type",value:r.type,onChange:s,required:!0,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"foster_family",children:"Famille d'accueil"}),e.jsx("option",{value:"adopter",children:"Adoptant"}),e.jsx("option",{value:"both",children:"Les deux"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-heading font-semibold text-foreground border-b pb-2",children:"Informations personnelles"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Nom complet *"}),e.jsx("input",{type:"text",name:"full_name",value:r.full_name,onChange:s,required:!0,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:s,required:!0,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Téléphone"}),e.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Adresse"}),e.jsx("input",{type:"text",name:"address",value:r.address,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Ville"}),e.jsx("input",{type:"text",name:"city",value:r.city,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Code postal"}),e.jsx("input",{type:"text",name:"postal_code",value:r.postal_code,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]})]})]}),(r.type==="foster_family"||r.type==="both")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-heading font-semibold text-foreground border-b pb-2",children:"Informations logement"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Type de logement"}),e.jsxs("select",{name:"housing_type",value:r.housing_type,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"apartment",children:"Appartement"}),e.jsx("option",{value:"house",children:"Maison"}),e.jsx("option",{value:"house_with_garden",children:"Maison avec jardin"}),e.jsx("option",{value:"farm",children:"Ferme"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer min-h-[44px]",children:[e.jsx("input",{type:"checkbox",name:"has_garden",checked:r.has_garden,onChange:s,className:"w-5 h-5 rounded border-border text-primary focus:ring-primary cursor-pointer"}),e.jsx("span",{className:"text-muted-foreground",children:"Dispose d'un jardin"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer min-h-[44px]",children:[e.jsx("input",{type:"checkbox",name:"has_other_pets",checked:r.has_other_pets,onChange:s,className:"w-5 h-5 rounded border-border text-primary focus:ring-primary cursor-pointer"}),e.jsx("span",{className:"text-muted-foreground",children:"A d'autres animaux"})]})]}),r.has_other_pets&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Détails sur les autres animaux"}),e.jsx("textarea",{name:"other_pets_details",value:r.other_pets_details,onChange:s,rows:2,placeholder:"Ex: 2 chats, 1 chien...",className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Capacité d'accueil (nombre max de chiens)"}),e.jsx("input",{type:"number",name:"max_dogs",value:r.max_dogs,onChange:s,min:"1",max:"10",className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Taille préférée"}),e.jsxs("select",{name:"preferred_size",value:r.preferred_size,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"all",children:"Toutes tailles"}),e.jsx("option",{value:"small",children:"Petits"}),e.jsx("option",{value:"medium",children:"Moyens"}),e.jsx("option",{value:"large",children:"Grands"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Âge préféré"}),e.jsxs("select",{name:"preferred_age",value:r.preferred_age,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"all",children:"Tous âges"}),e.jsx("option",{value:"puppy",children:"Chiots"}),e.jsx("option",{value:"adult",children:"Adultes"}),e.jsx("option",{value:"senior",children:"Seniors"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Notes sur les préférences"}),e.jsx("textarea",{name:"preferences_notes",value:r.preferences_notes,onChange:s,rows:2,placeholder:"Ex: Préfère les chiens calmes...",className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Disponibilité"}),e.jsxs("select",{name:"availability",value:r.availability,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"available",children:"Disponible"}),e.jsx("option",{value:"full",children:"Complet"}),e.jsx("option",{value:"temporarily_unavailable",children:"Temporairement indisponible"}),e.jsx("option",{value:"inactive",children:"Inactif"})]})]}),r.availability!=="available"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Notes sur la disponibilité"}),e.jsx("textarea",{name:"availability_notes",value:r.availability_notes,onChange:s,rows:2,placeholder:"Ex: En vacances jusqu'au...",className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background resize-none"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-heading font-semibold text-foreground border-b pb-2",children:"Évaluation"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Note (1-5 étoiles)"}),e.jsxs("select",{name:"rating",value:r.rating||"",onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"",children:"Pas de note"}),e.jsx("option",{value:"1",children:"⭐ 1 étoile"}),e.jsx("option",{value:"2",children:"⭐⭐ 2 étoiles"}),e.jsx("option",{value:"3",children:"⭐⭐⭐ 3 étoiles"}),e.jsx("option",{value:"4",children:"⭐⭐⭐⭐ 4 étoiles"}),e.jsx("option",{value:"5",children:"⭐⭐⭐⭐⭐ 5 étoiles"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Statut"}),e.jsxs("select",{name:"status",value:r.status,onChange:s,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background",children:[e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"inactive",children:"Inactif"}),e.jsx("option",{value:"blocked",children:"Bloqué"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-6 border-t border-border",children:[e.jsx("button",{type:"button",onClick:()=>t(i?`/pro/crm/contacts/${n}`:"/pro/crm/contacts"),className:"flex-1 py-3 border-2 border-border rounded-xl font-medium hover:bg-muted min-h-[44px]",children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex-1 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 disabled:opacity-50 flex items-center justify-center gap-2 min-h-[44px]",children:[e.jsx(A,{size:20}),x?"Enregistrement...":i?"Mettre à jour":"Créer le contact"]})]})]})})]})};export{T as default};
