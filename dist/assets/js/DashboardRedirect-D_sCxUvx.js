import{u as h,j as e,s as o}from"./index-DErj2e1l.js";import{d as p,r as n}from"./vendor-react-DEK6ZklB.js";import"./vendor-ui-DyJst9CI.js";import"./vendor-supabase-DfwcnzK-.js";const y=()=>{const{user:r,loading:l}=h(),s=p(),[c,u]=n.useState(!0);return n.useEffect(()=>{if(l)return;(async()=>{if(!r){s("/login");return}try{console.log("DashboardRedirect: Checking account for user:",r.id,r.email);const{data:a,error:m}=await o.from("user_profiles").select("is_admin, email, id").eq("email",r.email).maybeSingle();if(console.log("DashboardRedirect: Profile result:",{profile:a,profileError:m}),a&&a.is_admin===!0){console.log("DashboardRedirect: User is admin, redirecting to admin dashboard"),s("/admin/dashboard");return}let i=null;const{data:d,error:f}=await o.from("professional_accounts").select("id, is_active, user_id").eq("user_id",r.id).maybeSingle();if(console.log("DashboardRedirect: Pro account by user_id:",{proByUserId:d,proError1:f}),d)i=d;else{const{data:t,error:x}=await o.from("professional_accounts").select("id, is_active, user_id, email").eq("email",r.email).maybeSingle();console.log("DashboardRedirect: Pro account by email:",{proByEmail:t,proError2:x}),t&&(i=t,t.user_id!==r.id&&(console.log("DashboardRedirect: Updating user_id in professional_accounts"),await o.from("professional_accounts").update({user_id:r.id}).eq("id",t.id)))}i?(console.log("DashboardRedirect: User has pro account, redirecting to pro dashboard"),s("/pro/dashboard")):(console.log("DashboardRedirect: Regular user, redirecting to user dashboard"),s("/user-dashboard"))}catch(a){console.error("DashboardRedirect: Error checking account:",a),s("/user-dashboard")}finally{u(!1)}})()},[r,l,s]),c?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center w-full max-w-sm mx-auto",children:[e.jsx("div",{className:"relative mb-6",children:e.jsxs("div",{className:"w-20 h-20 mx-auto",children:[e.jsx("div",{className:"animate-spin h-20 w-20 border-4 border-blue-500 border-t-transparent rounded-full"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl font-bold",children:"D"})})})]})}),e.jsx("h2",{className:"text-xl font-heading font-semibold text-foreground mb-2",children:"Doogybook"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Préparation de votre espace..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5 mb-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-1.5 rounded-full animate-pulse"})}),e.jsxs("div",{className:"mt-8 space-y-2 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vérification du compte"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Chargement des données"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Redirection vers votre tableau de bord"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-6",children:"Si la redirection prend trop de temps, vérifiez votre connexion."})]})}):null};export{y as default};
