import{j as e,s as T,u as je,a as ve}from"./index-B7Jx57M6.js";import{r as c,d as Ne}from"./vendor-react-DEK6ZklB.js";import{u as ye}from"./useNotifications-BSrZrH0R.js";import{T as ae}from"./TabNavigation-BwiyMJ_q.js";import{U as le}from"./UserMenu-BLe4sAG0.js";import{F as we}from"./Footer-BzsNiuzK.js";import{ac as se,ad as Pe,s as Se,ae as Ce,P as De,a7 as ne,af as Ae,N as ke,h as Fe,i as ie,a1 as re,D as oe,w as ce}from"./vendor-ui-BmzNxrw7.js";import{E as ze}from"./jspdf.es.min-CbJeJTAI.js";import"./vendor-supabase-DfwcnzK-.js";import"./PremiumBadge-CXujHqOf.js";const Ee=[{value:"Arial",label:"Arial"},{value:"Georgia",label:"Georgia"},{value:"Times New Roman",label:"Times New Roman"},{value:"Courier New",label:"Courier New"},{value:"Comic Sans MS",label:"Comic Sans MS"},{value:"Verdana",label:"Verdana"},{value:"Impact",label:"Impact"},{value:"Brush Script MT",label:"Script"}],Te=[10,12,14,16,18,20,24,28,32,36,40,48],_e=["â¤ï¸","ðŸ˜Š","ðŸ•","ðŸ¶","ðŸ¦´","ðŸŽ¾","â­","ðŸŒŸ","âœ¨","ðŸ’«","ðŸŽ‰","ðŸŽˆ","ðŸŽ€","ðŸ’","ðŸ†","ðŸ‘‘","ðŸŒˆ","â˜€ï¸","ðŸŒ™","ðŸ’•","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ¤—","ðŸ˜‚","ðŸ¤£","ðŸ˜Ž","ðŸ¥³","ðŸŽ‚","ðŸ°"],Ie=({photo:s,pageId:h,onUpdate:t,onClose:r})=>{const[d,b]=c.useState(s.title||""),[p,m]=c.useState(s.caption||""),[n,u]=c.useState(s.fontFamily||"Arial"),[w,D]=c.useState(s.fontSize||14),[o,P]=c.useState(s.textColor||"#000000"),[v,N]=c.useState(!1),[y,S]=c.useState("title"),g=()=>{t(h,s.slotIndex,{title:d,caption:p,fontFamily:n,fontSize:w,textColor:o}),r()},E=C=>{y==="title"?b(L=>L+C):m(L=>L+C)};return e.jsx("div",{className:"photo-text-editor-overlay",onClick:r,children:e.jsxs("div",{className:"photo-text-editor",onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"editor-header",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"âœï¸ Ajouter du texte Ã  la photo"}),e.jsx("button",{onClick:r,className:"close-btn",children:"Ã—"})]}),e.jsxs("div",{className:"editor-body",children:[e.jsx("div",{className:"photo-preview",children:e.jsx("img",{src:s.url,alt:"Preview"})}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(se,{size:16}),e.jsx("span",{children:"Titre"})]}),e.jsx("input",{type:"text",value:d,onChange:C=>b(C.target.value),onFocus:()=>S("title"),placeholder:"Ex: Mon chien adorÃ© ðŸ•",className:"form-input",maxLength:50}),e.jsxs("span",{className:"char-count",children:[d.length,"/50"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:[e.jsx(se,{size:16}),e.jsx("span",{children:"LÃ©gende"})]}),e.jsx("textarea",{value:p,onChange:C=>m(C.target.value),onFocus:()=>S("caption"),placeholder:"Ex: Premier jour Ã  la maison â¤ï¸",className:"form-textarea",rows:3,maxLength:150}),e.jsxs("span",{className:"char-count",children:[p.length,"/150"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("button",{type:"button",onClick:()=>N(!v),className:"emoji-btn",children:[e.jsx(Pe,{size:16}),e.jsx("span",{children:"Ajouter un emoji"}),e.jsx(Se,{size:14,className:v?"rotate-180":""})]}),v&&e.jsx("div",{className:"emoji-picker",children:_e.map((C,L)=>e.jsx("button",{type:"button",onClick:()=>E(C),className:"emoji-option",children:C},L))})]}),e.jsxs("div",{className:"text-style-section",children:[e.jsx("h4",{className:"section-title",children:"Style du texte"}),e.jsxs("div",{className:"style-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label-sm",children:"Police"}),e.jsx("select",{value:n,onChange:C=>u(C.target.value),className:"form-select",children:Ee.map(C=>e.jsx("option",{value:C.value,style:{fontFamily:C.value},children:C.label},C.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label-sm",children:"Taille"}),e.jsx("select",{value:w,onChange:C=>D(Number(C.target.value)),className:"form-select",children:Te.map(C=>e.jsxs("option",{value:C,children:[C,"px"]},C))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label-sm",children:[e.jsx(Ce,{size:14}),e.jsx("span",{children:"Couleur"})]}),e.jsxs("div",{className:"color-input-wrapper",children:[e.jsx("input",{type:"color",value:o,onChange:C=>P(C.target.value),className:"color-input"}),e.jsx("span",{className:"color-value",children:o})]})]})]})]}),e.jsxs("div",{className:"text-preview",children:[e.jsx("p",{className:"preview-label",children:"AperÃ§u :"}),d&&e.jsx("div",{className:"preview-title",style:{fontFamily:n,fontSize:`${w}px`,color:o},children:d}),p&&e.jsx("div",{className:"preview-caption",style:{fontFamily:n,fontSize:`${w-2}px`,color:o},children:p}),!d&&!p&&e.jsx("p",{className:"preview-empty",children:"Ajoutez un titre ou une lÃ©gende pour voir l'aperÃ§u"})]})]}),e.jsxs("div",{className:"editor-footer",children:[e.jsx("button",{onClick:r,className:"btn-cancel",children:"Annuler"}),e.jsx("button",{onClick:g,className:"btn-save",children:"âœ“ Enregistrer"})]})]})})},Le=({pages:s,currentPageIndex:h,onPageChange:t,onPhotoDrop:r,onRemovePhoto:d,selectedPhoto:b,onPhotoSelect:p,onUpdatePhotoText:m})=>{const[n,u]=c.useState(!1),[w,D]=c.useState(""),[o,P]=c.useState(null),[v,N]=c.useState(null),[y,S]=c.useState(null),g=s[h],E=h+1,C=E<s.length,L=()=>{h>0&&!n&&(D("backward"),u(!0),setTimeout(()=>{t(h-1),u(!1),D("")},600))},Z=()=>{C&&!n&&(D("forward"),u(!0),setTimeout(()=>{t(h+1),u(!1),D("")},600))},V=(j,F)=>{P(F),j.dataTransfer.effectAllowed="move",j.dataTransfer.setData("text/html",j.target)},W=j=>{j.preventDefault(),j.dataTransfer.dropEffect="move"},B=(j,F,k)=>{j.preventDefault();const M=j.dataTransfer.getData("photoId")||o;M&&r(M,F,k),P(null)},J=(j,F)=>{b&&(r(b.id,j,F),p(null))},X=(j,F)=>{N(j),S(F)},Y=()=>{N(null),S(null)},Q=(j,F)=>{const k=j.photos.find(_=>_.slotIndex===F),M=`photo-slot layout-${j.layout}`,R=b&&!k;return e.jsx("div",{className:`${M} ${R?"clickable-slot":""}`,onDragOver:W,onDrop:_=>B(_,j.id,F),onClick:()=>J(j.id,F),style:{cursor:R?"pointer":"default"},children:k?e.jsxs("div",{className:"photo-container",children:[e.jsx("img",{src:k.url,alt:`Photo ${F+1}`,className:"album-photo",draggable:!0,onDragStart:_=>V(_,k.id)}),(k.title||k.caption)&&e.jsxs("div",{className:"photo-text-overlay",style:{fontFamily:k.fontFamily||"Arial",color:k.textColor||"#ffffff"},children:[k.title&&e.jsx("div",{className:"photo-title",style:{fontSize:`${k.fontSize||14}px`},children:k.title}),k.caption&&e.jsx("div",{className:"photo-caption",style:{fontSize:`${(k.fontSize||14)-2}px`},children:k.caption})]}),e.jsxs("button",{className:"edit-text-btn",onClick:_=>{_.stopPropagation(),X(k,j.id)},title:"Ajouter/modifier le texte",children:[e.jsx(se,{size:14}),"Texte"]}),e.jsx("button",{className:"remove-photo-btn",onClick:_=>{_.stopPropagation(),d(j.id,F)},title:"Supprimer cette photo",children:"Ã—"})]}):e.jsxs("div",{className:"empty-slot",children:[e.jsx("span",{className:"text-gray-400 hidden sm:inline",children:"Glissez une photo ici"}),e.jsx("span",{className:"text-gray-400 sm:hidden text-xs",children:b?"Cliquez ici":"SÃ©lectionnez une photo"})]})},F)},O=(j,F=!1)=>{if(!j)return e.jsx("div",{className:"album-page empty"});const k=U(j.layout),M=Array.from({length:k},(R,_)=>_);return e.jsxs("div",{className:`album-page ${F?"right":"left"}`,children:[e.jsx("div",{className:`page-content layout-${j.layout}`,children:M.map(R=>Q(j,R))}),e.jsx("div",{className:"page-number",children:s.indexOf(j)+1})]})},U=j=>{switch(j){case"fullPage":return 1;case"twoPerPage":return 2;case"threePerPage":return 3;default:return 1}};return e.jsxs("div",{className:"album-viewer",children:[e.jsxs("div",{className:"album-controls",children:[e.jsxs("button",{onClick:L,disabled:h===0||n,className:"nav-btn prev-btn",title:"Page prÃ©cÃ©dente",style:{minHeight:"44px",minWidth:"44px"},children:[e.jsx("span",{className:"hidden sm:inline",children:"â† PrÃ©cÃ©dent"}),e.jsx("span",{className:"sm:hidden",children:"â†"})]}),e.jsxs("span",{className:"page-indicator",children:[e.jsxs("span",{className:"hidden sm:inline",children:["Page ",h+1," sur ",s.length]}),e.jsxs("span",{className:"sm:hidden",children:[h+1,"/",s.length]})]}),e.jsxs("button",{onClick:Z,disabled:!C||n,className:"nav-btn next-btn",title:"Page suivante",style:{minHeight:"44px",minWidth:"44px"},children:[e.jsx("span",{className:"hidden sm:inline",children:"Suivant â†’"}),e.jsx("span",{className:"sm:hidden",children:"â†’"})]})]}),e.jsxs("div",{className:`album-book ${n?"flipping":""} ${w}`,children:[e.jsx("div",{className:"book-spine"}),e.jsx("div",{className:"book-left",children:O(g,!1)}),e.jsx("div",{className:"book-right",children:C?O(s[E],!0):e.jsx("div",{className:"album-page right empty",children:e.jsx("div",{className:"end-message",children:"Fin de l'album"})})}),n&&e.jsx("div",{className:`turning-page ${w}`,children:O(w==="forward"?g:s[E])})]}),e.jsx("div",{className:"album-instructions",children:e.jsx("p",{children:'ðŸ’¡ Glissez-dÃ©posez des photos depuis le panneau latÃ©ral ou utilisez le bouton "Remplissage AlÃ©atoire"'})}),v&&y&&e.jsx(Ie,{photo:v,pageId:y,onUpdate:m,onClose:Y})]})},$e=({photos:s,onRandomFill:h,dogName:t,selectedPhoto:r,onPhotoSelect:d})=>{const b=(m,n)=>{m.dataTransfer.effectAllowed="copy",m.dataTransfer.setData("photoId",n.id)},p=m=>{d(m)};return e.jsxs("div",{className:"photo-sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-800",children:["Photos de ",t]}),e.jsxs("span",{className:"photo-count",children:[s.length," photo",s.length!==1?"s":""]})]}),e.jsx("div",{className:"sidebar-actions",children:e.jsx("button",{onClick:h,disabled:s.length===0,className:"btn-random",title:"RÃ©partir toutes les photos de faÃ§on alÃ©atoire dans l'album",children:"ðŸŽ² Remplissage AlÃ©atoire"})}),r&&e.jsxs("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-3 mb-3",children:[e.jsx("p",{className:"text-xs text-blue-800 font-medium",children:"ðŸ“¸ Photo sÃ©lectionnÃ©e - Cliquez sur un emplacement dans l'album"}),e.jsx("button",{onClick:()=>d(null),className:"mt-2 text-xs text-blue-600 hover:text-blue-800 underline",children:"Annuler la sÃ©lection"})]}),e.jsx("div",{className:"photo-grid",children:s.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ“·"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Aucune photo disponible"}),e.jsxs("p",{className:"text-gray-400 text-xs mt-2",children:["Ajoutez des photos depuis le profil de ",t]}),e.jsx("a",{href:"/dog-profile",className:"inline-block mt-4 px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors",children:"Aller au profil"})]}):s.map(m=>e.jsxs("div",{className:`photo-thumbnail ${(r==null?void 0:r.id)===m.id?"selected":""}`,draggable:!0,onDragStart:n=>b(n,m),onClick:()=>p(m),style:{cursor:"pointer"},children:[e.jsx("img",{src:m.url,alt:m.name,className:"thumbnail-image"}),e.jsxs("div",{className:"thumbnail-overlay",children:[e.jsx("span",{className:"drag-hint hidden sm:inline",children:"Glisser"}),e.jsx("span",{className:"drag-hint sm:hidden",children:"Cliquer"})]}),(r==null?void 0:r.id)===m.id&&e.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center",children:"âœ“"})]},m.id))}),s.length>0&&e.jsxs("div",{className:"sidebar-footer",children:[e.jsx("p",{className:"text-xs text-gray-500 hidden sm:block",children:"ðŸ’¡ Glissez une photo vers l'album ou utilisez le remplissage alÃ©atoire"}),e.jsx("p",{className:"text-xs text-gray-500 sm:hidden",children:"ðŸ’¡ Cliquez sur une photo puis sur un emplacement dans l'album"})]})]})},Me=({currentPage:s,selectedLayout:h,onLayoutChange:t,onAddPage:r,currentPageCount:d,maxPages:b})=>{var m;const p=[{id:"fullPage",name:"Pleine Page",icon:"ðŸ–¼ï¸",description:"Une grande photo par page",preview:e.jsx("div",{className:"layout-preview",children:e.jsx("div",{className:"preview-box full"})})},{id:"twoPerPage",name:"2 par Page",icon:"ðŸ“",description:"Deux photos cÃ´te Ã  cÃ´te",preview:e.jsxs("div",{className:"layout-preview",children:[e.jsx("div",{className:"preview-box half"}),e.jsx("div",{className:"preview-box half"})]})},{id:"threePerPage",name:"3 par Page",icon:"ðŸŽ¨",description:"Trois photos (1 grande + 2 petites)",preview:e.jsxs("div",{className:"layout-preview three",children:[e.jsx("div",{className:"preview-box large"}),e.jsxs("div",{className:"preview-box-group",children:[e.jsx("div",{className:"preview-box small"}),e.jsx("div",{className:"preview-box small"})]})]})}];return e.jsxs("div",{className:"config-panel",children:[e.jsx("div",{className:"panel-header",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Configuration"})}),e.jsxs("div",{className:"config-section",children:[e.jsx("h3",{className:"section-title",children:"Page Actuelle"}),e.jsxs("div",{className:"current-page-info",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Mise en page:"}),e.jsx("span",{className:"info-value",children:((m=p.find(n=>n.id===(s==null?void 0:s.layout)))==null?void 0:m.name)||"Pleine Page"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"info-label",children:"Photos:"}),e.jsxs("span",{className:"info-value",children:[(s==null?void 0:s.photos.length)||0," / ",Oe(s==null?void 0:s.layout)]})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h3",{className:"section-title",children:"Changer la Mise en Page"}),e.jsx("p",{className:"section-description",children:"Modifie la disposition de la page actuelle"}),e.jsx("div",{className:"layout-options",children:p.map(n=>e.jsxs("button",{onClick:()=>t(n.id),className:`layout-option ${h===n.id?"active":""}`,title:n.description,children:[e.jsxs("div",{className:"option-header",children:[e.jsx("span",{className:"option-icon",children:n.icon}),e.jsx("span",{className:"option-name",children:n.name})]}),n.preview,e.jsx("p",{className:"option-description",children:n.description})]},n.id))})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h3",{className:"section-title",children:"Actions"}),e.jsxs("button",{onClick:r,disabled:d>=b,className:"action-btn add-page",title:d>=b?`Limite de ${b} pages atteinte`:"Ajouter une nouvelle page",children:["âž• Ajouter une Nouvelle Page",d>=b&&e.jsxs("span",{className:"text-xs block mt-1",children:["(",d,"/",b," pages)"]})]}),d<b&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[d,"/",b," pages utilisÃ©es"]})]}),e.jsxs("div",{className:"config-section help-section",children:[e.jsx("h3",{className:"section-title",children:"Aide"}),e.jsxs("div",{className:"help-content",children:[e.jsxs("div",{className:"help-item",children:[e.jsx("span",{className:"help-icon",children:"ðŸ–±ï¸"}),e.jsx("span",{className:"help-text",children:"Glissez-dÃ©posez pour ajouter des photos"})]}),e.jsxs("div",{className:"help-item",children:[e.jsx("span",{className:"help-icon",children:"ðŸ”„"}),e.jsx("span",{className:"help-text",children:"Changez la mise en page Ã  tout moment"})]}),e.jsxs("div",{className:"help-item",children:[e.jsx("span",{className:"help-icon",children:"ðŸ“„"}),e.jsx("span",{className:"help-text",children:"Utilisez les miniatures pour rÃ©organiser"})]})]})]})]})},Oe=s=>{switch(s){case"fullPage":return 1;case"twoPerPage":return 2;case"threePerPage":return 3;default:return 1}},Re=({pages:s,currentPageIndex:h,onPageSelect:t,onReorder:r,onDuplicate:d,onDelete:b})=>{const[p,m]=c.useState(null),[n,u]=c.useState(null),w=(y,S)=>{m(S),y.dataTransfer.effectAllowed="move"},D=(y,S)=>{y.preventDefault(),y.dataTransfer.dropEffect="move",u(S)},o=()=>{u(null)},P=(y,S)=>{y.preventDefault(),p!==null&&p!==S&&r(p,S),m(null),u(null)},v=()=>{m(null),u(null)},N=y=>{switch(y){case"fullPage":return"Pleine Page";case"twoPerPage":return"2 par Page";case"threePerPage":return"3 par Page";default:return"Pleine Page"}};return e.jsxs("div",{className:"page-thumbnails",children:[e.jsxs("div",{className:"thumbnails-header",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Pages de l'Album"}),e.jsxs("span",{className:"page-count-badge",children:[s.length," page",s.length!==1?"s":""]})]}),e.jsx("div",{className:"thumbnails-grid",children:s.map((y,S)=>e.jsxs("div",{className:`page-thumbnail-card ${h===S?"active":""} ${n===S?"drag-over":""}`,draggable:!0,onDragStart:g=>w(g,S),onDragOver:g=>D(g,S),onDragLeave:o,onDrop:g=>P(g,S),onDragEnd:v,onClick:()=>t(S),children:[e.jsx("div",{className:"thumbnail-preview",children:e.jsx("div",{className:`preview-layout layout-${y.layout}`,children:y.photos.length>0?y.photos.map((g,E)=>e.jsx("div",{className:"preview-photo",children:e.jsx("img",{src:g.url,alt:""})},E)):e.jsx("div",{className:"preview-empty",children:e.jsx("span",{className:"text-gray-400 text-xs",children:"Vide"})})})}),e.jsxs("div",{className:"thumbnail-info",children:[e.jsxs("div",{className:"info-header",children:[e.jsxs("span",{className:"page-number",children:["Page ",S+1]}),e.jsx("span",{className:"layout-badge",children:N(y.layout)})]}),e.jsx("div",{className:"photo-info",children:e.jsxs("span",{className:"text-xs text-gray-600",children:[y.photos.length," photo",y.photos.length!==1?"s":""]})})]}),e.jsxs("div",{className:"thumbnail-actions",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),d(y.id)},className:"action-icon duplicate",title:"Dupliquer cette page",children:"ðŸ“‹"}),e.jsx("button",{onClick:g=>{g.stopPropagation(),window.confirm("Voulez-vous vraiment supprimer cette page ?")&&b(y.id)},className:"action-icon delete",title:"Supprimer cette page",disabled:s.length<=1,children:"ðŸ—‘ï¸"})]}),p===S&&e.jsx("div",{className:"dragging-indicator",children:e.jsx("span",{children:"DÃ©placement..."})})]},y.id))}),e.jsx("div",{className:"thumbnails-footer",children:e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ Glissez-dÃ©posez pour rÃ©organiser les pages"})})]})},Ue=({albums:s,currentAlbumId:h,onSelectAlbum:t,onCreateAlbum:r,onRenameAlbum:d,onDeleteAlbum:b})=>{const[p,m]=c.useState(!1),[n,u]=c.useState(""),[w,D]=c.useState(null),[o,P]=c.useState(""),v=()=>{n.trim()&&(r(n.trim()),u(""),m(!1))},N=g=>{o.trim()&&(d(g,o.trim()),D(null),P(""))},y=g=>{D(g.id),P(g.album_title)},S=()=>{D(null),P("")};return e.jsxs("div",{className:"album-selector",children:[e.jsxs("div",{className:"selector-header",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"ðŸ“š Mes Albums"}),e.jsxs("button",{onClick:()=>m(!0),className:"btn-create-album",title:"CrÃ©er un nouvel album",children:[e.jsx(De,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Nouvel Album"})]})]}),p&&e.jsxs("div",{className:"album-form",children:[e.jsx("input",{type:"text",value:n,onChange:g=>u(g.target.value),placeholder:"Titre de l'album (ex: Vacances 2024)",maxLength:100,className:"album-input",autoFocus:!0,onKeyPress:g=>g.key==="Enter"&&v()}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{onClick:v,className:"btn-save-sm",children:"CrÃ©er"}),e.jsx("button",{onClick:()=>{m(!1),u("")},className:"btn-cancel-sm",children:"Annuler"})]})]}),e.jsx("div",{className:"albums-list",children:s.length===0?e.jsxs("div",{className:"empty-albums",children:[e.jsx(ne,{size:40,className:"text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Aucun album"}),e.jsx("p",{className:"text-gray-400 text-xs",children:"CrÃ©ez votre premier album !"})]}):s.map(g=>e.jsx("div",{className:`album-item ${h===g.id?"active":""}`,children:w===g.id?e.jsxs("div",{className:"album-form",children:[e.jsx("input",{type:"text",value:o,onChange:E=>P(E.target.value),maxLength:100,className:"album-input",autoFocus:!0,onKeyPress:E=>E.key==="Enter"&&N(g.id)}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{onClick:()=>N(g.id),className:"btn-save-sm",children:"OK"}),e.jsx("button",{onClick:S,className:"btn-cancel-sm",children:"Annuler"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"album-info",onClick:()=>t(g.id),children:[e.jsx(ne,{size:16,className:"album-icon"}),e.jsxs("div",{className:"album-details",children:[e.jsx("h4",{className:"album-name",children:g.album_title}),e.jsxs("p",{className:"album-meta",children:[g.page_count||0," page",(g.page_count||0)!==1?"s":"",g.updated_at&&e.jsxs("span",{className:"ml-2",children:["â€¢ ",new Date(g.updated_at).toLocaleDateString("fr-FR")]})]})]})]}),e.jsxs("div",{className:"album-actions",children:[e.jsx("button",{onClick:()=>y(g),className:"action-icon",title:"Renommer",children:e.jsx(Ae,{size:14})}),s.length>1&&e.jsx("button",{onClick:()=>{window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer l'album "${g.album_title}" ?`)&&b(g.id)},className:"action-icon delete",title:"Supprimer",children:e.jsx(ke,{size:14})})]})]})},g.id))})]})},qe=async(s,h="mon-album-photo.pdf")=>{try{const t=new ze({orientation:"landscape",unit:"mm",format:"a4"}),r=297,d=210,b=15,p=r-2*b,m=d-2*b;let n=!0;for(let u=0;u<s.pages.length;u++){const w=s.pages[u];if(n||t.addPage(),n=!1,t.setFontSize(10),t.setTextColor(150,150,150),t.text(`Page ${u+1}`,r/2,d-5,{align:"center"}),w.photos.length===0){t.setFontSize(16),t.setTextColor(200,200,200),t.text("Page vide",r/2,d/2,{align:"center"});continue}await Ge(t,w,b,p,m)}return await Ke(t,s),t.save(h),{success:!0,message:"PDF gÃ©nÃ©rÃ© avec succÃ¨s!"}}catch(t){return console.error("Erreur lors de la gÃ©nÃ©ration du PDF:",t),{success:!1,message:"Erreur lors de la gÃ©nÃ©ration du PDF: "+t.message}}},Ge=async(s,h,t,r,d)=>{const{layout:b,photos:p}=h;let m=[];switch(b){case"fullPage":m=[{x:t,y:t,width:r,height:d}];break;case"twoPerPage":const n=(r-10)/2;m=[{x:t,y:t,width:n,height:d},{x:t+n+10,y:t,width:n,height:d}];break;case"threePerPage":const u=r*.6-5,w=r*.4-5,D=(d-10)/2;m=[{x:t,y:t,width:u,height:d},{x:t+u+10,y:t,width:w,height:D},{x:t+u+10,y:t+D+10,width:w,height:D}];break;default:m=[{x:t,y:t,width:r,height:d}]}for(const n of p){const u=m[n.slotIndex];if(u)try{const w=await Ve(n.url),{finalWidth:D,finalHeight:o,offsetX:P,offsetY:v}=We(w,u.width,u.height);s.addImage(w.data,w.format,u.x+P,u.y+v,D,o),s.setDrawColor(200,200,200),s.setLineWidth(.5),s.rect(u.x,u.y,u.width,u.height),(n.title||n.caption)&&Be(s,n,u)}catch(w){console.error("Erreur lors du chargement de l'image:",w),s.setFillColor(240,240,240),s.rect(u.x,u.y,u.width,u.height,"F"),s.setTextColor(150,150,150),s.setFontSize(12),s.text("Image non disponible",u.x+u.width/2,u.y+u.height/2,{align:"center"})}}},Ve=s=>new Promise((h,t)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>{const d=document.createElement("canvas");d.width=r.width,d.height=r.height,d.getContext("2d").drawImage(r,0,0);const p=s.toLowerCase().includes(".png")?"PNG":"JPEG";try{const m=d.toDataURL(`image/${p.toLowerCase()}`);h({data:m,format:p,width:r.width,height:r.height})}catch(m){t(m)}},r.onerror=()=>{t(new Error("Impossible de charger l'image"))},r.src=s}),We=(s,h,t)=>{const r=s.width/s.height,d=h/t;let b,p,m=0,n=0;return r>d?(b=h,p=h/r,n=(t-p)/2):(p=t,b=t*r,m=(h-b)/2),{finalWidth:b,finalHeight:p,offsetX:m,offsetY:n}},Be=(s,h,t)=>{const{title:r,caption:d,fontFamily:b,fontSize:p,textColor:m}=h,n=Je(m||"#FFFFFF"),u=25,w=t.x+5,D=t.y+t.height-u;s.setFillColor(0,0,0),s.setGState(new s.GState({opacity:.7})),s.rect(t.x,D,t.width,u,"F"),s.setGState(new s.GState({opacity:1}));const o=Xe(b);s.setFont(o.font,o.style),s.setTextColor(n.r,n.g,n.b);let P=D+5;if(r){const v=Math.min((p||14)*.35,12);s.setFontSize(v),s.setFont(o.font,"bold");const N=t.width-10,y=Ye(s,r,N);s.text(y,w,P),P+=v*.5}if(d){const v=Math.min(((p||14)-2)*.35,10);s.setFontSize(v),s.setFont(o.font,"normal");const N=t.width-10;s.splitTextToSize(d,N).slice(0,2).forEach(g=>{P+v*.5<t.y+t.height-2&&(s.text(g,w,P),P+=v*.5)})}},Je=s=>{s=s.replace("#","");const h=parseInt(s.substring(0,2),16),t=parseInt(s.substring(2,4),16),r=parseInt(s.substring(4,6),16);return{r:h,g:t,b:r}},Xe=s=>({Arial:{font:"helvetica",style:"normal"},Georgia:{font:"times",style:"normal"},"Times New Roman":{font:"times",style:"normal"},"Courier New":{font:"courier",style:"normal"},Verdana:{font:"helvetica",style:"normal"},"Comic Sans MS":{font:"helvetica",style:"normal"},Impact:{font:"helvetica",style:"bold"},"Brush Script MT":{font:"times",style:"italic"}})[s]||{font:"helvetica",style:"normal"},Ye=(s,h,t)=>{if(s.getTextWidth(h)<=t)return h;let d=h;for(;s.getTextWidth(d+"...")>t&&d.length>0;)d=d.slice(0,-1);return d+"..."},Ke=async(s,h)=>{s.insertPage(1),s.setPage(1);const t=297,r=210;s.setFillColor(102,126,234),s.rect(0,0,t,r,"F"),s.setTextColor(255,255,255),s.setFontSize(40),s.text("Mon Album Photo",t/2,80,{align:"center"}),s.setFontSize(16),s.text("CrÃ©Ã© avec DoogyBook Premium",t/2,100,{align:"center"}),s.setFontSize(12);const d=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"});s.text(`${h.pages.length} pages â€¢ ${d}`,t/2,130,{align:"center"});const b=h.pages.reduce((p,m)=>p+m.photos.length,0);s.text(`${b} photo${b>1?"s":""}`,t/2,145,{align:"center"})},He=s=>{console.log("=== APERÃ‡U DES DONNÃ‰ES DE L'ALBUM ==="),console.log("Nombre de pages:",s.pages.length),s.pages.forEach((h,t)=>{console.log(`
Page ${t+1}:`),console.log("  Layout:",h.layout),console.log("  Photos:",h.photos.length),h.photos.forEach((r,d)=>{console.log(`    Photo ${d+1}: Slot ${r.slotIndex}`)})}),console.log(`
=== STRUCTURE COMPLÃˆTE ===`),console.log(JSON.stringify(s,null,2)),console.log("=====================================")},Ze=()=>{const[s,h]=c.useState([]),[t,r]=c.useState(null),[d,b]=c.useState(!0),[p,m]=c.useState([]),[n,u]=c.useState(null),[w,D]=c.useState("Mon Album"),[o,P]=c.useState({pages:[{id:"page-1",layout:"fullPage",photos:[]},{id:"page-2",layout:"fullPage",photos:[]}]}),v=10,[N,y]=c.useState([]),[S,g]=c.useState(0),[E,C]=c.useState("fullPage"),[L,Z]=c.useState(!1),[V,W]=c.useState(null),[B,J]=c.useState(!1),[X,Y]=c.useState(null),[Q,O]=c.useState(!0),[U,j]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const{data:{user:a}}=await T.auth.getUser();if(!a)return;const{data:i,error:x}=await T.from("dogs").select("id, name, breed, photo_url").eq("user_id",a.id).order("name");if(x)throw x;h(i||[]),i&&i.length===1&&r(i[0].id)}catch(a){console.error("Erreur chargement chiens:",a)}finally{b(!1)}})()},[]),c.useEffect(()=>{(async()=>{if(!t){y([]);return}try{const{data:a,error:i}=await T.from("dog_photos").select("id, photo_url, created_at").eq("dog_id",t).order("created_at",{ascending:!1});if(i)throw i;const x=(a||[]).map((f,A)=>({id:f.id,url:f.photo_url,name:`Photo ${A+1}`}));y(x)}catch(a){console.error("Erreur chargement photos:",a)}})()},[t]),c.useEffect(()=>{(async()=>{if(!t){m([]),u(null),D("Mon Album");return}try{const{data:{user:a}}=await T.auth.getUser();if(!a)return;const{data:i,error:x}=await T.from("dog_albums").select("id, album_title, album_data, created_at, updated_at").eq("dog_id",t).eq("user_id",a.id).order("created_at",{ascending:!0});if(x)throw x;if(!i||i.length===0)await F("Mon Album");else{const f=i.map(z=>{var $,G;return{...z,page_count:((G=($=z.album_data)==null?void 0:$.pages)==null?void 0:G.length)||0}});m(f);const A=f[0];u(A.id),D(A.album_title)}}catch(a){console.error("Erreur chargement albums:",a)}})()},[t]);const F=async l=>{if(t)try{const{data:{user:a}}=await T.auth.getUser();if(!a)throw new Error("Non connectÃ©");const i={pages:[{id:"page-1",layout:"fullPage",photos:[]},{id:"page-2",layout:"fullPage",photos:[]}]},{data:x,error:f}=await T.from("dog_albums").insert({dog_id:t,user_id:a.id,album_title:l,album_data:i,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(f)throw f;m(A=>[...A,x]),u(x.id),D(x.album_title),P(i),j(!1),I("âœ… Nouvel album crÃ©Ã©!","success")}catch(a){console.error("Erreur crÃ©ation album:",a),I("âŒ Erreur lors de la crÃ©ation de l'album","error")}},k=async(l,a)=>{try{const{error:i}=await T.from("dog_albums").update({album_title:a,updated_at:new Date().toISOString()}).eq("id",l);if(i)throw i;m(x=>x.map(f=>f.id===l?{...f,album_title:a}:f)),n===l&&D(a),I("âœ… Album renommÃ©!","success")}catch(i){console.error("Erreur renommage album:",i),I("âŒ Erreur lors du renommage","error")}},M=async l=>{if(p.length<=1){I("âš ï¸ Vous devez avoir au moins un album","error");return}if(window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cet album ?"))try{const{error:a}=await T.from("dog_albums").delete().eq("id",l);if(a)throw a;const i=p.filter(x=>x.id!==l);if(m(i),n===l&&i.length>0){const x=i[0];u(x.id),D(x.album_title),await H(x.id)}I("âœ… Album supprimÃ©!","success")}catch(a){console.error("Erreur suppression album:",a),I("âŒ Erreur lors de la suppression","error")}},R=async l=>{const a=p.find(i=>i.id===l);a&&(u(l),D(a.album_title),await H(l))},_=c.useCallback(()=>{if(N.length===0){alert("Veuillez d'abord importer des photos");return}const l=[...N].sort(()=>Math.random()-.5),a=[...o.pages];let i=0;a.forEach(x=>{const f=ee(x.layout),A=[];for(let z=0;z<f&&i<l.length;z++)A.push({id:l[i].id,url:l[i].url,slotIndex:z}),i++;x.photos=A}),P({pages:a})},[N,o.pages]),ee=l=>{switch(l){case"fullPage":return 1;case"twoPerPage":return 2;case"threePerPage":return 3;default:return 1}},de=c.useCallback((l,a,i)=>{const x=N.find(A=>A.id===l);if(!x)return;const f=o.pages.map(A=>{if(A.id===a){const z=ee(A.layout);if(i<z){const $=A.photos.findIndex(be=>be.slotIndex===i),G=[...A.photos];return $>=0?G[$]={id:x.id,url:x.url,slotIndex:i,title:"",caption:"",fontFamily:"Arial",fontSize:14,textColor:"#000000"}:G.push({id:x.id,url:x.url,slotIndex:i,title:"",caption:"",fontFamily:"Arial",fontSize:14,textColor:"#000000"}),{...A,photos:G}}}return A});P({pages:f}),j(!0)},[N,o.pages]),me=c.useCallback((l,a)=>{const i=o.pages.map(x=>{if(x.id===l){const f=ee(a),A=x.photos.slice(0,f).map((z,$)=>({...z,slotIndex:$}));return{...x,layout:a,photos:A}}return x});P({pages:i}),j(!0)},[o.pages]),ue=c.useCallback(()=>{if(o.pages.length>=v){I(`âš ï¸ Limite de ${v} pages atteinte`,"error");return}const l={id:`page-${Date.now()}`,layout:E,photos:[]};P(a=>({pages:[...a.pages,l]})),j(!0)},[E,o.pages.length]),he=c.useCallback(l=>{if(o.pages.length>=v){I(`âš ï¸ Impossible de dupliquer: limite de ${v} pages atteinte`,"error");return}const a=o.pages.findIndex(A=>A.id===l);if(a===-1)return;const i=o.pages[a],x={...i,id:`page-${Date.now()}`,photos:[...i.photos]},f=[...o.pages];f.splice(a+1,0,x),P({pages:f}),j(!0)},[o.pages]),xe=c.useCallback(l=>{if(o.pages.length<=1){alert("L'album doit contenir au moins une page");return}const a=o.pages.filter(i=>i.id!==l);P({pages:a}),j(!0),S>=a.length&&g(a.length-1)},[o.pages,S]),ge=c.useCallback((l,a)=>{const i=[...o.pages],[x]=i.splice(l,1);i.splice(a,0,x),P({pages:i}),j(!0)},[o.pages]),te=c.useCallback(async()=>{if(o.pages.every(a=>a.photos.length===0)){alert("Veuillez ajouter au moins une photo Ã  votre album avant de gÃ©nÃ©rer le PDF.");return}const l=document.createElement("div");l.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(102, 126, 234, 0.95);
      color: white;
      padding: 2rem 3rem;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    `,l.textContent="ðŸ“„ GÃ©nÃ©ration du PDF en cours...",document.body.appendChild(l);try{const a=await qe(o,"mon-album-photo.pdf");document.body.removeChild(l),a.success?(alert("âœ… PDF tÃ©lÃ©chargÃ© avec succÃ¨s!"),He(o)):alert("âŒ "+a.message)}catch(a){document.body.removeChild(l),alert("âŒ Erreur lors de la gÃ©nÃ©ration du PDF: "+a.message),console.error("Erreur PDF:",a)}},[o]),pe=c.useCallback((l,a)=>{const i=o.pages.map(x=>x.id===l?{...x,photos:x.photos.filter(f=>f.slotIndex!==a)}:x);P({pages:i}),j(!0)},[o.pages]),fe=c.useCallback((l,a,i)=>{const x=o.pages.map(f=>{if(f.id===l){const A=f.photos.map(z=>z.slotIndex===a?{...z,...i}:z);return{...f,photos:A}}return f});P({pages:x}),j(!0)},[o.pages]),K=c.useCallback(async()=>{if(!(!t||!n)){J(!0);try{const{data:{user:l}}=await T.auth.getUser();if(!l)throw new Error("Non connectÃ©");const a={pages:o.pages.map(x=>({id:x.id,layout:x.layout,photos:x.photos.map(f=>({id:f.id,slotIndex:f.slotIndex,title:f.title||"",caption:f.caption||"",fontFamily:f.fontFamily||"Arial",fontSize:f.fontSize||14,textColor:f.textColor||"#000000"}))}))},{error:i}=await T.from("dog_albums").update({album_data:a,album_title:w,updated_at:new Date().toISOString()}).eq("id",n);if(i)throw i;m(x=>x.map(f=>f.id===n?{...f,album_title:w,page_count:o.pages.length,updated_at:new Date().toISOString()}:f)),Y(new Date),j(!1),O(!1),I("âœ… Album sauvegardÃ© avec succÃ¨s!","success")}catch(l){console.error("Erreur sauvegarde album:",l),I("âŒ Erreur lors de la sauvegarde","error")}finally{J(!1)}}},[t,n,o,w]),H=c.useCallback(async l=>{if(l)try{const{data:a,error:i}=await T.from("dog_albums").select("album_data, album_title, updated_at").eq("id",l).single();if(i&&i.code!=="PGRST116")throw i;if(a&&a.album_data){const x=a.album_data.pages.map(f=>({...f,photos:f.photos.map(A=>{const z=N.find($=>$.id===A.id);return{...A,url:(z==null?void 0:z.url)||""}}).filter(A=>A.url)}));P({pages:x}),D(a.album_title),Y(new Date(a.updated_at)),j(!1),I("âœ… Album chargÃ© avec succÃ¨s!","success")}}catch(a){console.error("Erreur chargement album:",a)}},[N]);c.useEffect(()=>{n&&N.length>0&&H(n)},[n,N.length,H]),c.useEffect(()=>{if(!U||!t)return;const l=setInterval(()=>{K()},12e4);return()=>clearInterval(l)},[U,t,K]);const I=(l,a="info")=>{const i=document.createElement("div");i.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${a==="success"?"#10b981":a==="error"?"#ef4444":"#3b82f6"};
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      z-index: 10001;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideIn 0.3s ease;
    `,i.textContent=l,document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideOut 0.3s ease",setTimeout(()=>document.body.removeChild(i),300)},3e3)};if(d)return e.jsx("div",{className:"photo-album-creator",children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})});if(!t)return e.jsxs("div",{className:"photo-album-creator",children:[e.jsx("div",{className:"album-header",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"CrÃ©ateur d'Album Photo Premium"})}),e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"max-w-2xl w-full p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"SÃ©lectionnez un chien pour crÃ©er son album"}),e.jsx("p",{className:"text-gray-600",children:"Choisissez le chien dont vous souhaitez utiliser les photos pour crÃ©er un album PDF"})]}),s.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Vous n'avez pas encore de chien enregistrÃ©."}),e.jsx("a",{href:"/dog-profile",className:"inline-block px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"Ajouter un chien"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(l=>e.jsxs("button",{onClick:()=>r(l.id),className:"flex items-center p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:l.photo_url?e.jsx("img",{src:l.photo_url,alt:l.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl",children:"ðŸ•"})}),e.jsxs("div",{className:"ml-4 text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600",children:l.breed})]})]},l.id))})]})})]});const q=s.find(l=>l.id===t);return e.jsxs("div",{className:"photo-album-creator",children:[e.jsxs("div",{className:"album-header",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800",children:["Album de ",q==null?void 0:q.name]}),e.jsx("button",{onClick:()=>r(null),className:"text-sm text-indigo-600 hover:text-indigo-700 mt-1",children:"â† Changer de chien"}),X&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-600",children:[e.jsx(Fe,{size:14,className:"text-green-500"}),e.jsxs("span",{children:["DerniÃ¨re sauvegarde: ",X.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}),U&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-orange-600",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Modifications non sauvegardÃ©es"})]})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{onClick:K,disabled:B||!U,className:"btn-secondary flex items-center gap-2",title:"Sauvegarder l'album",children:[e.jsx(re,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:B?"Sauvegarde...":"Sauvegarder"})]}),e.jsxs("button",{onClick:()=>Z(!L),className:"btn-secondary",children:[L?"Masquer":"Afficher"," les miniatures"]}),e.jsxs("button",{onClick:te,className:"btn-primary flex items-center gap-2",children:[e.jsx(oe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"TÃ©lÃ©charger PDF"}),e.jsx("span",{className:"sm:hidden",children:"PDF"})]})]})]}),t&&e.jsx(Ue,{albums:p,currentAlbumId:n,onSelectAlbum:R,onCreateAlbum:F,onRenameAlbum:k,onDeleteAlbum:M}),Q&&o.pages.some(l=>l.photos.length>0)&&e.jsxs("div",{className:"save-warning-banner",children:[e.jsxs("div",{className:"warning-content",children:[e.jsx(ie,{size:20,className:"flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:"ðŸ’¡ N'oubliez pas de sauvegarder votre travail !"}),e.jsx("p",{className:"text-sm mt-1",children:"Votre album est sauvegardÃ© automatiquement toutes les 2 minutes, mais pensez aussi Ã  le tÃ©lÃ©charger en PDF pour une copie permanente sur votre appareil."})]}),e.jsx("button",{onClick:()=>O(!1),className:"text-white hover:text-gray-200 flex-shrink-0",title:"Masquer ce message",children:"Ã—"})]}),e.jsxs("div",{className:"warning-actions",children:[e.jsxs("button",{onClick:K,className:"warning-btn-primary",children:[e.jsx(re,{size:16}),"Sauvegarder maintenant"]}),e.jsxs("button",{onClick:te,className:"warning-btn-secondary",children:[e.jsx(oe,{size:16}),"TÃ©lÃ©charger en PDF"]})]})]}),e.jsxs("div",{className:"album-main-content",children:[e.jsx($e,{photos:N,onRandomFill:_,dogName:q==null?void 0:q.name,selectedPhoto:V,onPhotoSelect:W}),e.jsxs("div",{className:"album-center",children:[e.jsx(Le,{pages:o.pages,currentPageIndex:S,onPageChange:g,onPhotoDrop:de,onRemovePhoto:pe,selectedPhoto:V,onPhotoSelect:W,onUpdatePhotoText:fe}),L&&e.jsx(Re,{pages:o.pages,currentPageIndex:S,onPageSelect:g,onReorder:ge,onDuplicate:he,onDelete:xe})]}),e.jsx(Me,{currentPage:o.pages[S],selectedLayout:E,onLayoutChange:l=>{C(l),me(o.pages[S].id,l)},onAddPage:ue,currentPageCount:o.pages.length,maxPages:v})]})]})},cs=()=>{const{user:s}=je(),{unreadCount:h}=ye(),t=Ne(),{showPremiumModal:r}=ve(),[d,b]=c.useState(!1),[p,m]=c.useState(!0),[n,u]=c.useState(null),[w,D]=c.useState([]);c.useEffect(()=>{const v=localStorage.getItem("currentDogProfile");v&&u(JSON.parse(v))},[]),c.useEffect(()=>{(async()=>{if(s!=null&&s.id)try{const{data:N,error:y}=await T.from("dogs").select("*").eq("user_id",s.id).order("created_at",{ascending:!0});if(y)throw y;N&&N.length>0&&(D(N),n||(u(N[0]),localStorage.setItem("currentDogProfile",JSON.stringify(N[0]))))}catch(N){console.error("Erreur chargement chiens:",N)}})()},[s==null?void 0:s.id]),c.useEffect(()=>{o()},[s==null?void 0:s.id]);const o=async()=>{try{const{data:{user:v}}=await T.auth.getUser();if(!v){m(!1);return}const{data:N}=await T.from("user_profiles").select("subscription_tier").eq("id",v.id).single(),S=["premium","professional"].includes(N==null?void 0:N.subscription_tier);b(S),S||r("photo-album")}catch(v){console.error("Erreur vÃ©rification premium:",v)}finally{m(!1)}},P=v=>{u(v),localStorage.setItem("currentDogProfile",JSON.stringify(v))};return p?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground",children:"Album Photo Premium"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>t("/notifications"),className:"relative p-1.5 sm:p-2 hover:bg-muted rounded-full transition-smooth",children:[e.jsx(ce,{size:20,className:"sm:w-6 sm:h-6 text-foreground"}),h>0&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center px-0.5 sm:px-1 text-[10px] sm:text-xs",children:h>9?"9+":h})]}),e.jsx(le,{dogProfiles:w,currentDog:n,onDogChange:P})]})]})})}),e.jsx(ae,{}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground",children:"Album Photo Premium"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>t("/notifications"),className:"relative p-1.5 sm:p-2 hover:bg-muted rounded-full transition-smooth",children:[e.jsx(ce,{size:20,className:"sm:w-6 sm:h-6 text-foreground"}),h>0&&e.jsx("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs font-bold rounded-full min-w-[16px] h-4 sm:min-w-[20px] sm:h-5 flex items-center justify-center px-0.5 sm:px-1 text-[10px] sm:text-xs",children:h>9?"9+":h})]}),e.jsx(le,{dogProfiles:w,currentDog:n,onDogChange:P})]})]})})}),e.jsx(ae,{}),e.jsx("main",{className:"main-content flex-1",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-heading font-bold text-foreground mb-1 sm:mb-2",children:"ðŸ“¸ Album Photo Premium"}),e.jsx("p",{className:"text-muted-foreground font-caption text-sm sm:text-base",children:"CrÃ©ez des albums photo personnalisÃ©s et tÃ©lÃ©chargez-les en PDF"})]}),d?e.jsx(Ze,{}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Cette fonctionnalitÃ© est rÃ©servÃ©e aux membres Premium"}),e.jsx("button",{onClick:()=>r("photo-album"),className:"px-6 py-3 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition-all",children:"DÃ©couvrir Premium"})]})]})}),e.jsx(we,{})]})};export{cs as default};
