import{s as a,j as e,u as be,I as h}from"./index-CLNZn26n.js";import{r as d,e as je,d as ye}from"./vendor-react-DEK6ZklB.js";import{U as _e}from"./UserMenuPro-BipQOr0O.js";import{V as ve,T as ee,W as we,H as Ne,A as Ee,a as re,b as Se,E as Pe,P as ze}from"./PhotoGalleryModal-D_8G8gXj.js";import{X as se,m as Ce,a5 as M,ah as Ae,j as qe,U as ke,e as Fe,M as te,_ as ae,n as De,A as Te}from"./vendor-ui-DjEwDNDD.js";import"./vendor-supabase-DfwcnzK-.js";import"./Button-DdMeh4nY.js";import"./PremiumModal-CYhzDuHB.js";import"./index-1Ar5VAb3.js";import"./Input-BslhWPyc.js";const $e=({isOpen:i,onClose:j,dog:m,proAccount:y,onSuccess:T})=>{const[N,_]=d.useState(!1),[u,q]=d.useState([]),[s,z]=d.useState(""),[p,C]=d.useState(null);d.useEffect(()=>{i&&y&&k()},[i,y]);const k=async()=>{try{_(!0);const{data:o,error:f}=await a.from("contacts").select("*").eq("professional_account_id",y.id).in("type",["foster_family","both"]).eq("status","active").order("full_name");if(f)throw f;const x=o.filter(g=>g.availability==="available"&&g.current_dogs_count<g.max_dogs);q(x)}catch(o){console.error("Erreur chargement FA:",o),alert("Erreur lors du chargement des familles d'accueil")}finally{_(!1)}},F=u.filter(o=>{var f,x;return((f=o.full_name)==null?void 0:f.toLowerCase().includes(s.toLowerCase()))||((x=o.city)==null?void 0:x.toLowerCase().includes(s.toLowerCase()))}),D=async()=>{if(!p){alert("Veuillez sÃ©lectionner une famille d'accueil");return}if(confirm(`Placer ${m.name} chez ${p.full_name} ?`))try{_(!0);const{data:o}=await a.from("placement_history").select("*").eq("dog_id",m.id).eq("status","active").eq("placement_type","foster").single();if(o){alert(`âŒ ${m.name} est dÃ©jÃ  placÃ© en famille d'accueil !

Veuillez d'abord le retirer de sa FA actuelle.`);return}const{error:f}=await a.from("placement_history").insert([{contact_id:p.id,dog_id:m.id,professional_account_id:y.id,placement_type:"foster",start_date:new Date().toISOString(),status:"active"}]);if(f)throw f;const{error:x}=await a.from("dogs").update({foster_family_contact_id:p.id,foster_family_user_id:p.user_id||null}).eq("id",m.id);if(x)throw x;const{error:g}=await a.from("contacts").update({current_dogs_count:p.current_dogs_count+1}).eq("id",p.id);if(g)throw g;alert(`âœ… ${m.name} a Ã©tÃ© placÃ© chez ${p.full_name} !`),T(),j()}catch(o){console.error("Erreur placement:",o),alert("âŒ Erreur lors du placement: "+o.message)}finally{_(!1)}};return i?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-card border-b border-border px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-heading font-bold text-foreground",children:["Placer ",m.name," en famille d'accueil"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[u.length," famille",u.length>1?"s":""," d'accueil disponible",u.length>1?"s":""]})]}),e.jsx("button",{onClick:j,className:"p-2 hover:bg-muted rounded-lg transition-smooth min-h-[44px] min-w-[44px]",children:e.jsx(se,{size:20})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20}),e.jsx("input",{type:"text",value:s,onChange:o=>z(o.target.value),placeholder:"Rechercher une famille d'accueil...",className:"w-full pl-10 pr-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),N?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]}):F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{size:48,className:"text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-foreground font-medium mb-2",children:"Aucune famille d'accueil disponible"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?"Essayez avec d'autres mots-clÃ©s":"Toutes les familles d'accueil sont actuellement complÃ¨tes"})]}):e.jsx("div",{className:"space-y-3",children:F.map(o=>{var f;return e.jsx("button",{onClick:()=>C(o),className:`w-full text-left p-4 rounded-xl border-2 transition-all ${(p==null?void 0:p.id)===o.id?"border-primary bg-primary/5":"border-border hover:border-primary/50 bg-background"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xl font-bold flex-shrink-0",children:(f=o.full_name)==null?void 0:f.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:o.full_name}),o.rating&&e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((x,g)=>e.jsx(Ae,{size:12,className:g<o.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"},g))})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-muted-foreground mb-2",children:[o.city&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{size:14}),o.city]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14}),o.current_dogs_count,"/",o.max_dogs," chien",o.max_dogs>1?"s":""]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{size:14}),o.total_dogs_fostered," total accueillis"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.housing_type&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full capitalize",children:o.housing_type.replace("_"," ")}),o.has_garden&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full",children:"Jardin"}),o.preferred_size!=="all"&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full capitalize",children:["PrÃ©fÃ¨re ",o.preferred_size]})]}),o.preferences_notes&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 italic",children:['"',o.preferences_notes,'"']})]})]})},o.id)})}),e.jsxs("div",{className:"flex gap-3 mt-6 pt-6 border-t border-border",children:[e.jsx("button",{onClick:j,className:"flex-1 py-3 border-2 border-border rounded-xl font-medium hover:bg-muted transition-smooth min-h-[44px]",children:"Annuler"}),e.jsx("button",{onClick:D,disabled:!p||N,className:"flex-1 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth min-h-[44px]",children:N?"Placement en cours...":"Placer en famille d'accueil"})]})]})]})}):null},Me=({isOpen:i,onClose:j,dog:m,proAccount:y,onSuccess:T})=>{var o;const[N,_]=d.useState(!1),[u,q]=d.useState(""),[s,z]=d.useState(null),[p,C]=d.useState("email"),k=async f=>{if(f.preventDefault(),!u){alert("Veuillez saisir un email");return}try{_(!0);const{data:x,error:g}=await a.from("user_profiles").select("*").eq("email",u.toLowerCase().trim()).single();if(g||!x){alert(`âŒ Aucun utilisateur trouvÃ© avec cet email.
Assurez-vous que la personne a crÃ©Ã© un compte sur Woofly.`);return}z(x),C("confirm")}catch(x){console.error("Erreur recherche adoptant:",x),alert("Erreur lors de la recherche")}finally{_(!1)}},F=async()=>{if(s&&confirm(`TransfÃ©rer dÃ©finitivement ${m.name} Ã  ${s.full_name||s.email} ?

âš ï¸ Cette action est irrÃ©versible. Le refuge perdra l'accÃ¨s Ã  ce chien.`))try{if(_(!0),m.foster_family_contact_id){const{data:g}=await a.from("placement_history").select("*").eq("dog_id",m.id).eq("status","active").eq("placement_type","foster").single();g&&(await a.from("placement_history").update({end_date:new Date().toISOString(),status:"completed",end_reason:"adopted"}).eq("id",g.id),await a.from("contacts").update({current_dogs_count:a.raw("current_dogs_count - 1")}).eq("id",g.contact_id))}const{error:f}=await a.from("placement_history").insert([{contact_id:null,dog_id:m.id,professional_account_id:y.id,placement_type:"adoption",start_date:new Date().toISOString(),end_date:new Date().toISOString(),status:"completed",end_reason:"adopted"}]);if(f)throw f;const{error:x}=await a.from("dogs").update({professional_account_id:null,user_id:s.id,foster_family_user_id:null,foster_family_contact_id:null,adoption_status:"adopted"}).eq("id",m.id);if(x)throw x;alert(`âœ… ${m.name} a Ã©tÃ© transfÃ©rÃ© avec succÃ¨s Ã  ${s.full_name||s.email} !

Le chien apparaÃ®t maintenant dans le compte de l'adoptant.`),T(),j()}catch(f){console.error("Erreur transfert:",f),alert("âŒ Erreur lors du transfert: "+f.message)}finally{_(!1)}},D=()=>{q(""),z(null),C("email")};return i?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card rounded-2xl max-w-lg w-full",children:[e.jsxs("div",{className:"border-b border-border px-6 py-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-heading font-bold text-foreground",children:["TransfÃ©rer ",m.name," Ã  un adoptant"]}),e.jsx("button",{onClick:()=>{D(),j()},className:"p-2 hover:bg-muted rounded-lg transition-smooth min-h-[44px] min-w-[44px]",children:e.jsx(se,{size:20})})]}),e.jsxs("div",{className:"p-6",children:[p==="email"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Fe,{size:20,className:"text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"âš ï¸ Transfert dÃ©finitif"}),e.jsx("p",{children:"L'adoptant deviendra propriÃ©taire du chien. Vous perdrez l'accÃ¨s Ã  cette fiche."})]})]})}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Email de l'adoptant *"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20}),e.jsx("input",{type:"email",value:u,onChange:f=>q(f.target.value),required:!0,placeholder:"exemple@email.com",className:"w-full pl-10 pr-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"L'adoptant doit avoir crÃ©Ã© un compte sur Woofly"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{D(),j()},className:"flex-1 py-3 border-2 border-border rounded-xl font-medium hover:bg-muted transition-smooth min-h-[44px]",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:N||!u,className:"flex-1 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth min-h-[44px]",children:N?"Recherche...":"Rechercher"})]})]})]}),p==="confirm"&&s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-500 text-white flex items-center justify-center text-xl font-bold flex-shrink-0",children:((o=s.full_name)==null?void 0:o.charAt(0).toUpperCase())||s.email.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"Utilisateur trouvÃ© !"}),e.jsxs("div",{className:"space-y-1 text-sm text-green-800",children:[s.full_name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:14}),e.jsx("span",{children:s.full_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{size:14}),e.jsx("span",{children:s.email})]})]})]})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Ce qui va se passer :"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"1."}),e.jsxs("span",{children:[m.name," sera transfÃ©rÃ© dans le compte de ",s.full_name||"l'adoptant"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"2."}),e.jsx("span",{children:"L'adoptant aura un accÃ¨s complet Ã  la fiche (modification, vaccins, rappels...)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"3."}),e.jsx("span",{children:"Votre refuge perdra l'accÃ¨s Ã  cette fiche"})]}),m.foster_family_user_id&&e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:"4."}),e.jsx("span",{children:"Le placement en famille d'accueil sera automatiquement fermÃ©"})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>C("email"),className:"flex-1 py-3 border-2 border-border rounded-xl font-medium hover:bg-muted transition-smooth min-h-[44px]",children:"Retour"}),e.jsx("button",{onClick:F,disabled:N,className:"flex-1 py-3 bg-green-600 text-white rounded-xl font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-smooth min-h-[44px]",children:N?"Transfert...":"Confirmer le transfert"})]})]})]})]})}):null},Je=()=>{var K,Q;const{dogId:i}=je(),j=ye(),{user:m}=be(),[y,T]=d.useState("vaccinations"),[N,_]=d.useState(!0),[u,q]=d.useState(null),[s,z]=d.useState(null),[p,C]=d.useState([]),[k,F]=d.useState([]),[D,o]=d.useState([]),[f,x]=d.useState({allergies:"",medications:"",veterinaryNotes:"",veterinarian:"",veterinarianPhone:""}),[g,V]=d.useState([]),[R,O]=d.useState(!1),[S,W]=d.useState({vaccination:!1,vermifuge:!1,flea:!1,weight:!1,editProfile:!1,gallery:!1}),[A,I]=d.useState(null),[oe,G]=d.useState(!1),[ne,H]=d.useState(!1),[P,U]=d.useState(null);d.useEffect(()=>{if(!(m!=null&&m.id))return;(async()=>{try{const{data:r,error:n}=await a.from("professional_accounts").select("*").eq("user_id",m.id).single();if(n)throw n;console.log("âœ… Compte pro chargÃ©:",r.id),q(r)}catch(r){console.error("Erreur chargement compte pro:",r)}})()},[m==null?void 0:m.id]),d.useEffect(()=>{if(!i||!(u!=null&&u.id))return;(async()=>{_(!0);try{const{data:r,error:n}=await a.from("dogs").select("*").eq("id",i).eq("professional_account_id",u.id).single();if(n)throw n;const l=new Date(r.birth_date),c=new Date;let b=c.getFullYear()-l.getFullYear();const w=c.getMonth()-l.getMonth();(w<0||w===0&&c.getDate()<l.getDate())&&b--,console.log("ðŸ• Chien chargÃ©:",r.name),console.log("ðŸ“ foster_family_contact_id:",r.foster_family_contact_id),console.log("ðŸ‘¤ foster_family_user_id:",r.foster_family_user_id),z({id:r.id,name:r.name,breed:r.breed||"Race inconnue",age:b>0?`${b} an${b>1?"s":""}`:"Moins d'un an",weight:r.weight?`${r.weight} kg`:"Non renseignÃ©",gender:r.gender||"Non renseignÃ©",sterilized:r.is_sterilized?"StÃ©rilisÃ©":"Non stÃ©rilisÃ©",image:r.photo_url||"https://images.pexels.com/photos/1490908/pexels-photo-1490908.jpeg",imageAlt:`${r.name} - ${r.breed}`,microchip_number:r.microchip_number,notes:r.notes,cover_photo_url:r.cover_photo_url||null,adoption_status:r.adoption_status,is_for_adoption:r.is_for_adoption,foster_family_user_id:r.foster_family_user_id,foster_family_contact_id:r.foster_family_contact_id}),r.foster_family_contact_id?he(r.foster_family_contact_id,u.id):U(null)}catch(r){console.error("Erreur chargement chien:",r),alert("Erreur lors du chargement du chien"),j("/pro/dashboard")}finally{_(!1)}})()},[i,u==null?void 0:u.id,j]),d.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:n}=await a.from("vaccinations").select("*").eq("dog_id",i).order("next_due_date",{ascending:!0});if(n)throw n;const l=r.map(c=>({id:c.id,name:c.vaccine_name,lastDate:new Date(c.vaccination_date).toLocaleDateString("fr-FR"),nextDate:c.next_due_date?new Date(c.next_due_date).toLocaleDateString("fr-FR"):"Non dÃ©fini",veterinarian:c.veterinarian,notes:c.notes}));C(l)}catch(r){console.error("Erreur chargement vaccinations:",r)}})()},[i]),d.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:n}=await a.from("treatments").select("*").eq("dog_id",i).order("next_due_date",{ascending:!0});if(n)throw n;const l=r.map(c=>({id:c.id,product:c.product_name,lastDate:new Date(c.treatment_date).toLocaleDateString("fr-FR"),nextDate:c.next_due_date?new Date(c.next_due_date).toLocaleDateString("fr-FR"):"Non dÃ©fini",notes:c.notes,type:c.treatment_type}));F(l)}catch(r){console.error("Erreur chargement traitements:",r)}})()},[i]),d.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:n}=await a.from("weight_records").select("*").eq("dog_id",i).order("measurement_date",{ascending:!0});if(n)throw n;const l=r.map(c=>({date:new Date(c.measurement_date).toLocaleDateString("fr-FR"),weight:parseFloat(c.weight)}));o(l)}catch(r){console.error("Erreur chargement poids:",r)}})()},[i]),d.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:n}=await a.from("health_notes").select("*").eq("dog_id",i).order("note_date",{ascending:!1}).limit(1);if(n)throw n;if(r&&r.length>0){const l=r[0];x({allergies:l.allergies||"",medications:l.medications||"",veterinaryNotes:l.veterinary_notes||"",veterinarian:l.veterinarian||"",veterinarianPhone:l.veterinarian_phone||""})}}catch(r){console.error("Erreur chargement notes mÃ©dicales:",r)}})()},[i]),d.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:n}=await a.from("dog_photos").select("*").eq("dog_id",i).order("created_at",{ascending:!1});if(n)throw n;V(r||[])}catch(r){console.error("Erreur chargement galerie:",r)}})()},[i]);const v=(t,r=null)=>{I(r),W({...S,[t]:!0})},E=t=>{W({...S,[t]:!1}),I(null)},ie=async t=>{try{if(A){const{error:r}=await a.from("vaccinations").update({vaccine_name:t.name,vaccination_date:t.lastDate,next_due_date:t.nextDate,veterinarian:t.veterinarian,notes:t.notes}).eq("id",A.id);if(r)throw r;alert("âœ… Vaccination mise Ã  jour !")}else{const{error:r}=await a.from("vaccinations").insert([{dog_id:i,vaccine_name:t.name,vaccination_date:t.lastDate,next_due_date:t.nextDate,veterinarian:t.veterinarian,notes:t.notes}]);if(r)throw r;alert("âœ… Vaccination ajoutÃ©e !")}E("vaccination"),window.location.reload()}catch(r){console.error("Erreur sauvegarde vaccination:",r),alert("âŒ Erreur lors de la sauvegarde")}},le=async t=>{if(confirm("Supprimer cette vaccination ?"))try{const{error:r}=await a.from("vaccinations").delete().eq("id",t);if(r)throw r;alert("âœ… Vaccination supprimÃ©e"),window.location.reload()}catch(r){console.error("Erreur suppression:",r),alert("âŒ Erreur lors de la suppression")}},B=async(t,r)=>{try{const n=r==="vermifuge"?"worm":r==="flea"?"flea":"tick";if(A){const{error:l}=await a.from("treatments").update({product_name:t.product,treatment_date:t.lastDate,next_due_date:t.nextDate,notes:t.notes,treatment_type:n}).eq("id",A.id);if(l)throw l;alert("âœ… Traitement mis Ã  jour !")}else{const{error:l}=await a.from("treatments").insert([{dog_id:i,product_name:t.product,treatment_date:t.lastDate,next_due_date:t.nextDate,notes:t.notes,treatment_type:n}]);if(l)throw l;alert("âœ… Traitement ajoutÃ© !")}E(r),window.location.reload()}catch(n){console.error("Erreur sauvegarde traitement:",n),alert("âŒ Erreur lors de la sauvegarde")}},J=async t=>{if(confirm("Supprimer ce traitement ?"))try{const{error:r}=await a.from("treatments").delete().eq("id",t);if(r)throw r;alert("âœ… Traitement supprimÃ©"),window.location.reload()}catch(r){console.error("Erreur suppression:",r),alert("âŒ Erreur lors de la suppression")}},ce=async t=>{try{const{error:r}=await a.from("weight_records").insert([{dog_id:i,weight:parseFloat(t.weight),measurement_date:t.date}]);if(r)throw r;await a.from("dogs").update({weight:parseFloat(t.weight)}).eq("id",i),alert("âœ… Poids ajoutÃ© !"),E("weight"),window.location.reload()}catch(r){console.error("Erreur sauvegarde poids:",r),alert("âŒ Erreur lors de la sauvegarde")}},de=async t=>{try{const{error:r}=await a.from("dogs").update({name:t.name,breed:t.breed,birth_date:t.birthDate,gender:t.gender,is_sterilized:t.sterilized==="StÃ©rilisÃ©",microchip_number:t.microchipNumber,notes:t.notes}).eq("id",i);if(r)throw r;alert("âœ… Profil mis Ã  jour !"),E("editProfile"),window.location.reload()}catch(r){console.error("Erreur mise Ã  jour profil:",r),alert("âŒ Erreur lors de la mise Ã  jour")}},me=async t=>{try{const{error:r}=await a.from("dogs").update({photo_url:t}).eq("id",i);if(r)throw r;alert("âœ… Photo de profil mise Ã  jour !"),window.location.reload()}catch(r){console.error("Erreur mise Ã  jour photo:",r),alert("âŒ Erreur lors de la mise Ã  jour")}},ue=async t=>{var c;const r=(c=t.target.files)==null?void 0:c[0];if(!r)return;const n=5*1024*1024;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(r.type)){alert("âš ï¸ Format non supportÃ©. Utilisez JPG, PNG ou WebP");return}if(r.size>n){alert("âš ï¸ Fichier trop volumineux (max 5 MB)");return}try{O(!0);const b=r.name.split(".").pop().toLowerCase(),w=`${m.id}/${i}/cover_${Date.now()}.${b}`,{error:L}=await a.storage.from("dog-photos").upload(w,r);if(L)throw L;const{data:{publicUrl:$}}=a.storage.from("dog-photos").getPublicUrl(w),{error:Z}=await a.from("dogs").update({cover_photo_url:$}).eq("id",i);if(Z)throw Z;z({...s,cover_photo_url:$}),alert("âœ… Photo de couverture mise Ã  jour !")}catch(b){console.error("Erreur upload couverture:",b),alert("âŒ Erreur lors de l'upload: "+b.message)}finally{O(!1)}},fe=async t=>{if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(t.type)||t.size>5242880){alert("âš ï¸ Fichier invalide ou trop volumineux");return}try{const l=t.name.split(".").pop().toLowerCase(),c=`${m.id}/${i}/${Date.now()}.${l}`,{error:b}=await a.storage.from("dog-photos").upload(c,t);if(b)throw b;const{data:{publicUrl:w}}=a.storage.from("dog-photos").getPublicUrl(c),{data:L,error:$}=await a.from("dog_photos").insert([{dog_id:i,photo_url:w,created_at:new Date().toISOString()}]).select().single();if($)throw $;V([L,...g]),alert("âœ… Photo ajoutÃ©e avec succÃ¨s !")}catch(l){console.error("Erreur upload photo:",l),alert("âŒ Erreur lors de l'upload: "+l.message)}},xe=()=>{alert(`ðŸ“„ Export PDF en dÃ©veloppement

Le fichier "${s==null?void 0:s.name}_fiche_sante.pdf" sera gÃ©nÃ©rÃ©`)},he=async(t,r)=>{if(!t||!r){console.log("âŒ Impossible de charger FA - paramÃ¨tres manquants"),console.log("   - fosterFamilyContactId:",t),console.log("   - professionalAccountId:",r),U(null);return}console.log("ðŸ” Chargement FA:",t,"pour pro:",r);try{const{data:n,error:l}=await a.from("contacts").select("*").eq("id",t).eq("professional_account_id",r).single();if(l)throw l;console.log("âœ… FA chargÃ©e:",n.full_name),U(n)}catch(n){console.error("âŒ Erreur chargement FA:",n),U(null)}},pe=async()=>{if(confirm(`Retirer ${s.name} de chez ${P==null?void 0:P.full_name} ?`))try{console.log("ðŸ”„ DÃ©but retour au refuge pour chien:",s.id),console.log("ðŸ“‹ FA actuelle (contact):",s.foster_family_contact_id),console.log("ðŸ“‹ FA actuelle (user):",s.foster_family_user_id);const{data:t,error:r}=await a.from("placement_history").select("*").eq("dog_id",s.id).eq("status","active").eq("placement_type","foster").maybeSingle();if(r)throw console.error("âŒ Erreur recherche placement:",r),r;if(console.log("ðŸ“ Placement actif trouvÃ©:",t),t){const{error:l}=await a.from("placement_history").update({end_date:new Date().toISOString(),status:"completed",end_reason:"returned"}).eq("id",t.id);if(l)throw console.error("âŒ Erreur fermeture placement:",l),l;console.log("âœ… Placement fermÃ© avec succÃ¨s");const{data:c}=await a.from("contacts").select("current_dogs_count").eq("id",t.contact_id).single(),b=Math.max(0,((c==null?void 0:c.current_dogs_count)||1)-1),{error:w}=await a.from("contacts").update({current_dogs_count:b}).eq("id",t.contact_id);if(w)throw console.error("âŒ Erreur dÃ©crÃ©mentation compteur:",w),w;console.log("âœ… Compteur FA dÃ©crÃ©mentÃ©:",b)}const{error:n}=await a.from("dogs").update({foster_family_user_id:null,foster_family_contact_id:null}).eq("id",s.id);if(n)throw console.error("âŒ Erreur mise Ã  jour chien:",n),n;console.log("âœ… Chien mis Ã  jour - retour au refuge"),alert(`âœ… ${s.name} a Ã©tÃ© retirÃ© de la famille d'accueil`),window.location.reload()}catch(t){console.error("ðŸ’¥ Erreur retour FA:",t),alert("âŒ Erreur lors du retour: "+t.message)}},ge=[{id:"vaccinations",label:"Vaccinations",icon:"Syringe"},{id:"vermifuge",label:"Vermifuge",icon:"Pill"},{id:"flea",label:"Anti-puces",icon:"Bug"},{id:"weight",label:"Poids",icon:"TrendingUp"},{id:"notes",label:"Notes mÃ©dicales",icon:"FileText"}],Y=k.filter(t=>t.type==="worm"),X=k.filter(t=>t.type==="flea"||t.type==="tick");return N?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})}):s?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>j("/pro/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-smooth",children:e.jsx(De,{size:20})}),e.jsx("h1",{className:"text-lg sm:text-2xl font-heading font-semibold text-foreground truncate",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:xe,className:"hidden sm:flex px-4 py-2 border-2 border-border rounded-xl font-medium hover:bg-muted items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Download",size:16}),"Exporter fiche"]}),e.jsx(_e,{})]})]})})}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative h-48 sm:h-64 md:h-80 bg-gradient-to-br from-green-500 to-teal-600 overflow-hidden",children:[s.cover_photo_url?e.jsx("img",{src:s.cover_photo_url,alt:`Couverture de ${s.name}`,className:"w-full h-full object-cover object-center"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white/30",children:e.jsx(h,{name:"Image",size:48})}),e.jsxs("label",{htmlFor:"cover-photo-upload",className:"absolute bottom-4 right-4 bg-white/90 hover:bg-white px-4 py-2 rounded-lg cursor-pointer shadow-lg transition-smooth flex items-center gap-2",children:[e.jsx(h,{name:"Camera",size:16}),e.jsx("span",{className:"font-medium text-sm",children:R?"Upload...":"Modifier couverture"}),e.jsx("input",{id:"cover-photo-upload",type:"file",accept:"image/*",onChange:ue,className:"hidden",disabled:R})]})]}),e.jsx("div",{className:"relative max-w-7xl mx-auto px-3 sm:px-4",children:e.jsxs("div",{className:"flex items-end gap-4 -mt-16 pb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-card bg-gradient-to-br from-green-500 to-teal-600 overflow-hidden shadow-xl",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white text-4xl font-bold",children:(K=s.name)==null?void 0:K.charAt(0).toUpperCase()})}),e.jsx("button",{onClick:()=>v("gallery"),className:"absolute bottom-0 right-0 bg-primary hover:bg-primary/90 text-white p-3 rounded-full shadow-lg transition-smooth",children:e.jsx(h,{name:"Camera",size:20})})]}),e.jsx("div",{className:"flex-1 pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-heading font-bold text-foreground",children:s.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-muted-foreground text-sm mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{name:"Dog",size:16}),s.breed]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(h,{name:"Calendar",size:16}),s.age]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"flex items-center gap-1",children:s.gender==="male"?e.jsxs(e.Fragment,{children:[e.jsx(h,{name:"Mars",size:16})," MÃ¢le"]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{name:"Venus",size:16})," Femelle"]})})]})]}),e.jsxs("button",{onClick:()=>v("editProfile"),className:"px-4 py-2 border-2 border-border rounded-xl font-medium hover:bg-muted flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Edit",size:16}),"Modifier"]})]})})]})})]}),s&&s.adoption_status!=="adopted"&&(u==null?void 0:u.id)&&e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 pb-6",children:e.jsx("div",{className:"bg-card rounded-xl shadow-soft p-6 border border-border",children:s.foster_family_contact_id&&P?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-xl border border-purple-200",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500 text-white flex items-center justify-center text-xl font-bold",children:(Q=P.full_name)==null?void 0:Q.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-purple-700 font-medium",children:"Actuellement en famille d'accueil"}),e.jsx("p",{className:"text-lg font-bold text-purple-900",children:P.full_name}),P.city&&e.jsx("p",{className:"text-sm text-purple-600",children:P.city})]}),e.jsx(M,{size:24,className:"text-purple-600"})]}),e.jsxs("button",{onClick:pe,className:"w-full px-6 py-3 bg-orange-500 text-white rounded-xl font-medium hover:bg-orange-600 transition-smooth flex items-center justify-center gap-2 min-h-[44px]",children:[e.jsx(Te,{size:20,className:"rotate-180"}),"Retour du chien au refuge"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-xl border border-green-200",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-500 text-white flex items-center justify-center",children:e.jsx(M,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Chien disponible au refuge"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:"PrÃªt pour placement ou transfert"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>G(!0),className:"px-6 py-3 bg-purple-500 text-white rounded-xl font-medium hover:bg-purple-600 transition-smooth flex items-center justify-center gap-2 min-h-[44px]",children:[e.jsx(M,{size:20}),"Placer en famille d'accueil"]}),e.jsxs("button",{onClick:()=>H(!0),className:"px-6 py-3 bg-pink-500 text-white rounded-xl font-medium hover:bg-pink-600 transition-smooth flex items-center justify-center gap-2 min-h-[44px]",children:[e.jsx(ae,{size:20}),"TransfÃ©rer Ã  un adoptant"]})]})]})})}),e.jsx("main",{className:"main-content flex-1",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-6",children:e.jsxs("div",{className:"bg-card rounded-xl shadow-soft border border-border",children:[e.jsx("div",{className:"border-b border-border",children:e.jsx("div",{className:"flex overflow-x-auto",children:ge.map(t=>e.jsxs("button",{onClick:()=>T(t.id),className:`flex items-center gap-2 px-6 py-3 font-medium transition-smooth border-b-2 ${y===t.id?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(h,{name:t.icon,size:20}),t.label]},t.id))})}),e.jsxs("div",{className:"p-6",children:[y==="vaccinations"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-heading font-semibold",children:"Vaccinations"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["GÃ©rez le calendrier vaccinal de ",s.name]})]}),e.jsxs("button",{onClick:()=>v("vaccination"),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Plus",size:16}),"Ajouter"]})]}),p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(h,{name:"Syringe",size:32,color:"var(--color-muted-foreground)"})}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucune vaccination enregistrÃ©e"}),e.jsxs("button",{onClick:()=>v("vaccination"),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 inline-flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Plus",size:16}),"Ajouter une vaccination"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:p.map(t=>e.jsx(ve,{vaccination:t,onEdit:r=>v("vaccination",r),onDelete:le},t.id))})]}),y==="vermifuge"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-heading font-semibold",children:"Vermifuge"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Suivez les traitements antiparasitaires internes"})]}),e.jsxs("button",{onClick:()=>v("vermifuge"),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Plus",size:16}),"Ajouter"]})]}),Y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(h,{name:"Pill",size:32,color:"var(--color-muted-foreground)"})}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun traitement vermifuge enregistrÃ©"}),e.jsxs("button",{onClick:()=>v("vermifuge"),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 inline-flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Plus",size:16}),"Ajouter un traitement"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Y.map(t=>e.jsx(ee,{treatment:t,type:"vermifuge",onEdit:r=>v("vermifuge",r),onDelete:J},t.id))})]}),y==="flea"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-heading font-semibold",children:"Anti-puces et tiques"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"GÃ©rez les traitements antiparasitaires externes"})]}),e.jsxs("button",{onClick:()=>v("flea"),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Plus",size:16}),"Ajouter"]})]}),X.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(h,{name:"Bug",size:32,color:"var(--color-muted-foreground)"})}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun traitement anti-puces enregistrÃ©"}),e.jsxs("button",{onClick:()=>v("flea"),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 inline-flex items-center gap-2 min-h-[44px]",children:[e.jsx(h,{name:"Plus",size:16}),"Ajouter un traitement"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:X.map(t=>e.jsx(ee,{treatment:t,type:"flea",onEdit:r=>v("flea",r),onDelete:J},t.id))})]}),y==="weight"&&e.jsx(we,{data:D,onAddWeight:()=>v("weight")}),y==="notes"&&e.jsx(Ne,{notes:f,onSave:x})]})]})})}),e.jsx(Ee,{isOpen:S.vaccination,onClose:()=>E("vaccination"),onSave:ie,editData:A}),e.jsx(re,{isOpen:S.vermifuge,onClose:()=>E("vermifuge"),onSave:t=>B(t,"vermifuge"),editData:A,type:"vermifuge"}),e.jsx(re,{isOpen:S.flea,onClose:()=>E("flea"),onSave:t=>B(t,"flea"),editData:A,type:"flea"}),e.jsx(Se,{isOpen:S.weight,onClose:()=>E("weight"),onSave:ce}),e.jsx(Pe,{isOpen:S.editProfile,onClose:()=>E("editProfile"),onSave:de,profile:s}),e.jsx(ze,{isOpen:S.gallery,onClose:()=>E("gallery"),photos:g,onAddPhoto:fe,currentProfilePhotoUrl:s==null?void 0:s.image,onSetProfilePhoto:me}),e.jsx($e,{isOpen:oe,onClose:()=>G(!1),dog:s,proAccount:u,onSuccess:()=>window.location.reload()}),e.jsx(Me,{isOpen:ne,onClose:()=>H(!1),dog:s,proAccount:u,onSuccess:()=>j("/pro/dashboard")})]}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Chien non trouvÃ©"}),e.jsx("button",{onClick:()=>j("/pro/dashboard"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth",children:"Retour au dashboard"})]})})};export{Je as default};
