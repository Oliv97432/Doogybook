import{r as o,j as e,l as T,X as q,f as I,O as U,i as E,d as F,ae as L,af as B,a0 as O,w as z,P as w}from"./vendor-react-CkOypKSt.js";import{s as f,u as V}from"./index-CmpvQ7zl.js";import{T as R}from"./TabNavigation-U9FZqoY9.js";import{U as G}from"./UserMenu-z7rjEeqh.js";import{F as X}from"./Footer-1uazuOPJ.js";import{P as H}from"./PremiumModal-CZbcugw6.js";import{i as k,a as p,d as C,b as J,f as K,c as Q}from"./vendor-dates-2Xb9G2d6.js";import{b as W}from"./vendor-router-M7WQPhYn.js";import"./vendor-misc-B8HVOz_X.js";import"./vendor-pdf-lazy-D4am8o_0.js";import"./vendor-supabase-DEZzVAXw.js";const Y=({reminder:t,onDeleted:m,onCompleted:j})=>{var y,x;const[u,d]=o.useState(!1),[v,h]=o.useState(!1),b=s=>{switch(s){case"vaccin":return e.jsx(B,{className:"text-red-500",size:20});case"vermifuge":return e.jsx(L,{className:"text-orange-500",size:20});case"antiparasitaire":return e.jsx(F,{className:"text-green-500",size:20});default:return e.jsx(E,{className:"text-blue-500",size:20})}},l=s=>{switch(s){case"vaccin":return"Vaccin";case"vermifuge":return"Vermifuge";case"antiparasitaire":return"Antiparasitaire";default:return"Rappel"}},_=(s,r)=>{if(r)return"bg-gray-50 dark:bg-gray-800 border-gray-200 dark:border-gray-700";const i=new Date(s),n=C(i,new Date);return k(i)&&!p(i)?"bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-700":p(i)?"bg-orange-50 dark:bg-orange-900/20 border-orange-300 dark:border-orange-700":n<=7?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 dark:border-yellow-700":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"},c=s=>{const r=new Date(s);if(k(r)&&!p(r)){const n=Math.abs(C(r,new Date));return`En retard de ${n} jour${n>1?"s":""}`}if(p(r))return"Aujourd'hui";if(J(r))return"Demain";const i=C(r,new Date);return i<=7?`Dans ${i} jour${i>1?"s":""}`:K(r,"dd MMMM yyyy",{locale:Q})},g=async()=>{h(!0);try{j(t.id,!t.is_completed)}catch(s){console.error("Erreur marquage rappel:",s)}finally{h(!1)}},N=async()=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer ce rappel ?

Note: Cela supprimera la ${t.source==="vaccination"?"vaccination":"traitement"} associé(e).`)){d(!0);try{const s=t.source==="vaccination"?"vaccinations":"treatments",{error:r}=await f.from(s).delete().eq("id",t.original_id);if(r)throw r;m(t.id)}catch(s){console.error("Erreur suppression rappel:",s),alert("Erreur lors de la suppression")}finally{d(!1)}}};return e.jsx("div",{className:`rounded-3xl p-4 sm:p-6 border-2 transition-all ${_(t.due_date,t.is_completed)}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-shrink-0",children:b(t.reminder_type)}),e.jsxs("div",{className:"flex items-center gap-2",children:[((y=t.dogs)==null?void 0:y.profile_image_url)&&e.jsx("img",{src:t.dogs.profile_image_url,alt:t.dogs.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-900 dark:text-gray-100 text-sm",children:(x=t.dogs)==null?void 0:x.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l(t.reminder_type)})]})]})]}),e.jsx("h3",{className:`text-lg font-bold mb-2 ${t.is_completed?"text-gray-500 line-through":"text-gray-900 dark:text-gray-100"}`,children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{size:16,className:"text-gray-500 dark:text-gray-400"}),e.jsx("span",{className:`font-medium ${t.is_completed?"text-gray-500":k(new Date(t.due_date))&&!p(new Date(t.due_date))?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:c(t.due_date)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:g,disabled:v,className:`p-2 rounded-lg transition-smooth ${t.is_completed?"bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-gray-600":"bg-green-500 text-white hover:bg-green-600"}`,title:t.is_completed?"Marquer comme non complété":"Marquer comme complété",children:t.is_completed?e.jsx(q,{size:20}):e.jsx(I,{size:20})}),e.jsx("button",{onClick:N,disabled:u,className:"p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-smooth",title:"Supprimer",children:e.jsx(U,{size:20})})]})]})})},ce=()=>{const{user:t}=V(),m=W(),[j,u]=o.useState(!0),[d,v]=o.useState(!1),[h,b]=o.useState(!1),[l,_]=o.useState([]),[c,g]=o.useState([]);o.useEffect(()=>{(async()=>{if(t!=null&&t.id)try{const{data:r}=await f.from("user_profiles").select("subscription_tier").eq("id",t.id).single(),n=["premium","professional"].includes(r==null?void 0:r.subscription_tier);if(!n){b(!0),u(!1);return}v(n)}catch(r){console.error("Erreur vérification premium:",r)}})()},[t==null?void 0:t.id]),o.useEffect(()=>{if(!(t!=null&&t.id)||!d)return;(async()=>{try{const{data:r,error:i}=await f.from("dogs").select("*").eq("user_id",t.id).eq("is_active",!0);if(i)throw i;_(r||[])}catch(r){console.error("Erreur chargement chiens:",r)}})()},[t==null?void 0:t.id,d]),o.useEffect(()=>{if(!l.length||!d){u(!1);return}(async()=>{u(!0);try{const r=l.map(a=>a.id),{data:i,error:n}=await f.from("vaccinations").select("*, dogs(name, breed, profile_image_url)").in("dog_id",r).not("next_due_date","is",null).order("next_due_date",{ascending:!0});if(n)throw n;const{data:P,error:D}=await f.from("treatments").select("*, dogs(name, breed, profile_image_url)").in("dog_id",r).not("next_due_date","is",null).order("next_due_date",{ascending:!0});if(D)throw D;const S=(i||[]).map(a=>({id:`vac_${a.id}`,original_id:a.id,dog_id:a.dog_id,reminder_type:"vaccin",title:a.vaccine_name,description:a.notes,due_date:a.next_due_date,is_completed:!1,dogs:a.dogs,source:"vaccination"})),M=(P||[]).map(a=>({id:`treat_${a.id}`,original_id:a.id,dog_id:a.dog_id,reminder_type:a.treatment_type==="worm"?"vermifuge":"antiparasitaire",title:a.product_name,description:a.notes,due_date:a.next_due_date,is_completed:!1,dogs:a.dogs,source:"treatment"})),A=[...S,...M].sort((a,$)=>new Date(a.due_date)-new Date($.due_date));g(A)}catch(r){console.error("Erreur chargement rappels:",r)}finally{u(!1)}})()},[l,d]);const N=async(s,r)=>{g(c.map(i=>i.id===s?{...i,is_completed:r}:i))},y=s=>{g(c.filter(r=>r.id!==s))},x=()=>{m("/dog-profile")};return j?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Chargement des rappels..."})]})}):d?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-3 sm:py-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>m(-1),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-smooth py-2 min-h-[44px]",children:[e.jsx(O,{size:20}),e.jsx("span",{className:"text-base font-medium",children:"Retour"})]}),e.jsx(G,{})]})}),e.jsx(R,{}),e.jsx("main",{className:"flex-1 pb-20",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx(z,{className:"text-white",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-heading font-bold text-foreground",children:"Mes Rappels"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gérez les rappels de santé de vos chiens"})]})]})}),l.length===0&&e.jsxs("div",{className:"bg-card rounded-xl border border-border p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(z,{size:24,className:"text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Aucun chien enregistré"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Créez d'abord un profil de chien pour gérer ses rappels"}),e.jsx("button",{onClick:()=>m("/multi-profile-management"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-smooth",children:"Créer un profil"})]}),l.length>0&&c.length===0&&e.jsxs("div",{className:"bg-card rounded-xl border border-border p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{size:24,className:"text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Aucun rappel à venir"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ajoutez des vaccinations ou des traitements depuis le profil de votre chien"}),e.jsxs("button",{onClick:x,className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-smooth inline-flex items-center gap-2",children:[e.jsx(w,{size:20}),"Aller au profil"]})]}),c.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"sm:hidden",children:e.jsxs("button",{onClick:x,className:"w-full px-4 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-smooth flex items-center justify-center gap-2",children:[e.jsx(w,{size:20}),"Ajouter une vaccination/traitement"]})}),e.jsx("div",{className:"hidden sm:flex justify-end",children:e.jsxs("button",{onClick:x,className:"px-6 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-smooth inline-flex items-center gap-2",children:[e.jsx(w,{size:20}),"Ajouter une vaccination/traitement"]})}),c.map(s=>e.jsx(Y,{reminder:s,onDeleted:y,onCompleted:N},s.id))]})]})}),e.jsx(X,{})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx(R,{})}),e.jsx(H,{isOpen:h,onClose:()=>{b(!1),m("/dog-profile")},reason:"reminders"})]})};export{ce as default};
