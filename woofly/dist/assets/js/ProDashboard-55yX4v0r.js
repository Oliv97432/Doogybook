import{j as e,s as T,r,P as E,H as $,a8 as z,l as L,U as oe,p as ne,T as le,i as ie,g as ce}from"./vendor-react-CkOypKSt.js";import{u as de,s as k}from"./index-CmpvQ7zl.js";import{T as me}from"./TabNavigationPro-B2IlaFB7.js";import{U as xe}from"./UserMenuPro-o7Qk5QTd.js";import{C as ue}from"./ContactListModal-BoYsKFfB.js";import{b as ge}from"./vendor-router-M7WQPhYn.js";import"./vendor-misc-B8HVOz_X.js";import"./vendor-pdf-lazy-D4am8o_0.js";import"./vendor-supabase-DEZzVAXw.js";const pe=({size:t="md"})=>{const l={sm:{container:"px-2 py-0.5 text-[10px] gap-1",icon:12},md:{container:"px-2.5 py-1 text-xs gap-1.5",icon:14},lg:{container:"px-4 py-1.5 text-sm gap-2",icon:16}}[t];return e.jsxs("div",{className:`
      inline-flex items-center font-bold rounded-full
      bg-green-50 text-green-700 border border-green-200
      shadow-sm
      ${l.container}
    `,children:[e.jsx(T,{size:l.icon,className:"text-green-500 fill-green-500/10"}),e.jsx("span",{className:"uppercase tracking-wider",children:"Vérifié"})]})},P=(t,n=800,l=75)=>{if(!t)return null;if(t.includes("supabase.co")&&t.includes("storage/v1/object/public")){const m=t.includes("?")?"&":"?";return`${t}${m}width=${n}&quality=${l}&format=webp`}return t},he=()=>e.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-soft border border-border animate-pulse",children:[e.jsx("div",{className:"aspect-square bg-gray-200"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})]}),fe=()=>e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 border border-gray-200 animate-pulse",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"})}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-16 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})]}),h=r.memo(({icon:t,label:n,value:l,onClick:m,gradient:x,iconBg:d,textColor:o,subtitle:c})=>e.jsxs("button",{onClick:m,className:`${x} rounded-xl p-4 border hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left min-h-[120px]`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:`p-2 ${d} rounded-lg`,children:e.jsx(t,{size:20,className:"text-white"})}),l>0&&e.jsx(le,{size:16,className:o})]}),e.jsx("p",{className:`text-2xl sm:text-3xl font-bold ${o} mb-1`,children:l}),e.jsx("p",{className:`text-xs sm:text-sm ${o}`,children:n}),c&&e.jsx("p",{className:`text-xs ${o} font-medium mt-1 opacity-80`,children:c})]}));h.displayName="StatCard";const q=r.memo(({dog:t,onClick:n})=>{var u;const[l,m]=r.useState(!1),d=(()=>{if(t.foster_family_contact_id)return{text:"En FA",icon:z,color:"bg-purple-100 text-purple-700 border-purple-200"};switch(t.adoption_status){case"available":return{text:"Disponible",icon:$,color:"bg-green-100 text-green-700 border-green-200"};case"pending":return{text:"En cours",icon:L,color:"bg-orange-100 text-orange-700 border-orange-200"};case"adopted":return{text:"Adopté",icon:T,color:"bg-gray-100 text-gray-700 border-gray-200"};default:return{text:"Inconnu",icon:ce,color:"bg-gray-100 text-gray-500 border-gray-200"}}})(),o=d.icon,c=t.birth_date?new Date().getFullYear()-new Date(t.birth_date).getFullYear():null;return e.jsxs("div",{onClick:n,className:"group bg-card rounded-2xl overflow-hidden shadow-soft border border-border hover:shadow-xl transition-all duration-300 cursor-pointer hover:-translate-y-1",children:[e.jsxs("div",{className:"aspect-square relative overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5",children:[!l&&t.photo_url&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),t.photo_url?e.jsx("img",{src:P(t.photo_url,400,75),alt:t.name,loading:"lazy",decoding:"async",onLoad:()=>m(!0),className:`w-full h-full object-cover group-hover:scale-110 transition-all duration-500 ${l?"opacity-100":"opacity-0"}`}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-6xl font-bold text-primary/30",children:(u=t.name)==null?void 0:u.charAt(0).toUpperCase()})}),t.is_urgent&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"px-3 py-1.5 bg-red-500 text-white text-xs font-bold rounded-full shadow-lg animate-pulse",children:"URGENT"})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`px-2.5 py-1.5 rounded-full text-xs font-bold border shadow-lg backdrop-blur-sm ${d.color}`,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(o,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:d.text})]})})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-heading font-bold text-lg text-foreground mb-1 truncate group-hover:text-primary transition-colors",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 truncate",children:t.breed}),t.foster_family_contact_id&&t.foster_family&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600 bg-purple-50 rounded-lg p-2.5 mb-3",children:[e.jsx(z,{size:14,className:"flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Chez ",t.foster_family.full_name]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[t.gender&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:t.gender==="male"?"♂️":"♀️"}),e.jsx("span",{className:"hidden xs:inline",children:t.gender==="male"?"Mâle":"Femelle"})]}),c&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{size:14}),e.jsxs("span",{children:[c," an",c>1?"s":""]})]})]})]})]})});q.displayName="DogCard";const B=r.memo(({application:t,onClick:n})=>{var x,d,o,c,u,f;const[l,m]=r.useState(!1);return e.jsx("div",{className:"bg-card rounded-xl shadow-soft border border-border p-4 hover:shadow-lg transition-all cursor-pointer min-h-[88px]",onClick:n,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5 flex-shrink-0",children:[!l&&((x=t.dog)==null?void 0:x.photo_url)&&e.jsx("div",{className:"w-full h-full bg-gray-200 animate-pulse"}),(d=t.dog)!=null&&d.photo_url?e.jsx("img",{src:P(t.dog.photo_url,200,70),alt:t.dog.name,loading:"lazy",onLoad:()=>m(!0),className:`w-full h-full object-cover ${l?"opacity-100":"opacity-0"}`}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl font-bold text-primary/30",children:(c=(o=t.dog)==null?void 0:o.name)==null?void 0:c.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-foreground truncate mb-1",children:(u=t.applicant)==null?void 0:u.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate mb-2",children:["Pour ",(f=t.dog)==null?void 0:f.name]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString("fr-FR")})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"px-3 py-1.5 bg-orange-100 text-orange-700 text-xs font-medium rounded-full whitespace-nowrap",children:"En attente"})})]})})});B.displayName="ApplicationCard";const Se=()=>{const{user:t}=de(),n=ge(),[l,m]=r.useState(!0),[x,d]=r.useState(null),[o,c]=r.useState([]),[u,f]=r.useState([]),[N,A]=r.useState([]),[b,U]=r.useState(""),[g,S]=r.useState("all"),[I,j]=r.useState(!1),[M,_]=r.useState(""),[R,w]=r.useState([]),[H,C]=r.useState("dogs");r.useEffect(()=>{t&&V()},[t]);const V=async()=>{try{const{data:s,error:a}=await k.from("professional_accounts").select("id, organization_name, account_type, is_verified").eq("user_id",t.id).single();if(a)throw a;d(s),await Promise.all([O(s.id),Y(s.id),G(s.id)])}catch(s){console.error("Erreur:",s),n("/pro/register")}finally{m(!1)}},O=async s=>{try{const{data:a,error:i}=await k.from("dogs").select(`
          id,
          name,
          breed,
          photo_url,
          gender,
          birth_date,
          adoption_status,
          is_urgent,
          foster_family_contact_id,
          foster_family:contacts!dogs_foster_family_contact_id_fkey(
            id,
            full_name
          )
        `).eq("professional_account_id",s).order("created_at",{ascending:!1}).limit(50);if(i)throw i;c(a||[])}catch(a){console.error("Erreur chargement chiens:",a),c([])}},Y=async s=>{try{const{data:a,error:i}=await k.from("adoption_applications").select(`
          id,
          user_id,
          created_at,
          status,
          dogs!adoption_applications_dog_id_fkey(id, name, photo_url)
        `).eq("professional_account_id",s).eq("status","pending").order("created_at",{ascending:!1}).limit(20);if(i)throw i;if(a&&a.length>0){const F=a.map(y=>y.user_id),{data:v}=await k.from("user_profiles").select("id, full_name, email").in("id",F),te=a.map(y=>{const ae=v==null?void 0:v.find(re=>re.id===y.user_id);return{...y,dog:y.dogs,applicant:ae||{id:y.user_id,full_name:"Utilisateur inconnu",email:"N/A"}}});f(te)}else f([])}catch(a){console.error("Erreur chargement candidatures:",a),f([])}},G=async s=>{try{const{data:a,error:i}=await k.from("contacts").select("id, full_name, type, availability, max_dogs, current_dogs_count").eq("professional_account_id",s).or("type.eq.foster_family,type.eq.both").order("full_name",{ascending:!0});if(i)throw i;A(a||[])}catch(a){console.error("Erreur chargement familles:",a),A([])}},J=r.useCallback(()=>{_(`Total chiens (${o.length})`),w(o),C("dogs"),j(!0)},[o]),K=r.useCallback(()=>{const s=o.filter(a=>a.adoption_status==="available"&&!a.foster_family_contact_id);_(`Chiens disponibles (${s.length})`),w(s),C("dogs"),j(!0)},[o]),Q=r.useCallback(()=>{const s=o.filter(a=>a.foster_family_contact_id);_(`Chiens en famille d'accueil (${s.length})`),w(s),C("dogs"),j(!0)},[o]),W=r.useCallback(()=>{const s=o.filter(a=>a.adoption_status==="pending");_(`Chiens en cours d'adoption (${s.length})`),w(s),C("dogs"),j(!0)},[o]),X=r.useCallback(()=>{n("/pro/applications")},[n]),Z=r.useCallback(()=>{_(`Familles d'accueil (${N.length})`),w(N),C("contacts"),j(!0)},[N]),ee=r.useCallback(s=>{n(`/pro/dogs/${s}`)},[n]),se=r.useCallback(s=>{n(`/pro/applications/${s}`)},[n]),p={total:o.length,available:o.filter(s=>s.adoption_status==="available"&&!s.foster_family_contact_id).length,inFoster:o.filter(s=>s.foster_family_contact_id).length,pending:o.filter(s=>s.adoption_status==="pending").length,applications:u.length,totalFosterFamilies:N.length,availablePlaces:N.filter(s=>s.availability==="available").reduce((s,a)=>s+(a.max_dogs-(a.current_dogs_count||0)),0)},D=o.filter(s=>{var F,v;const a=b===""||((F=s.name)==null?void 0:F.toLowerCase().includes(b.toLowerCase()))||((v=s.breed)==null?void 0:v.toLowerCase().includes(b.toLowerCase()));let i=!0;return g==="available"?i=s.adoption_status==="available"&&!s.foster_family_contact_id:g==="foster"?i=!!s.foster_family_contact_id:g==="pending"&&(i=s.adoption_status==="pending"),a&&i});return l?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-16 w-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement de votre espace professionnel..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-3",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-heading font-bold text-foreground mb-1 truncate",children:(x==null?void 0:x.organization_name)||"Mon Refuge"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{size:"sm"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Compte certifié par Doogybook"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n("/pro/dogs/new"),className:"px-3 sm:px-4 lg:px-6 py-2.5 sm:py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth flex items-center gap-2 shadow-soft min-h-[44px] text-sm sm:text-base",children:[e.jsx(E,{size:18,className:"sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline",children:"Nouveau"})]}),e.jsx(xe,{})]})]}),l?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2 sm:gap-3 lg:gap-4",children:[...Array(6)].map((s,a)=>e.jsx(fe,{},a))}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2 sm:gap-3 lg:gap-4",children:[e.jsx(h,{icon:$,label:"Total chiens",value:p.total,onClick:J,gradient:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",iconBg:"bg-blue-500",textColor:"text-blue-900"}),e.jsx(h,{icon:$,label:"Disponibles",value:p.available,onClick:K,gradient:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",iconBg:"bg-green-500",textColor:"text-green-900"}),e.jsx(h,{icon:z,label:"En FA",value:p.inFoster,onClick:Q,gradient:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",iconBg:"bg-purple-500",textColor:"text-purple-900"}),e.jsx(h,{icon:L,label:"En cours",value:p.pending,onClick:W,gradient:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",iconBg:"bg-orange-500",textColor:"text-orange-900"}),e.jsx(h,{icon:oe,label:"Candidatures",value:p.applications,onClick:X,gradient:"bg-gradient-to-br from-pink-50 to-pink-100 border-pink-200",iconBg:"bg-pink-500",textColor:"text-pink-900"}),e.jsx(h,{icon:z,label:"Familles FA",value:p.totalFosterFamilies,onClick:Z,gradient:"bg-gradient-to-br from-teal-50 to-teal-100 border-teal-200",iconBg:"bg-teal-500",textColor:"text-teal-900",subtitle:`${p.availablePlaces} places dispo`})]})]})}),e.jsx(me,{}),e.jsx("main",{className:"main-content flex-1 pb-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[e.jsx("div",{className:"bg-card rounded-xl shadow-soft p-3 sm:p-4 mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground pointer-events-none",size:18}),e.jsx("input",{type:"text",value:b,onChange:s=>U(s.target.value),placeholder:"Rechercher un chien...",className:"w-full pl-10 pr-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background text-sm min-h-[44px]"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 sm:pb-0 -mx-3 px-3 sm:mx-0 sm:px-0",children:[e.jsx("button",{onClick:()=>S("all"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${g==="all"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"Tous"}),e.jsx("button",{onClick:()=>S("available"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${g==="available"?"bg-green-500 text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"Disponibles"}),e.jsx("button",{onClick:()=>S("foster"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${g==="foster"?"bg-purple-500 text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"En FA"}),e.jsx("button",{onClick:()=>S("pending"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${g==="pending"?"bg-orange-500 text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"En cours"})]})]})}),l?e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:[...Array(8)].map((s,a)=>e.jsx(he,{},a))}):D.length===0?e.jsxs("div",{className:"bg-card rounded-xl shadow-soft p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx($,{size:32,className:"sm:w-10 sm:h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg sm:text-xl font-heading font-bold text-foreground mb-2",children:"Aucun chien trouvé"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-6",children:b?"Essayez avec d'autres mots-clés":"Commencez par ajouter votre premier chien"}),!b&&e.jsxs("button",{onClick:()=>n("/pro/dogs/new"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth inline-flex items-center gap-2 min-h-[44px]",children:[e.jsx(E,{size:20}),"Ajouter un chien"]})]}):e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:D.map(s=>e.jsx(q,{dog:s,onClick:()=>ee(s.id)},s.id))}),u.length>0&&e.jsxs("div",{className:"mt-6 sm:mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-heading font-bold text-foreground",children:"Candidatures récentes"}),e.jsx("button",{onClick:()=>n("/pro/applications"),className:"text-primary hover:text-primary/80 font-medium text-sm min-h-[44px] px-3",children:"Voir tout →"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:u.slice(0,4).map(s=>e.jsx(B,{application:s,onClick:()=>se(s.id)},s.id))})]})]})}),e.jsx(ue,{isOpen:I,onClose:()=>j(!1),title:M,items:R,type:H})]})};export{Se as default};
