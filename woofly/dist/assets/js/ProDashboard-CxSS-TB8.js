import{j as e,u as ne,s as b}from"./index-BK5E7uAP.js";import{d as ie,r as o}from"./vendor-react-DEK6ZklB.js";import{T as le}from"./TabNavigationPro-GxEyzPc6.js";import{U as ce}from"./UserMenuPro-Dkx6zORV.js";import{C as de}from"./ContactListModal-Ct17JtgS.js";import{o as L,P as T,H as A,a5 as z,i as q,U as me,m as ue,T as ge,g as xe,e as pe}from"./vendor-ui-DjEwDNDD.js";import"./vendor-supabase-DfwcnzK-.js";const he=({size:t="md"})=>{const r={sm:{container:"px-2 py-0.5 text-[10px] gap-1",icon:12},md:{container:"px-2.5 py-1 text-xs gap-1.5",icon:14},lg:{container:"px-4 py-1.5 text-sm gap-2",icon:16}}[t];return e.jsxs("div",{className:`
      inline-flex items-center font-bold rounded-full
      bg-green-50 text-green-700 border border-green-200
      shadow-sm
      ${r.container}
    `,children:[e.jsx(L,{size:r.icon,className:"text-green-500 fill-green-500/10"}),e.jsx("span",{className:"uppercase tracking-wider",children:"Vérifié"})]})},B=(t,c=800,r=75)=>{if(!t)return null;if(t.includes("supabase.co")&&t.includes("storage/v1/object/public")){const d=t.includes("?")?"&":"?";return`${t}${d}width=${c}&quality=${r}&format=webp`}return t},fe=()=>e.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-soft border border-border animate-pulse",children:[e.jsx("div",{className:"aspect-square bg-gray-200"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded"})]})]}),be=()=>e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 border border-gray-200 animate-pulse",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"})}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-16 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})]}),j=o.memo(({icon:t,label:c,value:r,onClick:d,gradient:p,iconBg:l,textColor:m,subtitle:n})=>e.jsxs("button",{onClick:d,className:`${p} rounded-xl p-4 border hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left min-h-[120px]`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:`p-2 ${l} rounded-lg`,children:e.jsx(t,{size:20,className:"text-white"})}),r>0&&e.jsx(ge,{size:16,className:m})]}),e.jsx("p",{className:`text-2xl sm:text-3xl font-bold ${m} mb-1`,children:r}),e.jsx("p",{className:`text-xs sm:text-sm ${m}`,children:c}),n&&e.jsx("p",{className:`text-xs ${m} font-medium mt-1 opacity-80`,children:n})]}));j.displayName="StatCard";const U=o.memo(({dog:t,onClick:c})=>{var g;const[r,d]=o.useState(!1),l=(()=>{if(t.foster_family_contact_id)return{text:"En FA",icon:z,color:"bg-purple-100 text-purple-700 border-purple-200"};switch(t.adoption_status){case"available":return{text:"Disponible",icon:A,color:"bg-green-100 text-green-700 border-green-200"};case"pending":return{text:"En cours",icon:q,color:"bg-orange-100 text-orange-700 border-orange-200"};case"adopted":return{text:"Adopté",icon:L,color:"bg-gray-100 text-gray-700 border-gray-200"};default:return{text:"Inconnu",icon:pe,color:"bg-gray-100 text-gray-500 border-gray-200"}}})(),m=l.icon,n=t.birth_date?new Date().getFullYear()-new Date(t.birth_date).getFullYear():null;return e.jsxs("div",{onClick:c,className:"group bg-card rounded-2xl overflow-hidden shadow-soft border border-border hover:shadow-xl transition-all duration-300 cursor-pointer hover:-translate-y-1",children:[e.jsxs("div",{className:"aspect-square relative overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5",children:[!r&&t.photo_url&&e.jsx("div",{className:"absolute inset-0 bg-gray-200 animate-pulse"}),t.photo_url?e.jsx("img",{src:B(t.photo_url,400,75),alt:t.name,loading:"lazy",decoding:"async",onLoad:()=>d(!0),className:`w-full h-full object-cover group-hover:scale-110 transition-all duration-500 ${r?"opacity-100":"opacity-0"}`}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-6xl font-bold text-primary/30",children:(g=t.name)==null?void 0:g.charAt(0).toUpperCase()})}),t.is_urgent&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"px-3 py-1.5 bg-red-500 text-white text-xs font-bold rounded-full shadow-lg animate-pulse",children:"URGENT"})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`px-2.5 py-1.5 rounded-full text-xs font-bold border shadow-lg backdrop-blur-sm ${l.color}`,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(m,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:l.text})]})})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-heading font-bold text-lg text-foreground mb-1 truncate group-hover:text-primary transition-colors",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3 truncate",children:t.breed}),t.foster_family_contact_id&&t.foster_family&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-purple-600 bg-purple-50 rounded-lg p-2.5 mb-3",children:[e.jsx(z,{size:14,className:"flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Chez ",t.foster_family.full_name]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[t.gender&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:t.gender==="male"?"♂️":"♀️"}),e.jsx("span",{className:"hidden xs:inline",children:t.gender==="male"?"Mâle":"Femelle"})]}),n&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{size:14}),e.jsxs("span",{children:[n," an",n>1?"s":""]})]})]})]})]})});U.displayName="DogCard";const I=o.memo(({application:t,onClick:c})=>{var p,l,m,n,g,y;const[r,d]=o.useState(!1);return e.jsx("div",{className:"bg-card rounded-xl shadow-soft border border-border p-4 hover:shadow-lg transition-all cursor-pointer min-h-[88px]",onClick:c,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5 flex-shrink-0",children:[!r&&((p=t.dog)==null?void 0:p.photo_url)&&e.jsx("div",{className:"w-full h-full bg-gray-200 animate-pulse"}),(l=t.dog)!=null&&l.photo_url?e.jsx("img",{src:B(t.dog.photo_url,200,70),alt:t.dog.name,loading:"lazy",onLoad:()=>d(!0),className:`w-full h-full object-cover ${r?"opacity-100":"opacity-0"}`}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-2xl font-bold text-primary/30",children:(n=(m=t.dog)==null?void 0:m.name)==null?void 0:n.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-foreground truncate mb-1",children:(g=t.applicant)==null?void 0:g.full_name}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate mb-2",children:["Pour ",(y=t.dog)==null?void 0:y.name]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(t.created_at).toLocaleDateString("fr-FR")})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"px-3 py-1.5 bg-orange-100 text-orange-700 text-xs font-medium rounded-full whitespace-nowrap",children:"En attente"})})]})})});I.displayName="ApplicationCard";const ke=()=>{const{user:t,loading:c}=ne(),r=ie(),[d,p]=o.useState(!0),[l,m]=o.useState(null),[n,g]=o.useState([]),[y,$]=o.useState([]),[w,E]=o.useState([]),[v,M]=o.useState(""),[h,S]=o.useState("all"),[R,_]=o.useState(!1),[H,C]=o.useState(""),[V,k]=o.useState([]),[O,D]=o.useState("dogs");o.useEffect(()=>{if(!c){if(!t){r("/login");return}Y()}},[t,c]);const Y=async()=>{try{console.log("ProDashboard: Fetching pro account for user:",t.id,t.email);let s=null;const{data:a,error:i}=await b.from("professional_accounts").select("id, organization_name, account_type, is_verified, is_active, contact_email, user_id").eq("user_id",t.id).maybeSingle();if(console.log("ProDashboard: Account by user_id:",{accountByUserId:a,error1:i}),a)s=a;else{const{data:u,error:x}=await b.from("professional_accounts").select("id, organization_name, account_type, is_verified, is_active, contact_email, user_id").eq("contact_email",t.email).maybeSingle();if(console.log("ProDashboard: Account by email:",{accountByEmail:u,error2:x}),u&&(s=u,u.user_id!==t.id)){console.log("ProDashboard: Updating user_id in professional_accounts");const{error:F}=await b.from("professional_accounts").update({user_id:t.id}).eq("id",u.id);F&&console.error("ProDashboard: Error updating user_id:",F)}}if(!s){console.log("ProDashboard: Aucun compte pro trouvé, redirection vers register"),r("/pro/register");return}console.log("ProDashboard: Compte pro trouvé:",s.organization_name),m(s),await Promise.all([G(s.id),J(s.id),K(s.id)])}catch(s){console.error("ProDashboard: Erreur générale:",s),r("/pro/register")}finally{p(!1)}},G=async s=>{try{const{data:a,error:i}=await b.from("dogs").select(`
          id,
          name,
          breed,
          photo_url,
          gender,
          birth_date,
          adoption_status,
          is_urgent,
          foster_family_contact_id,
          foster_family:contacts!dogs_foster_family_contact_id_fkey(
            id,
            full_name
          )
        `).eq("professional_account_id",s).order("created_at",{ascending:!1}).limit(50);if(i)throw i;g(a||[])}catch(a){console.error("Erreur chargement chiens:",a),g([])}},J=async s=>{try{const{data:a,error:i}=await b.from("adoption_applications").select(`
          id,
          user_id,
          created_at,
          status,
          dogs!adoption_applications_dog_id_fkey(id, name, photo_url)
        `).eq("professional_account_id",s).eq("status","pending").order("created_at",{ascending:!1}).limit(20);if(i)throw i;if(a&&a.length>0){const u=a.map(N=>N.user_id),{data:x}=await b.from("user_profiles").select("id, full_name, email").in("id",u),F=a.map(N=>{const re=x==null?void 0:x.find(oe=>oe.id===N.user_id);return{...N,dog:N.dogs,applicant:re||{id:N.user_id,full_name:"Utilisateur inconnu",email:"N/A"}}});$(F)}else $([])}catch(a){console.error("Erreur chargement candidatures:",a),$([])}},K=async s=>{try{const{data:a,error:i}=await b.from("contacts").select("id, full_name, type, availability, max_dogs, current_dogs_count").eq("professional_account_id",s).or("type.eq.foster_family,type.eq.both").order("full_name",{ascending:!0});if(i)throw i;E(a||[])}catch(a){console.error("Erreur chargement familles:",a),E([])}},Q=o.useCallback(()=>{C(`Total chiens (${n.length})`),k(n),D("dogs"),_(!0)},[n]),W=o.useCallback(()=>{const s=n.filter(a=>a.adoption_status==="available"&&!a.foster_family_contact_id);C(`Chiens disponibles (${s.length})`),k(s),D("dogs"),_(!0)},[n]),X=o.useCallback(()=>{const s=n.filter(a=>a.foster_family_contact_id);C(`Chiens en famille d'accueil (${s.length})`),k(s),D("dogs"),_(!0)},[n]),Z=o.useCallback(()=>{const s=n.filter(a=>a.adoption_status==="pending");C(`Chiens en cours d'adoption (${s.length})`),k(s),D("dogs"),_(!0)},[n]),ee=o.useCallback(()=>{r("/pro/applications")},[r]),se=o.useCallback(()=>{C(`Familles d'accueil (${w.length})`),k(w),D("contacts"),_(!0)},[w]),te=o.useCallback(s=>{r(`/pro/dogs/${s}`)},[r]),ae=o.useCallback(s=>{r(`/pro/applications/${s}`)},[r]),f={total:n.length,available:n.filter(s=>s.adoption_status==="available"&&!s.foster_family_contact_id).length,inFoster:n.filter(s=>s.foster_family_contact_id).length,pending:n.filter(s=>s.adoption_status==="pending").length,applications:y.length,totalFosterFamilies:w.length,availablePlaces:w.filter(s=>s.availability==="available").reduce((s,a)=>s+(a.max_dogs-(a.current_dogs_count||0)),0)},P=n.filter(s=>{var u,x;const a=v===""||((u=s.name)==null?void 0:u.toLowerCase().includes(v.toLowerCase()))||((x=s.breed)==null?void 0:x.toLowerCase().includes(v.toLowerCase()));let i=!0;return h==="available"?i=s.adoption_status==="available"&&!s.foster_family_contact_id:h==="foster"?i=!!s.foster_family_contact_id:h==="pending"&&(i=s.adoption_status==="pending"),a&&i});return d?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-16 w-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement de votre espace professionnel..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-3 sm:py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-3",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-heading font-bold text-foreground mb-1 truncate",children:(l==null?void 0:l.organization_name)||"Mon Refuge"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{size:"sm"}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:"Compte certifié par Doogybook"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>r("/pro/dogs/new"),className:"px-3 sm:px-4 lg:px-6 py-2.5 sm:py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth flex items-center gap-2 shadow-soft min-h-[44px] text-sm sm:text-base",children:[e.jsx(T,{size:18,className:"sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline",children:"Nouveau"})]}),e.jsx(ce,{})]})]}),d?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2 sm:gap-3 lg:gap-4",children:[...Array(6)].map((s,a)=>e.jsx(be,{},a))}):e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2 sm:gap-3 lg:gap-4",children:[e.jsx(j,{icon:A,label:"Total chiens",value:f.total,onClick:Q,gradient:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",iconBg:"bg-blue-500",textColor:"text-blue-900"}),e.jsx(j,{icon:A,label:"Disponibles",value:f.available,onClick:W,gradient:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",iconBg:"bg-green-500",textColor:"text-green-900"}),e.jsx(j,{icon:z,label:"En FA",value:f.inFoster,onClick:X,gradient:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",iconBg:"bg-purple-500",textColor:"text-purple-900"}),e.jsx(j,{icon:q,label:"En cours",value:f.pending,onClick:Z,gradient:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",iconBg:"bg-orange-500",textColor:"text-orange-900"}),e.jsx(j,{icon:me,label:"Candidatures",value:f.applications,onClick:ee,gradient:"bg-gradient-to-br from-pink-50 to-pink-100 border-pink-200",iconBg:"bg-pink-500",textColor:"text-pink-900"}),e.jsx(j,{icon:z,label:"Familles FA",value:f.totalFosterFamilies,onClick:se,gradient:"bg-gradient-to-br from-teal-50 to-teal-100 border-teal-200",iconBg:"bg-teal-500",textColor:"text-teal-900",subtitle:`${f.availablePlaces} places dispo`})]})]})}),e.jsx(le,{}),e.jsx("main",{className:"main-content flex-1 pb-20",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[e.jsx("div",{className:"bg-card rounded-xl shadow-soft p-3 sm:p-4 mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground pointer-events-none",size:18}),e.jsx("input",{type:"text",value:v,onChange:s=>M(s.target.value),placeholder:"Rechercher un chien...",className:"w-full pl-10 pr-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background text-sm min-h-[44px]"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 sm:pb-0 -mx-3 px-3 sm:mx-0 sm:px-0",children:[e.jsx("button",{onClick:()=>S("all"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${h==="all"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"Tous"}),e.jsx("button",{onClick:()=>S("available"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${h==="available"?"bg-green-500 text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"Disponibles"}),e.jsx("button",{onClick:()=>S("foster"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${h==="foster"?"bg-purple-500 text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"En FA"}),e.jsx("button",{onClick:()=>S("pending"),className:`px-4 py-2.5 rounded-lg font-medium text-sm whitespace-nowrap transition-smooth min-h-[44px] ${h==="pending"?"bg-orange-500 text-white":"bg-muted text-muted-foreground hover:bg-muted/80"}`,children:"En cours"})]})]})}),d?e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:[...Array(8)].map((s,a)=>e.jsx(fe,{},a))}):P.length===0?e.jsxs("div",{className:"bg-card rounded-xl shadow-soft p-8 sm:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{size:32,className:"sm:w-10 sm:h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg sm:text-xl font-heading font-bold text-foreground mb-2",children:"Aucun chien trouvé"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-6",children:v?"Essayez avec d'autres mots-clés":"Commencez par ajouter votre premier chien"}),!v&&e.jsxs("button",{onClick:()=>r("/pro/dogs/new"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth inline-flex items-center gap-2 min-h-[44px]",children:[e.jsx(T,{size:20}),"Ajouter un chien"]})]}):e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:P.map(s=>e.jsx(U,{dog:s,onClick:()=>te(s.id)},s.id))}),y.length>0&&e.jsxs("div",{className:"mt-6 sm:mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-heading font-bold text-foreground",children:"Candidatures récentes"}),e.jsx("button",{onClick:()=>r("/pro/applications"),className:"text-primary hover:text-primary/80 font-medium text-sm min-h-[44px] px-3",children:"Voir tout →"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:y.slice(0,4).map(s=>e.jsx(I,{application:s,onClick:()=>ae(s.id)},s.id))})]})]})}),e.jsx(de,{isOpen:R,onClose:()=>_(!1),title:H,items:V,type:O})]})};export{ke as default};
