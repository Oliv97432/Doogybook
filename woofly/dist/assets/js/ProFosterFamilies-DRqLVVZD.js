import{u as T,s as u,j as e}from"./index-CA2N9EnP.js";import{d as U,r as i}from"./vendor-react-DEK6ZklB.js";import{U as R}from"./UserMenuPro-Jf9uW8id.js";import{n as H,P as F,m as O,ap as w,a5 as V,b as K,g as X,j as B,M as G,O as I,a6 as S,X as J,d as Q}from"./vendor-ui-DjEwDNDD.js";import"./vendor-supabase-DfwcnzK-.js";const te=()=>{const{user:b}=T(),j=U(),[L,$]=i.useState(!0),[v,P]=i.useState(null),[d,N]=i.useState([]),[c,M]=i.useState(""),[q,m]=i.useState(!1),[g,_]=i.useState(""),[C,E]=i.useState(!1),[l,h]=i.useState("tous");i.useEffect(()=>{b&&D()},[b]);const D=async()=>{try{const{data:s,error:a}=await u.from("professional_accounts").select("*").eq("user_id",b.id).single();if(a)throw a;P(s),await k(s.id)}catch(s){console.error("Erreur:",s),j("/pro/register")}finally{$(!1)}},k=async s=>{try{const{data:a,error:r}=await u.from("contacts_with_current_dogs").select("*").eq("professional_account_id",s).in("type",["foster_family","both"]).not("user_id","is",null).eq("status","active");if(r)throw console.error("Erreur contacts:",r),r;if(!a||a.length===0){N([]);return}const n=a.map(t=>{const o=t.current_dogs_count||0,x=t.max_dogs||1;let y="disponible";return o>=x?y="complet":t.on_vacation&&(y="vacances"),{id:t.user_id,full_name:t.full_name,email:t.email||"",phone:t.phone||"",address:t.address||"",city:t.city||"",created_at:t.created_at,status:y,current_dogs_count:o,max_dogs:x,on_vacation:t.on_vacation||!1,is_verified:t.is_verified||!1,dogs:Array.isArray(t.current_dogs)?t.current_dogs.map(f=>({id:f.dog_id,name:f.dog_name,breed:f.dog_breed,photo_url:f.dog_photo_url})):[]}});N(n)}catch(a){console.error("Erreur chargement familles:",a),N([])}},A=async()=>{if(!g.trim()){alert("Veuillez entrer un email");return}E(!0);try{const{data:s,error:a}=await u.from("user_profiles").select("id, full_name, email, phone").eq("email",g.toLowerCase().trim()).maybeSingle();if(a){console.error("Erreur recherche user:",a),alert("Erreur lors de la recherche de l'utilisateur");return}if(!s){alert("Aucun utilisateur trouvé avec cet email. La personne doit d'abord créer un compte Doogybook.");return}const{data:r,error:n}=await u.from("contacts").select("id").eq("professional_account_id",v.id).eq("user_id",s.id).maybeSingle();if(n){console.error("Erreur vérification contact:",n),alert("Erreur lors de la vérification");return}if(r){alert("Cette famille d'accueil est déjà enregistrée.");return}const{error:t}=await u.from("contacts").insert({professional_account_id:v.id,user_id:s.id,full_name:s.full_name,email:s.email,phone:s.phone||null,type:"foster_family",status:"active"});if(t){console.error("Erreur insertion:",t),alert("Erreur lors de l'ajout de la famille d'accueil");return}alert(`${s.full_name||s.email} a été ajouté(e) comme famille d'accueil.`),m(!1),_(""),await k(v.id)}catch(s){console.error("Erreur ajout famille:",s),alert("Erreur lors de l'ajout de la famille d'accueil")}finally{E(!1)}},z=d.filter(s=>{var n,t,o,x;const a=((n=s.full_name)==null?void 0:n.toLowerCase().includes(c.toLowerCase()))||((t=s.email)==null?void 0:t.toLowerCase().includes(c.toLowerCase()))||((o=s.address)==null?void 0:o.toLowerCase().includes(c.toLowerCase()))||((x=s.city)==null?void 0:x.toLowerCase().includes(c.toLowerCase())),r=l==="tous"||s.status===l;return a&&r}).sort((s,a)=>{const r={disponible:1,vacances:2,complet:3};return r[s.status]-r[a.status]}),p={total:d.length,disponible:d.filter(s=>s.status==="disponible").length,complet:d.filter(s=>s.status==="complet").length,vacances:d.filter(s=>s.status==="vacances").length};return L?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm",children:e.jsxs("div",{className:"w-full px-4 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>j("/pro/dashboard"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(H,{size:20,className:"text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Familles d'accueil"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[d.length," famille",d.length>1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(F,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Ajouter"})]}),e.jsx(R,{})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:c,onChange:s=>M(s.target.value),placeholder:"Rechercher une famille...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>h("tous"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${l==="tous"?"bg-gray-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Tous (",p.total,")"]}),e.jsxs("button",{onClick:()=>h("disponible"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l==="disponible"?"bg-green-100 text-green-800 border border-green-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(w,{size:12,fill:"#10b981",className:"text-green-500"}),"Disponible (",p.disponible,")"]}),e.jsxs("button",{onClick:()=>h("complet"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l==="complet"?"bg-orange-100 text-orange-800 border border-orange-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(w,{size:12,fill:"#f97316",className:"text-orange-500"}),"Complet (",p.complet,")"]}),e.jsxs("button",{onClick:()=>h("vacances"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${l==="vacances"?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(w,{size:12,fill:"#3b82f6",className:"text-blue-500"}),"En vacances (",p.vacances,")"]})]})]})]})}),e.jsx("main",{className:"w-full px-4 lg:px-8 py-6",children:z.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-8 sm:p-12 text-center max-w-2xl mx-auto",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(V,{size:32,className:"text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:c||l!=="tous"?"Aucune famille trouvée":"Aucune famille d'accueil"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c?"Essayez avec d'autres mots-clés":l!=="tous"?`Aucune famille avec le statut "${l}"`:"Les familles d'accueil apparaîtront ici une fois ajoutées"}),!c&&l==="tous"&&e.jsxs("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors inline-flex items-center gap-2",children:[e.jsx(F,{size:20}),"Ajouter une famille d'accueil"]})]}):e.jsx("div",{className:"space-y-6",children:z.map(s=>{var a;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden w-full",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-1/2 p-6 border-b lg:border-b-0 lg:border-r border-gray-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-blue-500 flex items-center justify-center text-white text-lg font-bold",children:((a=s.full_name)==null?void 0:a.charAt(0).toUpperCase())||"F"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s.full_name||"Famille d'accueil"}),s.is_verified&&e.jsx("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:e.jsx(K,{size:12})})]}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.status==="disponible"?"bg-green-100 text-green-800 border border-green-300":s.status==="complet"?"bg-orange-100 text-orange-800 border border-orange-300":"bg-blue-100 text-blue-800 border border-blue-300"}`,children:s.status==="disponible"?"Disponible":s.status==="complet"?"Complet":"En vacances"})})]})]})}),e.jsxs("div",{className:"space-y-3",children:[s.created_at&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{size:18,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Membre depuis"}),e.jsx("p",{className:"text-gray-900",children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{size:18,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Adresse"}),e.jsxs("p",{className:"text-gray-900",children:[s.address,s.city?`, ${s.city}`:""]})]})]}),s.email&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{size:18,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline",children:s.email})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(I,{size:18,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Téléphone"}),e.jsx("a",{href:`tel:${s.phone}`,className:"text-gray-900 hover:text-blue-600",children:s.phone})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{size:18,className:"text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Capacité d'accueil"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:[s.current_dogs_count," / ",s.max_dogs," chien",s.max_dogs!==1?"s":""]})]})]})]})]}),e.jsxs("div",{className:"lg:w-1/2 p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Chiens accueillis",e.jsxs("span",{className:"text-sm text-gray-500 font-normal ml-2",children:["(",s.dogs.length,")"]})]})}),s.dogs.length>0?e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 gap-3 ${s.dogs.length>4?"max-h-[400px] overflow-y-auto pr-2":""}`,children:s.dogs.map(r=>{var n;return e.jsxs("div",{onClick:()=>j(`/pro/dogs/${r.id}`),className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg overflow-hidden bg-gradient-to-br from-green-100 to-blue-100 flex-shrink-0",children:r.photo_url?e.jsx("img",{src:r.photo_url,alt:r.name,className:"w-full h-full object-cover",onError:t=>{var o;t.target.onerror=null,t.target.parentElement.innerHTML=`
                                      <div class="w-full h-full flex items-center justify-center text-base font-bold text-green-700">
                                        ${((o=r.name)==null?void 0:o.charAt(0).toUpperCase())||"C"}
                                      </div>
                                    `}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-base font-bold text-green-700",children:((n=r.name)==null?void 0:n.charAt(0).toUpperCase())||"C"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-sm truncate",children:r.name}),e.jsx("p",{className:"text-gray-600 text-xs truncate",children:r.breed||"Race non spécifiée"})]})]},r.id)})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(S,{size:40,className:"text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Aucun chien actuellement"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Cette famille est disponible"})]})]})]})},s.id)})})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ajouter une famille d'accueil"}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(J,{size:20,className:"text-gray-600"})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Entrez l'email d'un utilisateur existant pour l'ajouter comme famille d'accueil."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email de la famille d'accueil"}),e.jsx("input",{type:"email",value:g,onChange:s=>_(s.target.value),placeholder:"famille@example.com",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",onKeyPress:s=>s.key==="Enter"&&A()})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition-colors",children:"Annuler"}),e.jsx("button",{onClick:A,disabled:C||!g.trim(),className:"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Vérification..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:18}),"Ajouter"]})})]})]})]})})]})};export{te as default};
