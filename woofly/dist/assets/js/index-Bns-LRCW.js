import{u as z,s as j,j as e}from"./index-CLNZn26n.js";import{e as D,d as R,r as a}from"./vendor-react-DEK6ZklB.js";import{T as A}from"./TabNavigation-CUcm1Fjy.js";import{U as I}from"./UserMenu-DiZqVzBN.js";import{F as U}from"./Footer-Bq5ogMmL.js";import{P as q,m as B,h as H,z as Q,H as J,F as G,E as K}from"./vendor-ui-DjEwDNDD.js";import"./vendor-supabase-DfwcnzK-.js";const se=()=>{var S,k;const{slug:t}=D(),{user:n}=z(),l=R(),[s,u]=a.useState(null),[b,x]=a.useState([]),[g,i]=a.useState(!0),[c,h]=a.useState(!1),[f,d]=a.useState(!1),[o,m]=a.useState(""),[y,E]=a.useState("all"),[p,N]=a.useState("recent");a.useEffect(()=>{w(),n&&F()},[t,n]),a.useEffect(()=>{s&&_()},[s,y,p]);const w=async()=>{try{const{data:r,error:v}=await j.from("forums").select("*").eq("slug",t).eq("is_active",!0).single();if(v)throw v;u(r)}catch(r){console.error("Erreur chargement forum:",r),l("/forum-hub")}},F=async()=>{if(!(!s||!n))try{const{data:r}=await j.from("forum_memberships").select("id").eq("forum_id",s.id).eq("user_id",n.id).maybeSingle();h(!!r)}catch(r){console.error("Erreur vérification membre:",r)}},_=async()=>{i(!0);try{let r=j.from("forum_posts").select(`
          *,
          author:user_id (
            id,
            email,
            raw_user_meta_data
          ),
          images:forum_post_images (
            image_url,
            caption
          )
        `).eq("forum_id",s.id);y!=="all"&&(r=r.eq("category",y)),p==="recent"?r=r.order("created_at",{ascending:!1}):p==="popular"?r=r.order("like_count",{ascending:!1}):p==="trending"&&(r=r.order("view_count",{ascending:!1}));const{data:v,error:P}=await r;if(P)throw P;x(v||[])}catch(r){console.error("Erreur chargement posts:",r)}finally{i(!1)}},M=async()=>{if(!n){l("/login");return}try{const{error:r}=await j.from("forum_memberships").insert({forum_id:s.id,user_id:n.id});if(r)throw r;h(!0),w()}catch(r){console.error("Erreur rejoindre forum:",r),alert("❌ Erreur lors de l'inscription au forum")}},T=async()=>{if(confirm("Êtes-vous sûr de vouloir quitter ce forum ?"))try{const{error:r}=await j.from("forum_memberships").delete().eq("forum_id",s.id).eq("user_id",n.id);if(r)throw r;h(!1),w()}catch(r){console.error("Erreur quitter forum:",r)}},L=r=>{l(`/post/${r}`)};if(!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})});const $=["all","Santé","Comportement","Nutrition","Éducation","Toilettage"],C=b.filter(r=>o===""||r.title.toLowerCase().includes(o.toLowerCase())||r.content.toLowerCase().includes(o.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsx("div",{className:"max-w-screen-xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>l("/forum-hub"),className:"text-muted-foreground hover:text-foreground",children:"← Retour"}),e.jsx(I,{})]})})}),e.jsx(A,{}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"max-w-screen-xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"relative h-64 rounded-3xl overflow-hidden mb-6",children:[e.jsx("img",{src:s.cover_image_url,alt:s.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white",children:[e.jsx("h1",{className:"text-3xl font-heading font-bold mb-2",children:s.name}),e.jsx("p",{className:"text-white/90",children:s.description}),e.jsxs("div",{className:"flex items-center gap-6 mt-4 text-sm",children:[e.jsxs("span",{children:[(S=s.member_count)==null?void 0:S.toLocaleString()," membres"]}),e.jsxs("span",{children:[(k=s.post_count)==null?void 0:k.toLocaleString()," posts"]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth flex items-center gap-2",children:[e.jsx(q,{size:18}),"Créer un post"]}),e.jsx("button",{onClick:T,className:"px-4 py-2 border-2 border-border rounded-xl font-medium hover:bg-muted transition-smooth",children:"Membre"})]}):e.jsx("button",{onClick:M,className:"px-6 py-2 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth",children:"Rejoindre le forum"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N("recent"),className:`px-4 py-2 rounded-xl text-sm font-medium transition-smooth ${p==="recent"?"bg-primary text-primary-foreground":"bg-card border border-border hover:bg-muted"}`,children:"Récents"}),e.jsx("button",{onClick:()=>N("popular"),className:`px-4 py-2 rounded-xl text-sm font-medium transition-smooth ${p==="popular"?"bg-primary text-primary-foreground":"bg-card border border-border hover:bg-muted"}`,children:"Populaires"}),e.jsx("button",{onClick:()=>N("trending"),className:`px-4 py-2 rounded-xl text-sm font-medium transition-smooth ${p==="trending"?"bg-primary text-primary-foreground":"bg-card border border-border hover:bg-muted"}`,children:"Tendances"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("div",{className:"flex-1 min-w-[300px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),e.jsx("input",{type:"text",value:o,onChange:r=>m(r.target.value),placeholder:"Rechercher un post...",className:"w-full pl-10 pr-4 py-3 bg-card border border-border rounded-xl focus:ring-2 focus:ring-primary"})]})}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:$.map(r=>e.jsx("button",{onClick:()=>E(r),className:`px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap transition-smooth ${y===r?"bg-primary text-primary-foreground":"bg-card border border-border hover:bg-muted"}`,children:r==="all"?"Toutes":r},r))})]}),g?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):C.length>0?e.jsx("div",{className:"space-y-4",children:C.map(r=>e.jsx(O,{post:r,onClick:()=>L(r.id)},r.id))}):e.jsxs("div",{className:"bg-card rounded-3xl p-12 text-center border border-border",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun post trouvé"}),c&&e.jsxs("button",{onClick:()=>d(!0),className:"px-6 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth inline-flex items-center gap-2",children:[e.jsx(q,{size:18}),"Créer le premier post"]})]})]})}),e.jsx(U,{}),f&&e.jsx(V,{forumId:s.id,onClose:()=>d(!1),onSuccess:()=>{d(!1),_()}})]})},O=({post:t,onClick:n})=>{var u,b,x,g;const l=((b=(u=t.author)==null?void 0:u.raw_user_meta_data)==null?void 0:b.full_name)||((g=(x=t.author)==null?void 0:x.email)==null?void 0:g.split("@")[0])||"Utilisateur",s=i=>{const c=new Date(i),f=new Date-c,d=Math.floor(f/6e4),o=Math.floor(f/36e5),m=Math.floor(f/864e5);return d<60?`Il y a ${d} min`:o<24?`Il y a ${o}h`:m<7?`Il y a ${m}j`:c.toLocaleDateString("fr-FR")};return e.jsx("div",{onClick:n,className:"bg-card border border-border rounded-3xl p-6 hover:shadow-lg transition-smooth cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold flex-shrink-0",children:l.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-foreground",children:l}),t.is_expert_post&&e.jsx(H,{size:16,className:"text-yellow-500",title:"Expert"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"•"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s(t.created_at)}),t.is_pinned&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"•"}),e.jsx(Q,{size:14,className:"text-primary",title:"Épinglé"})]})]}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:t.title}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 mb-3",children:t.content}),t.images&&t.images.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:t.images.slice(0,2).map((i,c)=>e.jsx("img",{src:i.image_url,alt:i.caption||"",className:"w-full h-32 object-cover rounded-xl"},c))}),t.category&&e.jsx("span",{className:"inline-block px-3 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full mb-3",children:t.category}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{size:16}),e.jsx("span",{children:t.like_count||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{size:16}),e.jsx("span",{children:t.comment_count||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{size:16}),e.jsx("span",{children:t.view_count||0})]})]})]})]})})},V=({forumId:t,onClose:n,onSuccess:l})=>{const{user:s}=z(),[u,b]=a.useState(""),[x,g]=a.useState(""),[i,c]=a.useState(""),[h,f]=a.useState(!1),d=async o=>{if(o.preventDefault(),!u||!x){alert("❌ Titre et contenu requis");return}f(!0);try{const{error:m}=await j.from("forum_posts").insert({forum_id:t,user_id:s.id,title:u,content:x,category:i||null});if(m)throw m;alert("✅ Post créé avec succès !"),l()}catch(m){console.error("Erreur création post:",m),alert("❌ Erreur lors de la création du post")}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card rounded-3xl shadow-elevated max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-heading font-bold",children:"Créer un post"}),e.jsx("button",{onClick:n,className:"text-muted-foreground hover:text-foreground",children:"✕"})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Titre *"}),e.jsx("input",{type:"text",value:u,onChange:o=>b(o.target.value),placeholder:"Donnez un titre à votre post...",className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Catégorie"}),e.jsxs("select",{value:i,onChange:o=>c(o.target.value),className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),e.jsx("option",{value:"Santé",children:"Santé"}),e.jsx("option",{value:"Comportement",children:"Comportement"}),e.jsx("option",{value:"Nutrition",children:"Nutrition"}),e.jsx("option",{value:"Éducation",children:"Éducation"}),e.jsx("option",{value:"Toilettage",children:"Toilettage"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Contenu *"}),e.jsx("textarea",{value:x,onChange:o=>g(o.target.value),placeholder:"Partagez votre expérience, posez une question...",rows:8,className:"w-full px-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary resize-none",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:h,className:"flex-1 bg-primary text-primary-foreground py-3 rounded-xl font-semibold hover:bg-primary/90 transition-smooth disabled:bg-gray-300 disabled:cursor-not-allowed",children:h?"Publication...":"Publier"}),e.jsx("button",{type:"button",onClick:n,className:"px-6 py-3 border-2 border-border rounded-xl font-medium hover:bg-muted transition-smooth",children:"Annuler"})]})]})]})})};export{se as default};
