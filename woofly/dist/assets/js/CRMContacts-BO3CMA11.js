import{u as le,s as C,j as e}from"./index-B_5e2oWA.js";import{d as oe,r as o}from"./vendor-react-DEK6ZklB.js";import{T as ne}from"./TabNavigationPro-HBpIcqZP.js";import{U as ie}from"./UserMenuPro-Osvc5FHP.js";import{C as ce}from"./ContactListModal-TyDOsC6a.js";import{P as I,U as A,a5 as M,H as P,T as de,o as me,m as xe,ah as ue,M as pe,O as he,j as fe,g as ge,e as be}from"./vendor-ui-DjEwDNDD.js";import"./vendor-supabase-DfwcnzK-.js";const Ae=()=>{const{user:v}=le(),f=oe(),[L,k]=o.useState(!0),[E,$]=o.useState(null),[x,D]=o.useState([]),[i,U]=o.useState({totalContacts:0,activeFosterFamilies:0,totalAdopters:0,dogsInFoster:0,availableCapacity:0}),[R,d]=o.useState(!1),[q,u]=o.useState(""),[B,p]=o.useState([]),[H,h]=o.useState("contacts"),[m,O]=o.useState(""),[y,G]=o.useState("all"),[N,J]=o.useState("all"),[_,K]=o.useState("all");o.useEffect(()=>{v&&Q()},[v]);const Q=async()=>{try{const{data:t,error:s}=await C.from("professional_accounts").select("*").eq("user_id",v.id).single();if(s)throw s;$(t),await V(t.id)}catch(t){console.error("Erreur:",t),f("/pro/register")}},V=async t=>{try{k(!0);const{data:s,error:n}=await C.from("contacts").select(`
          *,
          contact_notes(count),
          placement_history!placement_history_contact_id_fkey(
            id,
            dog_id,
            status,
            placement_type,
            start_date,
            dogs(id, name, breed, photo_url)
          )
        `).eq("professional_account_id",t).order("created_at",{ascending:!1});if(n)throw n;const r=s.map(a=>{var c,T,S,z;return{...a,current_dogs:((T=(c=a.placement_history)==null?void 0:c.filter(w=>w.status==="active"))==null?void 0:T.map(w=>w.dogs))||[],notes_count:((z=(S=a.contact_notes)==null?void 0:S[0])==null?void 0:z.count)||0}});D(r);const l=r.length,g=r.filter(a=>(a.type==="foster_family"||a.type==="both")&&a.status==="active").length,b=r.filter(a=>a.type==="adopter"||a.type==="both").length,j=r.reduce((a,c)=>a+c.current_dogs.length,0),ae=r.filter(a=>a.availability==="available").reduce((a,c)=>a+(c.max_dogs-c.current_dogs_count),0);U({totalContacts:l,activeFosterFamilies:g,totalAdopters:b,dogsInFoster:j,availableCapacity:ae})}catch(s){console.error("Erreur chargement contacts:",s)}finally{k(!1)}},W=()=>{u(`Total contacts (${i.totalContacts})`),p(x),h("contacts"),d(!0)},X=()=>{const t=x.filter(s=>(s.type==="foster_family"||s.type==="both")&&s.status==="active");u(`FA actives (${t.length})`),p(t),h("contacts"),d(!0)},Y=()=>{const t=x.filter(s=>s.type==="adopter"||s.type==="both");u(`Adoptants (${t.length})`),p(t),h("contacts"),d(!0)},Z=async()=>{try{const{data:t,error:s}=await C.from("dogs").select(`
          *,
          contacts!dogs_foster_family_contact_id_fkey(full_name)
        `).eq("professional_account_id",E.id).not("foster_family_contact_id","is",null);if(s)throw s;const n=t.map(r=>{var l;return{...r,foster_family_name:(l=r.contacts)==null?void 0:l.full_name}});u(`Chiens en FA (${n.length})`),p(n),h("dogs"),d(!0)}catch(t){console.error("Erreur chargement chiens:",t)}},ee=()=>{const t=x.filter(s=>s.availability==="available");u(`Places disponibles (${i.availableCapacity})`),p(t),h("contacts"),d(!0)},F=x.filter(t=>{var g,b,j;const s=((g=t.full_name)==null?void 0:g.toLowerCase().includes(m.toLowerCase()))||((b=t.email)==null?void 0:b.toLowerCase().includes(m.toLowerCase()))||((j=t.phone)==null?void 0:j.includes(m));let n=!0;y!=="all"&&(n=t.type===y||t.type==="both");let r=!0;N!=="all"&&(r=t.status===N);let l=!0;return _!=="all"&&(l=t.availability===_),s&&n&&r&&l}),te=t=>{if(t.type==="adopter")return null;switch(t.availability){case"available":return{text:"Disponible",color:"bg-green-100 text-green-700 border-green-200"};case"full":return{text:"Complet",color:"bg-orange-100 text-orange-700 border-orange-200"};case"temporarily_unavailable":return{text:"Indisponible",color:"bg-gray-100 text-gray-700 border-gray-200"};case"inactive":return{text:"Inactif",color:"bg-red-100 text-red-700 border-red-200"};default:return null}},se=t=>t==="foster_family"||t==="both"?M:t==="adopter"?P:A,re=t=>{switch(t){case"foster_family":return"Famille d'accueil";case"adopter":return"Adoptant";case"both":return"FA & Adoptant";default:return"Contact"}};return L?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin h-16 w-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-card border-b border-border shadow-soft",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-heading font-bold text-foreground mb-1",children:"Gestion des contacts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Familles d'accueil et adoptants"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:()=>f("/pro/crm/contacts/new"),className:"px-4 sm:px-6 py-2 sm:py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth flex items-center gap-2 shadow-soft min-h-[44px]",children:[e.jsx(I,{size:20}),e.jsx("span",{className:"hidden xs:inline",children:"Nouveau contact"}),e.jsx("span",{className:"xs:hidden",children:"Nouveau"})]}),e.jsx(ie,{})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs("button",{onClick:W,className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200 hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(A,{size:20,className:"text-white"})})}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-blue-900",children:i.totalContacts}),e.jsx("p",{className:"text-xs sm:text-sm text-blue-700",children:"Total contacts"})]}),e.jsxs("button",{onClick:X,className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200 hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"p-2 bg-purple-500 rounded-lg",children:e.jsx(M,{size:20,className:"text-white"})})}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-purple-900",children:i.activeFosterFamilies}),e.jsx("p",{className:"text-xs sm:text-sm text-purple-700",children:"FA actives"})]}),e.jsxs("button",{onClick:Y,className:"bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4 border border-pink-200 hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"p-2 bg-pink-500 rounded-lg",children:e.jsx(P,{size:20,className:"text-white"})})}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-pink-900",children:i.totalAdopters}),e.jsx("p",{className:"text-xs sm:text-sm text-pink-700",children:"Adoptants"})]}),e.jsxs("button",{onClick:Z,className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4 border border-orange-200 hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"p-2 bg-orange-500 rounded-lg",children:e.jsx(de,{size:20,className:"text-white"})})}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-orange-900",children:i.dogsInFoster}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:"Chiens en FA"})]}),e.jsxs("button",{onClick:ee,className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200 hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer text-left",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"p-2 bg-green-500 rounded-lg",children:e.jsx(me,{size:20,className:"text-white"})})}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-green-900",children:i.availableCapacity}),e.jsx("p",{className:"text-xs sm:text-sm text-green-700",children:"Places dispo"})]})]})]})}),e.jsx(ne,{}),e.jsx("main",{className:"main-content flex-1",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-6",children:[e.jsx("div",{className:"bg-card rounded-xl shadow-soft p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:20}),e.jsx("input",{type:"text",value:m,onChange:t=>O(t.target.value),placeholder:"Rechercher un contact...",className:"w-full pl-10 pr-4 py-3 border border-border rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent bg-background text-sm"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{value:y,onChange:t=>G(t.target.value),className:"px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-background text-sm",children:[e.jsx("option",{value:"all",children:"Tous les types"}),e.jsx("option",{value:"foster_family",children:"Familles d'accueil"}),e.jsx("option",{value:"adopter",children:"Adoptants"})]}),e.jsxs("select",{value:N,onChange:t=>J(t.target.value),className:"px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-background text-sm",children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"active",children:"Actifs"}),e.jsx("option",{value:"inactive",children:"Inactifs"})]}),e.jsxs("select",{value:_,onChange:t=>K(t.target.value),className:"px-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-background text-sm",children:[e.jsx("option",{value:"all",children:"Toutes disponibilités"}),e.jsx("option",{value:"available",children:"Disponibles"}),e.jsx("option",{value:"full",children:"Complets"}),e.jsx("option",{value:"temporarily_unavailable",children:"Indisponibles"})]})]})]})}),F.length===0?e.jsxs("div",{className:"bg-card rounded-xl shadow-soft p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(A,{size:40,className:"text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-heading font-bold text-foreground mb-2",children:"Aucun contact trouvé"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:m?"Essayez avec d'autres mots-clés":"Commencez par ajouter votre premier contact"}),!m&&e.jsxs("button",{onClick:()=>f("/pro/crm/contacts/new"),className:"px-6 py-3 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-smooth inline-flex items-center gap-2",children:[e.jsx(I,{size:20}),"Ajouter un contact"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:F.map(t=>{const s=se(t.type),n=te(t);return e.jsxs("div",{onClick:()=>f(`/pro/crm/contacts/${t.id}`),className:"group bg-card rounded-2xl shadow-soft border border-border hover:shadow-lg transition-all duration-300 cursor-pointer hover:-translate-y-1 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-primary/5 px-4 py-3 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{size:18,className:"text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:re(t.type)})]}),n&&e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${n.color}`,children:n.text})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-heading font-bold text-lg text-foreground mb-1 group-hover:text-primary transition-colors",children:t.full_name}),t.rating&&e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((r,l)=>e.jsx(ue,{size:14,className:l<t.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"},l))})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(pe,{size:14}),e.jsx("span",{className:"truncate",children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(he,{size:14}),e.jsx("span",{children:t.phone})]}),t.city&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(fe,{size:14}),e.jsx("span",{className:"truncate",children:t.city})]})]}),(t.type==="foster_family"||t.type==="both")&&e.jsx("div",{className:"bg-purple-50 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-purple-700 font-medium",children:["Chiens actuels : ",t.current_dogs_count,"/",t.max_dogs]}),e.jsxs("span",{className:"text-purple-600",children:["Total : ",t.total_dogs_fostered]})]})}),t.current_dogs.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Chiens actuellement en garde :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.current_dogs.map(r=>{var l;return e.jsxs("div",{className:"flex items-center gap-2 bg-background rounded-lg px-2 py-1 border border-border",children:[r.photo_url?e.jsx("img",{src:r.photo_url,alt:r.name,className:"w-6 h-6 rounded-full object-cover"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:(l=r.name)==null?void 0:l.charAt(0)})}),e.jsx("span",{className:"text-xs font-medium",children:r.name})]},r.id)})})]}),e.jsxs("div",{className:"pt-3 border-t border-border flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{size:12}),new Date(t.created_at).toLocaleDateString("fr-FR")]}),t.notes_count>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{size:12}),t.notes_count," note",t.notes_count>1?"s":""]})]})]})]},t.id)})})]})}),e.jsx(ce,{isOpen:R,onClose:()=>d(!1),title:q,items:B,type:H})]})};export{Ae as default};
